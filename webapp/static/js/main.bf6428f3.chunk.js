(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{245:function(e,t,a){e.exports=a(566)},250:function(e,t,a){},566:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(19),l=a.n(i),r=(a(250),a(252),a(254),a(256),a(9)),o=a(10),c=a(12),m=a(11),d=a(13),u=a(232),h=a.n(u),p=a(117),g=a(1),y=a(568),f=a(575),b=a(573),v=a(351),S=a(570),E=a(571),C=a(586),k=a(576),_=a(127),x=a(569),O=a(587),j=a(577),w=a(567),P=a(578),N=a(591),M=a(589),A=a(588),R=a(4),L=a.n(R),T=a(154),I=a(22),V=a.n(I),U=function(){function e(t){Object(r.a)(this,e),this.counter=0,t&&(this.taliesinApiUrl=t.taliesinApiUrl||"",this.angharadApiUrl=t.angharadApiUrl||"",this.benoicPrefix=t.benoicPrefix||"",this.carleonPrefix=t.carleonPrefix||"",this.oauth2=!!t.oauth2)}return Object(o.a)(e,[{key:"APIRequest",value:function(e,t,a){var n=this;if(this.counter<=100){this.counter++;var s=new Date;return!this.oauth2||1e3*G.getState().token_expiration>s.getTime()?this.APIRequestExecute(e,t,a).always(function(){n.counter--}):G.getState().oauth2Connector&&G.getState().oauth2Connector.runRefreshToken?G.getState().oauth2Connector.runRefreshToken().then(function(){return n.APIRequestExecute(e,t,a)}).always(function(){n.counter--}):(this.counter--,V.a.Deferred().reject("error oauth2Connector").promise())}return V.a.Deferred().reject("error too busy").promise()}},{key:"APIRequestExecute",value:function(e,t,a){return V.a.ajax({method:e,url:t,data:JSON.stringify(a),contentType:a?"application/json; charset=utf-8":null,headers:{Authorization:"Bearer "+G.getState().token}})}},{key:"angharadApiRequest",value:function(e,t,a){return this.angharadApiUrl?this.APIRequest(e,this.angharadApiUrl+"/"+t,a):V.a.Deferred().reject("no angharad API").promise()}},{key:"benoicApiRequest",value:function(e,t,a){return this.benoicPrefix?this.angharadApiRequest(e,this.benoicPrefix+"/"+t,a):V.a.Deferred().reject("no benoic prefix").promise()}},{key:"carleonApiRequest",value:function(e,t,a){return this.carleonPrefix?this.angharadApiRequest(e,this.carleonPrefix+"/"+t,a):V.a.Deferred().reject("no carleon prefix").promise()}},{key:"taliesinApiRequest",value:function(e,t,a){return this.taliesinApiUrl?(G.getState().profile.currentUser&&G.getState().profile.currentUser!==G.getState().profile.connectedUser&&(t.indexOf("?")>=0?t+="&username="+G.getState().profile.currentUser:t+="?username="+G.getState().profile.currentUser),this.APIRequest(e,this.taliesinApiUrl+t,a)):V.a.Deferred().reject("no taliesin API").promise()}}]),e}(),D=a(38),B=a.n(D),q=new(function(){function e(){Object(r.a)(this,e),this.localStorageKey="taliesinConfig",this.config=!1}return Object(o.a)(e,[{key:"fetchConfig",value:function(){var e=this;return V.a.ajax({method:"GET",url:"config.json"}).then(function(t){e.config=t})}},{key:"getConfigValue",value:function(e){return!!this.config&&this.config[e]}},{key:"getLocalConfigValue",value:function(e){var t=!1;return"local"===this.config.storageType?t=JSON.parse(localStorage.getItem(this.localStorageKey)):"cookie"===this.config.storageType&&(t=JSON.parse(B.a.get(this.localStorageKey))),!(!t||!t[e])&&t[e]}},{key:"getLocalConfig",value:function(){var e=!1;return"local"===this.config.storageType?e=JSON.parse(localStorage.getItem(this.localStorageKey)):"cookie"===this.config.storageType&&(e=JSON.parse(B.a.get(this.localStorageKey))),e}},{key:"setLocalConfigValue",value:function(e,t){var a=!1;return"local"===this.config.storageType?a=JSON.parse(localStorage.getItem(this.localStorageKey)):"cookie"===this.config.storageType&&(a=JSON.parse(B.a.get(this.localStorageKey))),a||(a={}),a[e]=t,"local"===this.config.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(a)):"cookie"===this.config.storageType&&B.a.set(this.localStorageKey,JSON.stringify(a))}}]),e}()),F={lastAction:!1,ready:!1,showFullScreen:!1,status:"connect",taliesinApiUrl:!1,angharadApiUrl:!1,token:!1,token_expiration:0,oauth2Connector:!1,APIManager:!1,NotificationManager:!1,userList:[],dataSourceList:[],dataSourceListLoaded:!1,externalPlayerList:[],streamList:[],playlists:[],serverConfig:{},profile:{isAdmin:!1,oauth2Profile:!1,useWebsocket:!0,currentUser:!1,connectedUser:!1,dataSource:!1,path:"",category:!1,categoryValue:!1,subCategory:!1,subCategoryValue:!1,stream:!1,streamDetails:!1,playlist:!1,mediaNow:!1,mediaNext:!1,browse:"dashboard",view:"list",jukeboxIndex:0,currentPlayer:{type:"internal",name:!1},currentPlayerStatus:"stop",currentPlayerRepeat:!1,currentPlayerRandom:!1,currentPlayerVolume:0,playerAction:!1,playerActionParameter:!1}};var G=Object(T.createStore)(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"connection":t.APIManager=new U({taliesinApiUrl:a.taliesinApiUrl,angharadApiUrl:a.angharadApiUrl,benoicPrefix:a.benoicPrefix,carleonPrefix:a.carleonPrefix,oauth2:a.oauth2}),t.taliesinApiUrl=a.taliesinApiUrl,t.angharadApiUrl=a.angharadApiUrl,t.status=a.status,t.token=a.token,t.token_expiration=a.expiration,t.ready=!!t.APIManager&&(!!t.token&&"connected"===t.status&&!!t.oauth2Connector||"noauth"===t.status);break;case"setProfile":t.profile.oauth2Profile=a.profile,t.profile.currentUser=a.profile.login,t.profile.connectedUser=a.profile.login;break;case"newApiToken":t.token=a.token,t.token_expiration=a.expiration,t.ready=!!t.APIManager&&!!t.token&&"connected"===t.status&&!!t.oauth2Connector;break;case"setOauth2Connector":t.oauth2Connector=a.oauth2Connector;break;case"newNotificationManager":t.NotificationManager=a.notificationManager;break;case"setServerConfig":t.serverConfig=a.config;break;case"setDataSourceList":t.dataSourceList=a.dataSourceList,t.dataSourceListLoaded=a.loaded,a.currentDataSource&&(t.profile.dataSource=a.currentDataSource,t.profile.path="",q.setLocalConfigValue("dataSource",a.currentDataSource));break;case"setDataSource":for(e in t.dataSourceList)t.dataSourceList[e].name===a.dataSource.name&&(t.dataSourceList[e]=a.dataSource);break;case"setCurrentDataSource":t.profile.dataSource=a.currentDataSource,q.setLocalConfigValue("dataSource",a.currentDataSource),t.profile.path="";break;case"setStreamList":t.streamList=a.streamList;break;case"setStream":for(e in t.streamList)if(t.streamList[e].name===a.stream.name){t.streamList[e]=a.stream;break}t.profile.stream.name===a.stream.name&&(t.profile.stream=a.stream,q.setLocalConfigValue("stream",a.stream));break;case"loadStreamAndPlay":a.index||0===a.index?t.profile.jukeboxIndex=a.index:t.profile.jukeboxIndex=-1,t.profile.stream=a.stream,q.setLocalConfigValue("stream",a.stream);break;case"loadStream":t.profile.stream=a.stream,q.setLocalConfigValue("stream",a.stream);break;case"setCurrentBrowse":t.profile.browse=a.browse;break;case"setCurrentPath":t.profile.path=a.path;break;case"setCurrentCategory":t.profile.category=a.category,a.categoryValue?t.profile.categoryValue=a.categoryValue:t.profile.categoryValue=!1,a.subCategory?t.profile.subCategory=a.subCategory:t.profile.subCategory=!1,a.subCategoryValue?t.profile.subCategoryValue=a.subCategoryValue:t.profile.subCategoryValue=!1;break;case"setJukeboxIndex":t.profile.jukeboxIndex=a.index;break;case"setUserList":t.userList=a.userList,t.profile.isAdmin=a.isAdmin;break;case"setExternalPlayerList":t.externalPlayerList=a.externalPlayerList;break;case"setCurrentPlayer":t.profile.currentPlayer=a.currentPlayer,q.setLocalConfigValue("currentPlayer",a.currentPlayer);break;case"setMediaNow":t.profile.mediaNow=a.media;break;case"setMediaNext":t.profile.mediaNext=a.media;break;case"setCurrentView":t.profile.view=a.view,q.setLocalConfigValue("view",a.view);break;case"setStreamDetails":t.profile.streamDetails=a.stream;break;case"showFullScreen":t.showFullScreen=a.show,q.setLocalConfigValue("fullScreen",a.show);break;case"setPlayerAction":t.profile.playerAction=a.action,a.parameter?t.profile.playerActionParameter=a.parameter:t.profile.playerActionParameter=!1;break;case"setCurrentPlayerStatus":a.status&&(t.profile.currentPlayerStatus=a.status),a.repeat&&(t.profile.currentPlayerRepeat=a.repeat),a.random&&(t.profile.currentPlayerRandom=a.random),a.volume&&(t.profile.currentPlayerVolume=a.volume);break;case"setPlaylists":t.playlists=a.playlists;break;case"setPlaylist":for(e in t.playlists)if(t.playlists[e].name===a.playlist.name){t.playlists[e]=a.playlist;break}break;case"setCurrentPlaylist":t.profile.playlist=a.playlist;break;case"setCurrentUser":t.profile.currentUser=a.currentUser;break;case"setStoredValues":a.config&&(a.config.dataSource&&t.dataSourceList.find(function(e){return e.name===a.config.dataSource.name})&&(t.profile.dataSource=a.config.dataSource),a.config.currentPlayer&&("external"!==a.config.currentPlayer.type||t.externalPlayerList.find(function(e){return e.name===a.config.currentPlayer.name}))&&(t.profile.currentPlayer=a.config.currentPlayer),a.config.stream&&(t.profile.stream=a.config.stream),t.profile.view=a.config.view||t.profile.view);break;case"setUseWebsocket":t.profile.useWebsocket=a.useWebsocket}return t.lastAction=a.type,t}),W=a(163),K=a(238),H=a.n(K),J=a(239),z=a.n(J);W.a.use(H.a).use(z.a).use(p.b).init({fallbackLng:"en",ns:["translations"],defaultNS:"translations",interpolation:{escapeValue:!1},react:{wait:!0}});var $=W.a,Q=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={status:G.getState().status},a.handleDisconnect=a.handleDisconnect.bind(Object(g.a)(Object(g.a)(a))),a.handleConnect=a.handleConnect.bind(Object(g.a)(Object(g.a)(a))),G.subscribe(function(){"connection"===G.getState().lastAction&&a.setState({status:G.getState().status})}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleDisconnect",value:function(e){G.getState().oauth2Connector.disconnect()}},{key:"handleConnect",value:function(e){G.getState().oauth2Connector.connect()}},{key:"render",value:function(){var e=this;return"connected"===this.state.status||"connect"===this.state.status?s.a.createElement(w.a,{href:"",onClick:function(){return e.handleDisconnect()}},s.a.createElement(L.a,{name:"sign-out"})," ",$.t("topmenu.log_out")):"noauth"!==this.state.status?s.a.createElement(w.a,{href:"",onClick:function(){return e.handleConnect()}},s.a.createElement(L.a,{name:"sign-in"})," ",$.t("topmenu.log_in")):s.a.createElement("div",null)}}]),t}(n.Component),Y=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={currentDataSource:e.dataSource,dataSourceList:e.list},a.handleSelectDataSource=a.handleSelectDataSource.bind(Object(g.a)(Object(g.a)(a))),a.handleManageDataSource=a.handleManageDataSource.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({currentDataSource:e.dataSource,dataSourceList:e.list})}},{key:"handleManageDataSource",value:function(e){G.dispatch({type:"setCurrentBrowse",browse:"manageDataSource"})}},{key:"handleSelectDataSource",value:function(e){e.name!==this.state.currentDataSource.name&&G.dispatch({type:"setCurrentDataSource",currentDataSource:e}),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:"/"})}},{key:"render",value:function(){var e=[],t=this;return this.state.dataSourceList.forEach(function(a,n){var i="running"===a.status||"preparing"===a.status||"error"===a.status;e.push(s.a.createElement(y.a,{key:n,onClick:function(){return t.handleSelectDataSource(a)},"data-name":a.name,className:i?"bg-warning":a.name===t.state.currentDataSource.name?"bg-success":"",disabled:i},a.name))}),s.a.createElement(x.a,{title:$.t("topmenu.data_sources"),id:"nav-data-source"},e,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:this.handleManageDataSource},$.t("topmenu.manage_data_sources")))}}]),t}(n.Component),X=a(585),Z=a(157),ee=a(574),te=a(572),ae=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,path:e.path,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,show:e.show,cb:e.onCloseCb,streamList:[],streamToLoad:!0,playlists:[],playlistToLoad:!0},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.loadStreams=a.loadStreams.bind(Object(g.a)(Object(g.a)(a))),a.loadPlaylists=a.loadPlaylists.bind(Object(g.a)(Object(g.a)(a))),a.handleRemoveFromStream=a.handleRemoveFromStream.bind(Object(g.a)(Object(g.a)(a))),a.handleAddToStream=a.handleAddToStream.bind(Object(g.a)(Object(g.a)(a))),a.handleRemoveFromPlaylist=a.handleRemoveFromPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.handleAddToPlaylist=a.handleAddToPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.state.show&&(a.loadStreams(),a.loadPlaylists()),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({dataSource:e.dataSource,path:e.path,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,show:e.show,cb:e.onCloseCb,streamList:[],streamToLoad:!0,playlists:[],playlistToLoad:!0},function(){t.state.show&&(t.loadStreams(),t.loadPlaylists())})}},{key:"close",value:function(e,t){var a=this;t&&t.preventDefault(),this.setState({show:!1},function(){a.state.cb&&a.state.cb(!!e&&a.state.value)})}},{key:"loadStreams",value:function(){var e,t=this,a={command:"has_list",parameters:{media:[]}};this.state.path?(e={data_source:this.state.dataSource,path:this.state.path,recursive:!0},a.parameters.media.push(e)):this.state.subCategory?(e={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,subCategory:this.state.subCategory,subCategory_value:this.state.subCategoryValue},a.parameters.media.push(e)):(e={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue},a.parameters.media.push(e));var n=[];G.getState().streamList.forEach(function(e,i){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e.name)+"/manage/",a).then(function(a){n.push(s.a.createElement(S.a,{key:i},s.a.createElement(E.a,{md:10,sm:10,xs:10},s.a.createElement(te.a,null,e.display_name)),s.a.createElement(E.a,{md:2,sm:2,xs:2},s.a.createElement(_.a,{onClick:function(){return t.handleRemoveFromStream(e.name,i)}},s.a.createElement(L.a,{name:"minus"}))))),t.setState({streamList:n,streamToLoad:!1})}).fail(function(){n.push(s.a.createElement(S.a,{key:i},s.a.createElement(E.a,{md:10,sm:10,xs:10},s.a.createElement(te.a,null,e.display_name)),s.a.createElement(E.a,{md:2,sm:2,xs:2},s.a.createElement(_.a,{onClick:function(){return t.handleAddToStream(e.name,i)}},s.a.createElement(L.a,{name:"plus"}))))),t.setState({streamList:n,streamToLoad:!1})})})}},{key:"handleAddToStream",value:function(e,t){var a,n=this,s={command:"append_list",parameters:{media:[]}};this.state.path?(a={data_source:this.state.dataSource,path:this.state.path,recursive:!0},s.parameters.media.push(a)):this.state.subCategory?(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,subCategory:this.state.subCategory,subCategory_value:this.state.subCategoryValue},s.parameters.media.push(a)):(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue},s.parameters.media.push(a)),G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage/",s).then(function(e){G.getState().NotificationManager.addNotification({message:$.t("modal.message_add_to_stream_success"),level:"info"}),G.getState().APIManager.taliesinApiRequest("GET","/stream").then(function(e){G.dispatch({type:"setStreamList",streamList:e});var a=n.state.streamList;a.splice(t,1),n.setState({streamList:a,streamToLoad:!0})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_list_reload_error"),level:"error"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("modal.message_add_to_stream_error"),level:"error"})})}},{key:"handleRemoveFromStream",value:function(e,t){var a,n=this,s={command:"remove_list",parameters:{media:[]}};this.state.path?(a={data_source:this.state.dataSource,path:this.state.path,recursive:!0},s.parameters.media.push(a)):this.state.subCategory?(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,subCategory:this.state.subCategory,subCategory_value:this.state.subCategoryValue},s.parameters.media.push(a)):(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue},s.parameters.media.push(a)),G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage/",s).then(function(e){G.getState().NotificationManager.addNotification({message:$.t("modal.message_delete_from_stream_success"),level:"info"}),G.getState().APIManager.taliesinApiRequest("GET","/stream").then(function(e){G.dispatch({type:"setStreamList",streamList:e});var a=n.state.streamList;a.splice(t,1),n.setState({streamList:a,streamToLoad:!0})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_list_reload_error"),level:"error"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("modal.message_delete_from_stream_error"),level:"error"})})}},{key:"loadPlaylists",value:function(){var e=this,t=[];this.state.path?t.push({data_source:this.state.dataSource,path:this.state.path,recursive:!0}):this.state.subCategory?t.push({data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,subCategory:this.state.subCategory,subCategory_value:this.state.subCategoryValue}):t.push({data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue});var a=[];G.getState().playlists.forEach(function(n,i){G.getState().APIManager.taliesinApiRequest("POST","/playlist/"+encodeURIComponent(n.name)+"/has_media/",t).then(function(t){a.push(s.a.createElement(S.a,{key:i},s.a.createElement(E.a,{md:10,sm:10,xs:10},s.a.createElement(te.a,null,n.name)),s.a.createElement(E.a,{md:2,sm:2,xs:2},s.a.createElement(_.a,{onClick:function(){return e.handleRemoveFromPlaylist(n.name,i)}},s.a.createElement(L.a,{name:"minus"}))))),e.setState({playlists:a,playlistToLoad:!1})}).fail(function(){a.push(s.a.createElement(S.a,{key:i},s.a.createElement(E.a,{md:10,sm:10,xs:10},s.a.createElement(te.a,null,n.name)),s.a.createElement(E.a,{md:2,sm:2,xs:2},s.a.createElement(_.a,{onClick:function(){return e.handleAddToPlaylist(n.name,i)}},s.a.createElement(L.a,{name:"plus"}))))),e.setState({playlists:a,playlistToLoad:!1})})})}},{key:"handleRemoveFromPlaylist",value:function(e,t){var a,n=this,s=[];this.state.path?(a={data_source:this.state.dataSource,path:this.state.path,recursive:!0},s.push(a)):this.state.subCategory?(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,subCategory:this.state.subCategory,subCategory_value:this.state.subCategoryValue},s.push(a)):(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue},s.push(a)),G.getState().APIManager.taliesinApiRequest("DELETE","/playlist/"+encodeURIComponent(e)+"/delete_media/",s).then(function(e){G.getState().APIManager.taliesinApiRequest("GET","/playlist").then(function(e){G.dispatch({type:"setPlaylists",playlists:e});var a=n.state.playlists;a.splice(t,1),n.setState({playlists:a,playlistToLoad:!0}),G.getState().NotificationManager.addNotification({message:$.t("modal.message_delete_from_playlist_success"),level:"info"})}).fail(function(e){G.dispatch({type:"setPlaylists",playlists:[]}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_refreshing_playlists"),level:"error"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("modal.message_delete_from_playlist_error"),level:"error"})})}},{key:"handleAddToPlaylist",value:function(e,t){var a,n=this,s=[];this.state.path?(a={data_source:this.state.dataSource,path:this.state.path,recursive:!0},s.push(a)):this.state.subCategory?(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,subCategory:this.state.subCategory,subCategory_value:this.state.subCategoryValue},s.push(a)):(a={data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue},s.push(a)),G.getState().APIManager.taliesinApiRequest("PUT","/playlist/"+encodeURIComponent(e)+"/add_media/",s).then(function(e){G.getState().APIManager.taliesinApiRequest("GET","/playlist").then(function(e){G.dispatch({type:"setPlaylists",playlists:e});var a=n.state.playlists;a.splice(t,1),n.setState({playlists:a,playlistToLoad:!0}),G.getState().NotificationManager.addNotification({message:$.t("modal.message_add_to_playlist_success"),level:"info"})}).fail(function(e){G.dispatch({type:"setPlaylists",playlists:[]}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_refreshing_playlists"),level:"error"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("modal.message_add_to_playlist_error"),level:"error"})})}},{key:"render",value:function(){var e=this;return s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,$.t("modal.remove_title"))),s.a.createElement(X.a.Body,null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h4",null,$.t("mainScreen.streams")))),this.state.streamToLoad?s.a.createElement(L.a,{name:"spinner",spin:!0}):"",this.state.streamList,s.a.createElement("hr",null),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h4",null,$.t("mainScreen.playlists")))),this.state.playlistToLoad?s.a.createElement(L.a,{name:"spinner",spin:!0}):"",this.state.playlists),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!0)}},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),ne=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,media:e.media,title:e.title,close:e.onClose,imgBlob:!1,streamList:G.getState().streamList,playlist:G.getState().playlists,removeModalShow:!1},a.onCloseModal=a.onCloseModal.bind(Object(g.a)(Object(g.a)(a))),a.getMediaCover=a.getMediaCover.bind(Object(g.a)(Object(g.a)(a))),a.getMediaFolder=a.getMediaFolder.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectDataSource=a.handleSelectDataSource.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectFolder=a.handleSelectFolder.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectArtist=a.handleSelectArtist.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectAlbum=a.handleSelectAlbum.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectYear=a.handleSelectYear.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectGenre=a.handleSelectGenre.bind(Object(g.a)(Object(g.a)(a))),a.onPlayNow=a.onPlayNow.bind(Object(g.a)(Object(g.a)(a))),a.runPlayNow=a.runPlayNow.bind(Object(g.a)(Object(g.a)(a))),a.addToNewPlaylist=a.addToNewPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onSavePlaylist=a.onSavePlaylist.bind(Object(g.a)(Object(g.a)(a))),a.getMediaFolder(),a.getMediaCover(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({show:e.show,media:e.media?e.media:this.state.media,title:e.title,close:e.onClose,imgBlob:!1,streamList:G.getState().streamList,playlist:G.getState().playlists,removeModalShow:!1},function(){t.getMediaFolder(),t.getMediaCover()})}},{key:"onCloseModal",value:function(){var e=this;this.setState({show:!1},function(){e.state.close&&e.state.close()})}},{key:"onPlayNow",value:function(){var e=this,t=G.getState().streamList.find(function(e){return e.display_name.startsWith("{"+G.getState().profile.currentPlayer.name+"}")});t?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(t.name)+"/manage",{command:"stop"}).then(function(){var a=G.getState().streamList;for(var n in a)if(a[n].name===t.name){a.splice(n,1);break}G.dispatch({type:"setStreamList",streamList:a}),G.getState().profile.stream.name===t.name&&G.dispatch({type:"loadStream",stream:!1}),e.runPlayNow()}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_delete_stream"),level:"error"})}):this.runPlayNow()}},{key:"runPlayNow",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.media.data_source)+"/browse/path/"+encodeURI(this.state.media.path).replace(/#/g,"%23")+"?jukebox&recursive&name={"+G.getState().profile.currentPlayer.name+"} - "+(this.state.media.tags.title||this.state.media.name)).then(function(t){var a=G.getState().streamList;a.push(t),G.dispatch({type:"setStreamList",streamList:a}),G.dispatch({type:"loadStreamAndPlay",stream:t,index:0}),G.getState().NotificationManager.addNotification({message:$.t("common.message_play_stream_ok"),level:"info"}),e.setState({show:!1})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_play"),level:"error"})})}},{key:"getMediaFolder",value:function(){if(this.state.show){var e=this.state.media;e.path?(e.path.lastIndexOf("/")>-1?e.folder=e.path.substring(0,e.path.lastIndexOf("/")):e.folder="",this.setState({media:e})):(e.folder="",this.setState({media:e}))}}},{key:"getMediaCover",value:function(){var e=this;this.state.show&&this.state.media&&this.state.media&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.media.data_source)+"/browse/path/"+encodeURI(this.state.media.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&base64").then(function(t){e.setState({imgBlob:t})}).fail(function(){e.setState({imgBlob:!1})})}},{key:"handleSelectDataSource",value:function(){var e=this;this.setState({show:!1},function(){G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(t){return t.name===e.state.media.data_source})}),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:""})})}},{key:"handleSelectFolder",value:function(){var e=this;this.setState({show:!1},function(){G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(t){return t.name===e.state.media.data_source})}),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:e.state.media.folder})})}},{key:"handleSelectArtist",value:function(e){var t=this;this.setState({show:!1},function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"artist",categoryValue:e})})}},{key:"handleSelectAlbum",value:function(e){var t=this;this.setState({show:!1},function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"album",categoryValue:e})})}},{key:"handleSelectYear",value:function(e){var t=this;this.setState({show:!1},function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"year",categoryValue:e})})}},{key:"handleSelectGenre",value:function(e){var t=this;this.setState({show:!1},function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"genre",categoryValue:e})})}},{key:"addToStream",value:function(e){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage",{command:"append_list",parameters:[{data_source:this.state.media.data_source,path:this.state.media.path}]}).then(function(t){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage",{command:"info"}).then(function(e){G.dispatch({type:"setStream",stream:e}),G.getState().NotificationManager.addNotification({message:$.t("common.message_adding_stream_ok"),level:"info"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_adding_stream"),level:"error"})})}},{key:"addToPlaylist",value:function(e){G.getState().APIManager.taliesinApiRequest("PUT","/playlist/"+encodeURIComponent(e)+"/add_media",[{data_source:this.state.media.data_source,path:this.state.media.path}]).then(function(t){G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(e)).then(function(e){G.dispatch({type:"setPlaylist",playlist:e}),G.getState().NotificationManager.addNotification({message:$.t("common.message_adding_stream_ok"),level:"info"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_adding_stream"),level:"error"})})}},{key:"addToNewPlaylist",value:function(){this.setState({addPlaylistShow:!0})}},{key:"onSavePlaylist",value:function(e,t){var a=this;this.setState({addPlaylistShow:!1},function(){var n;e&&(n=a.state.path?{data_source:a.state.dataSource,path:a.state.path,recursive:!0}:{data_source:a.state.dataSource,category:a.state.category,category_value:a.state.categoryValue,sub_category:a.state.subCategory?a.state.subCategory:void 0,sub_category_value:a.state.subCategoryValue?a.state.subCategoryValue:void 0},t.media=[n],G.getState().APIManager.taliesinApiRequest("POST","/playlist/",t).then(function(){var e=a.state.playlist;e.push(t),G.dispatch({type:"setPlaylists",playlists:e}),a.setState({playlist:e,curPlaylist:!1}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_playlist_added"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_adding_playlist"),level:"error"})}))})}},{key:"render",value:function(){var e,t,a=this,n=[],i="",l="",r=[],o=[s.a.createElement(y.a,{key:0,onClick:function(){return a.addToNewPlaylist()}},$.t("common.new_playlist"))];return this.state.media?(this.state.media.tags&&this.state.media.tags.title&&n.push(s.a.createElement(S.a,{key:0},s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.title"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,this.state.media.tags.title)))),this.state.media.tags&&this.state.media.tags.artist&&n.push(s.a.createElement(S.a,{key:1},s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.artist"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:function(){a.handleSelectArtist(a.state.media.tags.artist)}},this.state.media.tags.artist))))),this.state.media.tags&&this.state.media.tags.album&&n.push(s.a.createElement(S.a,{key:2},s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.album"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:function(){a.handleSelectAlbum(a.state.media.tags.album)}},this.state.media.tags.album))))),this.state.media.tags&&this.state.media.tags.date&&n.push(s.a.createElement(S.a,{key:3},s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.date"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:function(){a.handleSelectYear(a.state.media.tags.date)}},this.state.media.tags.date))))),this.state.media.tags&&this.state.media.tags.genre&&n.push(s.a.createElement(S.a,{key:4},s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.genre"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:function(){a.handleSelectGenre(a.state.media.tags.genre)}},this.state.media.tags.genre))))),n.length&&(l=s.a.createElement(S.a,null,s.a.createElement("hr",null))),this.state.imgBlob&&(i=s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.imgBlob,className:"cover-image-full center-block",responsive:!0})),this.state.streamList.forEach(function(e,t){r.push(s.a.createElement(y.a,{key:t,onClick:function(){return a.addToStream(e.name)}},"- ",e.display_name||$.t("common.no_name")))}),this.state.playlist.forEach(function(e,t){o.push(s.a.createElement(y.a,{key:t+1,onClick:function(){return a.addToPlaylist(e.name)}},"- ",e.name))}),(e=Math.floor(this.state.media.duration/6e4))<10&&(e="0"+e),(t=Math.floor(this.state.media.duration/1e3)%60)<10&&(t="0"+t),s.a.createElement(X.a,{show:this.state.show,onHide:this.onCloseModal},s.a.createElement(X.a.Header,{closeButton:!0},s.a.createElement(X.a.Title,null,s.a.createElement(Z.a,null,s.a.createElement(_.a,{onClick:this.onPlayNow,className:"btn",title:$.t("common.play_now")},s.a.createElement(L.a,{name:"play"})),s.a.createElement(ee.a,{id:"add",title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-plus"}))},s.a.createElement(y.a,null,$.t("common.add_to_stream")),r,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,$.t("common.add_to_playlist")),o,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:function(){a.setState({removeModalShow:!0})}},$.t("common.remove")))),"\xa0",this.state.title)),s.a.createElement(X.a.Body,null,n,l,s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.data_source"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:this.handleSelectDataSource},this.state.media.data_source)))),s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.name"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,this.state.media.name))),s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.duration"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,e,":",t))),s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.nb_play"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,this.state.media.nb_play,"\xa0",$.t("common.times")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.path"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,this.state.media.path))),s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:6},s.a.createElement("label",null,$.t("common.open_folder"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:this.handleSelectFolder},this.state.media.folder||"/")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:12,className:"text-center"},i)),s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{xs:12,className:"text-center"},s.a.createElement(_.a,{onClick:this.onCloseModal,className:"btn btn-success"},$.t("common.close"))))),s.a.createElement(ae,{show:this.state.removeModalShow,onCloseCb:function(){a.setState({removeModalShow:!1})},dataSource:this.state.media.data_source,path:this.state.media.path}))):s.a.createElement("div",null)}}]),t}(n.Component),se=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).uniquePopoverStore={},a.uniqueKey=1,a.state={view:G.getState().profile.view,browse:G.getState().profile.browse,dataSourceList:G.getState().dataSourceList,dataSource:G.getState().profile.dataSource,userList:G.getState().userList,currentUser:G.getState().profile.currentUser,connectedUser:G.getState().profile.connectedUser,searchPattern:"",searchTimeout:!1,searching:!0,searchResult:{},modalShow:!1,modalMedia:!1,modalTitle:""},a.handleSelectCategory=a.handleSelectCategory.bind(Object(g.a)(Object(g.a)(a))),a.handleBrowsePath=a.handleBrowsePath.bind(Object(g.a)(Object(g.a)(a))),a.handleBrowseRecent=a.handleBrowseRecent.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectView=a.handleSelectView.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeSearchPattern=a.handleChangeSearchPattern.bind(Object(g.a)(Object(g.a)(a))),a.handleAdvancedSearch=a.handleAdvancedSearch.bind(Object(g.a)(Object(g.a)(a))),a.handleManageConfig=a.handleManageConfig.bind(Object(g.a)(Object(g.a)(a))),a.simpleSearch=a.simpleSearch.bind(Object(g.a)(Object(g.a)(a))),a.runSimpleSearch=a.runSimpleSearch.bind(Object(g.a)(Object(g.a)(a))),a.getSearchResultCovers=a.getSearchResultCovers.bind(Object(g.a)(Object(g.a)(a))),a.openPlaylist=a.openPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.openStream=a.openStream.bind(Object(g.a)(Object(g.a)(a))),a.openFolder=a.openFolder.bind(Object(g.a)(Object(g.a)(a))),a.openMedia=a.openMedia.bind(Object(g.a)(Object(g.a)(a))),a.closeMedia=a.closeMedia.bind(Object(g.a)(Object(g.a)(a))),a.closeSearch=a.closeSearch.bind(Object(g.a)(Object(g.a)(a))),a.handlechangeLanguage=a.handlechangeLanguage.bind(Object(g.a)(Object(g.a)(a))),a.handlechangeUser=a.handlechangeUser.bind(Object(g.a)(Object(g.a)(a))),G.subscribe(function(){var e=G.getState();"setCurrentDataSource"===e.lastAction?a.setState({dataSource:e.profile.dataSource}):"setDataSourceList"===e.lastAction||"setDataSource"===e.lastAction?a.setState({dataSourceList:e.dataSourceList,dataSource:e.profile.dataSource}):"setCurrentView"===e.lastAction?a.setState({view:e.profile.view}):"setCurrentBrowse"===e.lastAction?a.setState({browse:e.profile.browse}):"setUserList"===e.lastAction?a.setState({userList:e.userList}):"setCurrentUser"===e.lastAction||"setProfile"===e.lastAction?a.setState({currentUser:e.profile.currentUser,connectedUser:e.profile.connectedUser}):"setStoredValues"===e.lastAction&&a.setState({view:G.getState().profile.view})}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.uniqueKey++,this.uniquePopoverStore[this.uniqueKey]=this.refs.myPopover}},{key:"componentWillUnmount",value:function(){delete this.uniquePopoverStore[this.uniqueKey]}},{key:"handleSelectCategory",value:function(e){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentCategory",category:e})}},{key:"handleBrowsePath",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:""})}},{key:"handleBrowseDashboard",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"dashboard"})}},{key:"handleBrowseRecent",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"recent"})}},{key:"handleBrowsePlylist",value:function(){G.dispatch({type:"setCurrentPlaylist",playlist:!1}),G.dispatch({type:"setCurrentBrowse",browse:"playlist"})}},{key:"handleAdvancedSearch",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"advancedSearch"})}},{key:"handleSelectView",value:function(e){G.dispatch({type:"setCurrentView",view:e})}},{key:"handleChangeSearchPattern",value:function(e){var t=this;this.refs.myPopover.hide(),this.setState({searchPattern:e.target.value,searchResult:{}},function(){t.simpleSearch()})}},{key:"simpleSearch",value:function(){this.state.searchTimeout&&clearTimeout(this.state.searchTimeout);var e=setTimeout(this.runSimpleSearch,500);this.setState({searchTimeout:e,searching:!0})}},{key:"runSimpleSearch",value:function(){var e=this;""!==this.state.searchPattern?(this.refs.myPopover.show(),G.getState().APIManager.taliesinApiRequest("GET","/search/?q="+this.state.searchPattern).then(function(t){e.setState({searchResult:t,searching:!1},function(){e.getSearchResultCovers()})}).fail(function(){e.refs.myPopover.hide()})):this.refs.myPopover.hide()}},{key:"closeSearch",value:function(){this.refs.myPopover.hide()}},{key:"getSearchResultCovers",value:function(){var e=this,t=this.state.searchResult;t.playlist&&t.playlist.forEach(function(a,n){a.cover||G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+a.name+"?cover&thumbnail&base64").then(function(n){a.cover=n,e.setState({searchResult:t})})}),t.folder&&t.folder.forEach(function(a){a.cover||G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(a.data_source)+"/browse/path/"+encodeURI(a.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(n){a.cover=n,e.setState({searchResult:t})})}),t.media&&t.media.forEach(function(a){a.cover||G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(a.data_source)+"/browse/path/"+encodeURI(a.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(n){a.cover=n,e.setState({searchResult:t})})})}},{key:"openPlaylist",value:function(e){this.refs.myPopover.hide(),G.dispatch({type:"setCurrentPlaylist",playlist:e}),G.dispatch({type:"setCurrentBrowse",browse:"playlist"})}},{key:"openStream",value:function(e){this.refs.myPopover.hide(),G.dispatch({type:"setStreamDetails",stream:e}),G.dispatch({type:"setCurrentBrowse",browse:"streamDetails"})}},{key:"openFolder",value:function(e){this.refs.myPopover.hide(),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(t){return t.name===e.data_source})}),G.dispatch({type:"setCurrentPath",path:e.path})}},{key:"openMedia",value:function(e){this.refs.myPopover.hide(),this.setState({modalShow:!0,modalMedia:e,modalTitle:e.tags.title||e.name})}},{key:"closeMedia",value:function(){this.setState({modalShow:!1})}},{key:"handlechangeLanguage",value:function(e){$.changeLanguage(e)}},{key:"handlechangeUser",value:function(e){G.dispatch({type:"setCurrentUser",currentUser:e}),G.getState().APIManager.taliesinApiRequest("GET","/data_source").then(function(e){var t=!1;e.length>0&&!e.find(function(e){return e.name===G.getState().profile.dataSource.name})&&(t=e[0]),G.dispatch({type:"setDataSourceList",dataSourceList:e,currentDataSource:t})}).fail(function(e){G.dispatch({type:"setDataSourceList",dataSourceList:[],currentDataSource:!1})}),G.getState().APIManager.taliesinApiRequest("GET","/stream").then(function(e){G.dispatch({type:"setStreamList",streamList:e})}).fail(function(e){G.dispatch({type:"setStreamList",streamList:[]})}),G.getState().APIManager.taliesinApiRequest("GET","/playlist").then(function(e){G.dispatch({type:"setPlaylists",playlists:e})}).fail(function(e){G.dispatch({type:"setPlaylists",playlists:[]})})}},{key:"handleManageConfig",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"manageConfig"})}},{key:"render",value:function(){var e=this,t=[];if(["en","fr"].forEach(function(a,n){a===$.language?t.push(s.a.createElement(y.a,{key:n,className:"bg-success"},a)):t.push(s.a.createElement(y.a,{key:n,onClick:function(){e.handlechangeLanguage(a)}},a))}),"connected"===G.getState().status||"noauth"===G.getState().status){var a,n=s.a.createElement(f.a,{id:"searchResult"},$.t("topmenu.searching")," ",s.a.createElement(L.a,{name:"spinner",spin:!0}));if(!this.state.searching){var i,l,r,o;if(this.state.searchResult.playlist){var c=[];this.state.searchResult.playlist.forEach(function(t,a){var n;a<10&&(t.cover&&(n=s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+t.cover,responsive:!0,style:{maxWidth:"40px",maxHeight:"40px"}})),c.push(s.a.createElement(v.a,{key:a,onClick:function(){e.openPlaylist(t)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:4},n),s.a.createElement(E.a,{xs:8},t.name)))))}),i=s.a.createElement(C.a,{collapsible:!0,defaultExpanded:!0,header:$.t("topmenu.search_result_playlist")},s.a.createElement(k.a,{fill:!0},c))}if(this.state.searchResult.stream){var m=[];this.state.searchResult.stream.forEach(function(t,a){a<10&&m.push(s.a.createElement(v.a,{key:a,onClick:function(){e.openStream(t)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:12},t.display_name))))}),l=s.a.createElement(C.a,{collapsible:!0,defaultExpanded:!0,header:$.t("topmenu.search_result_stream")},s.a.createElement(k.a,{fill:!0},m))}if(this.state.searchResult.folder){var d=[];this.state.searchResult.folder.forEach(function(t,a){var n;a<10&&(t.cover&&(n=s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+t.cover,responsive:!0,style:{maxWidth:"40px",maxHeight:"40px"}})),d.push(s.a.createElement(v.a,{key:a,onClick:function(){e.openFolder(t)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:4},n),s.a.createElement(E.a,{xs:8},t.name)))))}),r=s.a.createElement(C.a,{collapsible:!0,defaultExpanded:!0,header:$.t("topmenu.search_result_folder")},s.a.createElement(k.a,{fill:!0},d))}if(this.state.searchResult.media){var u=[];this.state.searchResult.media.forEach(function(t,a){if(a<10){var n,i=t.name;t.tags&&(i=t.tags.artist?t.tags.artist+" - ":t.tags.album_artist?t.tags.album_artist+" - ":"",t.tags.title?i+=t.tags.title:i+=t.name),t.cover&&(n=s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+t.cover,responsive:!0,style:{maxWidth:"40px",maxHeight:"40px"}})),u.push(s.a.createElement(v.a,{key:a,onClick:function(){e.openMedia(t)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{xs:4},n),s.a.createElement(E.a,{xs:8},i))))}}),o=s.a.createElement(C.a,{collapsible:!0,defaultExpanded:!0,header:$.t("topmenu.search_result_media")},s.a.createElement(k.a,{fill:!0},u))}n=s.a.createElement(f.a,{id:"searchResult"},$.t("topmenu.search_result")," ",s.a.createElement("strong",null,this.state.searchPattern),"\xa0",s.a.createElement(_.a,{title:$.t("topmenu.close"),onClick:this.closeSearch},s.a.createElement(L.a,{name:"close"})),i,l,r,o)}if(G.getState().profile.isAdmin)if("noauth"===G.getState().status)a=s.a.createElement(x.a,{title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"})),id:"nav-view"},s.a.createElement(y.a,{onClick:function(){return e.handleManageConfig()},className:"file"===this.state.browse?"bg-success":""},$.t("topmenu.config")));else{var h=[],p=!1,g=!1;this.state.userList.forEach(function(t,a){t.username===e.state.connectedUser&&(p=!0),e.state.currentUser===t.username?(g=!0,h.push(s.a.createElement(y.a,{key:a,className:"bg-success"},t.username,G.getState().profile.oauth2Profile.login===t.username?" ("+$.t("topmenu.me")+")":""))):h.push(s.a.createElement(y.a,{key:a,onClick:function(){e.handlechangeUser(t.username)}},t.username,G.getState().profile.oauth2Profile.login===t.username?" ("+$.t("topmenu.me")+")":""))}),p||(g?h.push(s.a.createElement(y.a,{key:this.state.userList.length,onClick:function(){e.handlechangeUser(e.state.connectedUser)}},this.state.connectedUser," ("+$.t("topmenu.me")+")")):h.push(s.a.createElement(y.a,{key:this.state.userList.length,className:"bg-success"},this.state.connectedUser," ("+$.t("topmenu.me")+")"))),a=s.a.createElement(x.a,{title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"})),id:"nav-view"},s.a.createElement(y.a,{onClick:function(){return e.handleManageConfig()},className:"file"===this.state.browse?"bg-success":""},$.t("topmenu.config")),s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,$.t("topmenu.change_user")),h)}return s.a.createElement("div",null,s.a.createElement(O.a,{collapseOnSelect:!0},s.a.createElement(O.a.Header,null,s.a.createElement(O.a.Brand,{role:"button",onClick:function(){return e.handleBrowseDashboard()}},"Taliesin"),s.a.createElement(O.a.Toggle,null)),s.a.createElement(O.a.Collapse,null,s.a.createElement(j.a,null,s.a.createElement(x.a,{title:$.t("topmenu.browse"),id:"nav-categories"},s.a.createElement(y.a,{onClick:function(){return e.handleBrowseDashboard()},className:"dashboard"===this.state.browse?"bg-success":""},$.t("topmenu.dashboard")),s.a.createElement(y.a,{onClick:function(){return e.handleBrowsePath()},className:"file"===this.state.browse?"bg-success":""},$.t("topmenu.files")),s.a.createElement(y.a,{onClick:function(){return e.handleBrowsePlylist()},className:"playlist"===this.state.browse?"bg-success":""},$.t("topmenu.playlists")),s.a.createElement(y.a,{onClick:function(){return e.handleBrowseRecent()},className:"recent"===this.state.browse?"bg-success":""},$.t("topmenu.recent")),s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:function(){return e.handleSelectCategory("artist")}},$.t("topmenu.artists")),s.a.createElement(y.a,{onClick:function(){return e.handleSelectCategory("album")}},$.t("topmenu.albums")),s.a.createElement(y.a,{onClick:function(){return e.handleSelectCategory("year")}},$.t("topmenu.years")),s.a.createElement(y.a,{onClick:function(){return e.handleSelectCategory("genre")}},$.t("topmenu.genres"))),s.a.createElement(Y,{list:this.state.dataSourceList,dataSource:this.state.dataSource}),s.a.createElement(x.a,{title:$.t("topmenu.view"),id:"nav-view"},s.a.createElement(y.a,{onClick:function(){e.handleSelectView("list")},className:"list"===this.state.view?"bg-success":""},$.t("topmenu.list")),s.a.createElement(y.a,{onClick:function(){e.handleSelectView("icon")},className:"icon"===this.state.view?"bg-success":""},$.t("topmenu.icon"))),s.a.createElement(w.a,{onClick:function(){return e.handleAdvancedSearch()}},$.t("topmenu.advanced_search"))),s.a.createElement(j.a,{pullRight:!0},a,s.a.createElement(x.a,{title:$.t("topmenu.lang"),id:"nav-view"},t),s.a.createElement(Q,null)),s.a.createElement(O.a.Form,null,s.a.createElement(P.a,null,s.a.createElement(N.a,{ref:"myPopover",container:document.body,trigger:null,placement:"bottom",overlay:n},s.a.createElement(M.a,null,s.a.createElement(A.a,{type:"text",placeholder:$.t("topmenu.search"),value:this.state.searchPattern,onChange:this.handleChangeSearchPattern}),s.a.createElement(M.a.Button,null,s.a.createElement(_.a,{onClick:this.runSimpleSearch},s.a.createElement(L.a,{name:"search"}))))))))),s.a.createElement(ne,{show:this.state.modalShow,media:this.state.modalMedia,title:this.state.modalTitle,onClose:this.closeMedia}))}return s.a.createElement(O.a,{collapseOnSelect:!0},s.a.createElement(O.a.Header,null,s.a.createElement(O.a.Brand,null,"Taliesin"),s.a.createElement(O.a.Toggle,null)),s.a.createElement(O.a.Collapse,null,s.a.createElement(j.a,{pullRight:!0},s.a.createElement(x.a,{title:$.t("topmenu.lang"),id:"nav-view"},t),s.a.createElement(w.a,null,s.a.createElement(L.a,{name:"plug"})," ",$.t("topmenu.connect")),s.a.createElement(Q,null))))}}]),t}(n.Component),ie=a(357),le=a(582),re=a(580),oe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,title:e.title,message:e.message,cb:e.onCloseCb},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({show:e.show,title:e.title,message:e.message,cb:e.onCloseCb})}},{key:"close",value:function(e){var t=this;this.setState({show:!1},function(){t.state.cb&&t.state.cb(e)})}},{key:"render",value:function(){var e=this;return s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,this.state.title)),s.a.createElement(X.a.Body,null,this.state.message),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!0)}},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),ce=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,add:e.add,playlist:e.add?{name:"",description:"",cover:void 0,scope:"me"}:e.playlist,iconPath:"",onCloseCb:e.onCloseCb},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeName=a.handleChangeName.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeDescription=a.handleChangeDescription.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeScope=a.handleChangeScope.bind(Object(g.a)(Object(g.a)(a))),a.getNameValidationState=a.getNameValidationState.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({show:e.show,add:e.add,playlist:e.add?{name:"",description:"",scope:"me"}:e.playlist,iconPath:"",onCloseCb:e.onCloseCb,nameValidateMessage:""})}},{key:"close",value:function(e,t){var a=this;t&&t.preventDefault(),e&&this.state.onCloseCb?this.setState({show:!1},function(){a.state.onCloseCb(!0,a.state.playlist,a.state.add)}):this.setState({show:!1},function(){a.state.onCloseCb(!1,!1,!1)})}},{key:"getNameValidationState",value:function(){var e=this;return this.state.add?this.state.playlist.name?G.getState().playlists.find(function(t){return t.name===e.state.playlist.name})?"error":"success":"error":"success"}},{key:"handleChangeName",value:function(e){var t=this.state.playlist;t.name=e.target.value,this.setState({playlist:t})}},{key:"handleChangeDescription",value:function(e){var t=this.state.playlist;t.description=e.target.value,this.setState({playlist:t})}},{key:"handleChangeScope",value:function(e){var t=this.state.playlist;t.scope=e.target.value,this.setState({playlist:t})}},{key:"render",value:function(){var e,t=this,a=this.state.add?$.t("modal.title_add_playlist"):$.t("modal.title_edit_playlist",{playlist:this.state.playlist.name||""});return e=G.getState().profile.isAdmin&&this.state.add?s.a.createElement(A.a,{value:this.state.playlist.scope,onChange:this.handleChangeScope,disabled:!this.state.add,componentClass:"select",placeholder:$.t("common.select")},s.a.createElement("option",{value:"me"},$.t("common.scope_me")),s.a.createElement("option",{value:"all"},$.t("common.scope_all"))):this.state.add?s.a.createElement("span",null,$.t("common.scope_me")):s.a.createElement("span",null,"me"===this.state.playlist.scope?$.t("common.scope_me"):$.t("common.scope_all")),s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,a)),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(e){t.close(!0,e)}},s.a.createElement(P.a,{controlId:"formName",validationState:this.getNameValidationState()},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.name"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.playlist.name,disabled:!this.state.add,placeholder:$.t("common.name"),onChange:this.handleChangeName})))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.description"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.playlist.description,placeholder:$.t("common.description"),onChange:this.handleChangeDescription}))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.scope"))),s.a.createElement(E.a,{md:8},e)))),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return t.close(!0)},disabled:"success"!==this.getNameValidationState()},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return t.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),me=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,importPath:"",importData:!1,onCloseCb:e.onCloseCb},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.handleUploadFile=a.handleUploadFile.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({show:e.show,importPath:"",importData:!1,onCloseCb:e.onCloseCb})}},{key:"close",value:function(e,t){var a=this;t&&t.preventDefault(),e&&this.state.onCloseCb?this.setState({show:!1},function(){a.state.onCloseCb(!0,a.state.importData)}):this.setState({show:!1},function(){a.state.onCloseCb(!1,!1)})}},{key:"handleUploadFile",value:function(e){var t=e.target.files[0],a=new FileReader,n=this;t.type.indexOf("json")>=0?(a.onload=function(e){n.setState({importData:e.target.result})},a.readAsText(t)):G.getState().NotificationManager.addNotification({message:$.t("modal.import_playlist_file_error"),level:"error"})}},{key:"render",value:function(){var e=this;return s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,$.t("modal.title_import_playlist"))),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(t){e.close(!0,t)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.import_file"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"file",placeholder:$.t("modal.import_file"),onChange:this.handleUploadFile}))))),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!0)}},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),de=a(579),ue=a(366),he=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={name:"",show:e.show,dataSource:e.dataSource,path:e.path,element:e.element,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,playlist:e.playlist,onCloseCb:e.onCloseCb,recursive:!0,random:!0,type:"jukebox",format:G.getState().serverConfig.default_stream_format,channels:G.getState().serverConfig.default_stream_channels,bitrate:G.getState().serverConfig.default_stream_bitrate,sampleRate:G.getState().serverConfig.default_stream_sample_rate,formatDisabled:!1,channelsDisabled:!1,bitrateDisabled:!1,sampleRateDisabled:!1,playNow:!0},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeName=a.handleChangeName.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeRecursive=a.handleChangeRecursive.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeRandom=a.handleChangeRandom.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeType=a.handleChangeType.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeFormat=a.handleChangeFormat.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeChannels=a.handleChangeChannels.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeBitrate=a.handleChangeBitrate.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeSampleRate=a.handleChangeSampleRate.bind(Object(g.a)(Object(g.a)(a))),a.handleChangePlayNow=a.handleChangePlayNow.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({name:"",show:e.show,dataSource:e.dataSource,path:e.path,element:e.element,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,playlist:e.playlist,onCloseCb:e.onCloseCb,recursive:!0,random:!0,type:"jukebox",format:G.getState().serverConfig.default_stream_format,channels:G.getState().serverConfig.default_stream_channels,bitrate:G.getState().serverConfig.default_stream_bitrate,sampleRate:G.getState().serverConfig.default_stream_sample_rate,formatDisabled:!1,channelsDisabled:!1,bitrateDisabled:!1,sampleRateDisabled:!1,playNow:!0})}},{key:"close",value:function(e,t){t&&t.preventDefault(),e?this.state.onCloseCb({name:this.state.name,dataSource:this.state.dataSource,element:this.state.element,path:this.state.path,recursive:this.state.recursive,random:this.state.random,type:this.state.type,format:this.state.format,channels:this.state.channels,bitrate:this.state.bitrate,sampleRate:this.state.sampleRate,playNow:this.state.playNow}):this.state.onCloseCb(!1)}},{key:"handleChangeName",value:function(e){this.setState({name:e.target.value})}},{key:"handleChangeRecursive",value:function(){this.setState({recursive:!this.state.recursive})}},{key:"handleChangeRandom",value:function(){this.setState({random:!this.state.random})}},{key:"handleChangeType",value:function(e){var t={type:e.target.value};"webradio"===e.target.value?(t.format="mp3",t.formatDisabled=!0):t.formatDisabled=!1,this.setState(t)}},{key:"handleChangeFormat",value:function(e){var t={format:e.target.value};"flac"===e.target.value?t.bitrateDisabled=!0:t.bitrateDisabled=!1,this.setState(t)}},{key:"handleChangeChannels",value:function(e){this.setState({channels:e.target.value})}},{key:"handleChangeBitrate",value:function(e){this.setState({bitrate:e.target.value})}},{key:"handleChangeSampleRate",value:function(e){this.setState({sampleRate:e.target.value})}},{key:"handleChangePlayNow",value:function(){this.setState({playNow:!this.state.playNow})}},{key:"render",value:function(){var e,t,a,n=this;if(this.state.element&&"folder"===this.state.element.type&&(e=s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,"Recursive")),s.a.createElement(E.a,{md:8},s.a.createElement(de.a,{type:"checkbox",value:this.state.recursive,onChange:this.handleChangeRecursive},s.a.createElement(ue.a,{value:!0},$.t("modal.recursive")),s.a.createElement(ue.a,{value:!1},$.t("modal.non_recursive"))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))))),this.state.path)a=s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.path"))),s.a.createElement(E.a,{md:8},this.state.dataSource+" - "+this.state.path)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))));else if(this.state.playlist)a=s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.playlist"))),s.a.createElement(E.a,{md:8},this.state.playlist.name)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))));else{var i=this.state.category+" / "+this.state.categoryValue;this.state.subCategory&&(i+=" / "+this.state.subCategory+" / "+this.state.subCategoryValue),a=s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.category"))),s.a.createElement(E.a,{md:8},i)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))))}return"webradio"===this.state.type&&(t=s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.random"))),s.a.createElement(E.a,{md:8},s.a.createElement(de.a,{type:"checkbox",value:this.state.random,onChange:this.handleChangeRandom},s.a.createElement(ue.a,{value:!0},$.t("common.random")),s.a.createElement(ue.a,{value:!1},$.t("common.non_random"))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))))),s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,$.t("modal.create_stream"))),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(e){n.close(!0,e)}},a,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.stream_name"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.name,placeholder:$.t("modal.name"),onChange:this.handleChangeName}))),s.a.createElement("hr",null),e,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.play_as"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{componentClass:"select",placeholder:"select",value:this.state.type,onChange:this.handleChangeType},s.a.createElement("option",{value:"jukebox"},$.t("common.jukebox")),s.a.createElement("option",{value:"webradio"},$.t("common.webradio"))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),t,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.format"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("common.select"),value:this.state.format,onChange:this.handleChangeFormat,disabled:this.state.formatDisabled},s.a.createElement("option",{value:"mp3"},$.t("common.format_mp3")),s.a.createElement("option",{value:"vorbis"},$.t("common.format_ogg")),s.a.createElement("option",{value:"flac"},$.t("common.format_flac"))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.channels"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("common.select"),value:this.state.channels,onChange:this.handleChangeChannels,disabled:this.state.channelsDisabled},s.a.createElement("option",{value:"1"},$.t("common.channels_mono")),s.a.createElement("option",{value:"2"},$.t("common.channels_stereo"))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.bitrate"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("common.select"),value:this.state.bitrate,onChange:this.handleChangeBitrate,disabled:this.state.bitrateDisabled},s.a.createElement("option",{value:"32000"},$.t("common.bitrate_bps",{bps:32})),s.a.createElement("option",{value:"96000"},$.t("common.bitrate_bps",{bps:96})),s.a.createElement("option",{value:"128000"},$.t("common.bitrate_bps",{bps:128})),s.a.createElement("option",{value:"192000"},$.t("common.bitrate_bps",{bps:192})),s.a.createElement("option",{value:"256000"},$.t("common.bitrate_bps",{bps:256})),s.a.createElement("option",{value:"320000"},$.t("common.bitrate_bps",{bps:320}))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.sample_rate"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("common.select"),value:this.state.sampleRate,onChange:this.handleChangeSampleRate,disabled:this.state.sampleRateDisabled},s.a.createElement("option",{value:"8000"},$.t("common.sample_rate_khz",{khz:8})),s.a.createElement("option",{value:"11025"},$.t("common.sample_rate_khz",{khz:11})),s.a.createElement("option",{value:"22050"},$.t("common.sample_rate_khz",{khz:22})),s.a.createElement("option",{value:"32000"},$.t("common.sample_rate_khz",{khz:32})),s.a.createElement("option",{value:"44100"},$.t("common.sample_rate_khz",{khz:44.1})),s.a.createElement("option",{value:"48000"},$.t("common.sample_rate_khz",{khz:48}))))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.play_now_current_player"))),s.a.createElement(E.a,{md:8},s.a.createElement(de.a,{type:"checkbox",value:this.state.playNow,onChange:this.handleChangePlayNow},s.a.createElement(ue.a,{value:!0},$.t("common.yes")),s.a.createElement(ue.a,{value:!1},$.t("common.no"))))))),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return n.close(!0)}},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return n.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),pe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={playlist:G.getState().playlists,streamList:G.getState().streamList,curPlaylist:{},isAdmin:G.getState().profile.isAdmin,shownPlaylist:{},addPlaylistShow:!1,importPlaylistShow:!1,modalEditShow:!1,modalDeleteShow:!1,editStreamShow:!1,add:!1,modalDeleteMessage:"",showPlaylist:!1,playlistToShow:e.playlist,mediaList:[],offset:0,limit:100},G.subscribe(function(){var e=G.getState();"setPlaylists"!==e.lastAction&&"setPlaylist"!==e.lastAction||!a._ismounted?"setStreamList"!==e.lastAction&&"setStream"!==e.lastAction||!a._ismounted||a.setState({streamList:e.streamList}):a.setState({playlist:e.playlists})}),a.canUpdate=a.canUpdate.bind(Object(g.a)(Object(g.a)(a))),a.playNow=a.playNow.bind(Object(g.a)(Object(g.a)(a))),a.playAdvanced=a.playAdvanced.bind(Object(g.a)(Object(g.a)(a))),a.runPlaylistAdvanced=a.runPlaylistAdvanced.bind(Object(g.a)(Object(g.a)(a))),a.showPlaylist=a.showPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.showList=a.showList.bind(Object(g.a)(Object(g.a)(a))),a.addPlaylist=a.addPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onAddPlaylist=a.onAddPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.editPlaylist=a.editPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.exportPlaylist=a.exportPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.importPlaylist=a.importPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.deletePlaylist=a.deletePlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onEditPlaylist=a.onEditPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onDeletePlaylist=a.onDeletePlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onImportPlaylist=a.onImportPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onCloseStreamModal=a.onCloseStreamModal.bind(Object(g.a)(Object(g.a)(a))),a.onSavePlaylist=a.onSavePlaylist.bind(Object(g.a)(Object(g.a)(a))),a.getMediaCovers=a.getMediaCovers.bind(Object(g.a)(Object(g.a)(a))),a.getMediaCover=a.getMediaCover.bind(Object(g.a)(Object(g.a)(a))),a.deleteMedia=a.deleteMedia.bind(Object(g.a)(Object(g.a)(a))),a.refreshPlaylists=a.refreshPlaylists.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({playlist:G.getState().playlists,curPlaylist:{},isAdmin:G.getState().profile.isAdmin,shownPlaylist:{},addPlaylistShow:!1,importPlaylistShow:!1,modalEditShow:!1,modalDeleteShow:!1,editStreamShow:!1,add:!1,modalDeleteMessage:"",showPlaylist:!1,playlistToShow:e.playlist,mediaList:[],offset:0,limit:100},function(){if(t.state.playlistToShow){var e=t.state.playlistToShow;t.setState({playlistToShow:!1},function(){t.showPlaylist(e)})}})}},{key:"componentDidMount",value:function(){var e=this;if(this._ismounted=!0,this.state.playlistToShow){var t=this.state.playlistToShow;this.setState({playlistToShow:!1},function(){e.showPlaylist(t)})}}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"showPlaylist",value:function(e){var t=this;this._ismounted&&G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+e.name+"?offset="+this.state.offset+"&limit="+this.state.limit).then(function(a){t.setState({showPlaylist:!0,shownPlaylist:e,mediaList:a.media},function(){t.getMediaCovers()})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_getting_playlist"),level:"error"})})}},{key:"showList",value:function(){this._ismounted&&this.setState({showPlaylist:!1,shownPlaylist:{},mediaList:[]})}},{key:"getMediaCovers",value:function(){var e=this.state.mediaList;for(var t in e)this.getMediaCover(e[t])}},{key:"getMediaCover",value:function(e){var t=this;this._ismounted&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+e.data_source+"/browse/path/"+e.path+"?cover&thumbnail&base64").then(function(a){var n=t.state.mediaList;for(var s in n)n[s].data_source===e.data_source&&n[s].path===e.path&&(n[s].cover=a,t.setState({mediaList:n}))})}},{key:"addPlaylist",value:function(){this._ismounted&&this.setState({addPlaylistShow:!0,add:!0})}},{key:"onAddPlaylist",value:function(e){var t=this;e&&this._ismounted&&G.getState().APIManager.taliesinApiRequest("POST","/playlist/",e).then(function(){var a=t.state.playlist;a.push(e),G.dispatch({type:"setPlaylists",playlists:a}),t.setState({playlist:a,curPlaylist:!1}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_playlist_added"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_adding_playlist"),level:"error"})})}},{key:"onSavePlaylist",value:function(e,t,a){var n=this;this._ismounted&&(e?a?this.setState({addPlaylistShow:!1},function(){n.onAddPlaylist(t)}):this.setState({addPlaylistShow:!1},function(){n.onEditPlaylist(t)}):this.setState({addPlaylistShow:!1}))}},{key:"canUpdate",value:function(e){return this.state.isAdmin||"me"===e.scope}},{key:"playNow",value:function(e){var t=this,a=G.getState().streamList.find(function(e){return e.display_name.startsWith("{"+G.getState().profile.currentPlayer.name+"}")});a?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(a.name)+"/manage",{command:"stop"}).then(function(){var n=G.getState().streamList;for(var s in n)if(n[s].name===a.name){n.splice(s,1);break}G.dispatch({type:"setStreamList",streamList:n}),G.getState().profile.stream.name===a.name&&G.dispatch({type:"loadStream",stream:!1}),t.runPlayElement(e)}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_delete_stream"),level:"error"})}):this.runPlayElement(e)}},{key:"runPlayElement",value:function(e){G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(e.name)+"/load?jukebox&name={"+G.getState().profile.currentPlayer.name+"} - "+e.name).then(function(e){var t=G.getState().streamList;t.push(e),G.dispatch({type:"setStreamList",streamList:t}),G.dispatch({type:"loadStreamAndPlay",stream:e,index:0}),G.getState().NotificationManager.addNotification({message:$.t("common.message_play_stream_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_play"),level:"error"})})}},{key:"playAdvanced",value:function(e){this._ismounted&&this.setState({curPlaylist:e,editStreamShow:!0})}},{key:"runPlaylistAdvanced",value:function(e){e&&G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(this.state.curPlaylist.name)+"/load?"+e.type+(e.recursive?"&recursive":"")+"&format="+e.format+"&channels="+e.channels+"&bitrate="+e.bitrate+"&samplerate="+e.sampleRate+(e.random?"&random":"")+"&name="+this.state.curPlaylist.name).then(function(t){var a=G.getState().streamList;a.push(t),G.dispatch({type:"setStreamList",streamList:a}),G.dispatch({type:e.playNow?"loadStreamAndPlay":"loadStream",stream:t,index:0})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_play_stream"),level:"error"})}),this.setState({editStreamShow:!1})}},{key:"editPlaylist",value:function(e){this._ismounted&&this.setState({addPlaylistShow:!0,add:!1,curPlaylist:e})}},{key:"onEditPlaylist",value:function(e){var t=this;e&&this._ismounted&&G.getState().APIManager.taliesinApiRequest("PUT","/playlist/"+e.name,e).then(function(){var a=t.state.playlist;for(var n in a)a[n].name===e.name&&(a[n]=e);G.dispatch({type:"setPlaylists",playlists:a}),t.setState({playlist:a,curPlaylist:!1}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_playlist_updated"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_updating_playlist"),level:"error"})})}},{key:"deletePlaylist",value:function(e){this._ismounted&&this.setState({modalDeleteShow:!0,modalDeleteMessage:$.t("playlist.message_confirm_delete",{playlist:e.name}),curPlaylist:e})}},{key:"onDeletePlaylist",value:function(e){var t=this;e&&this._ismounted&&G.getState().APIManager.taliesinApiRequest("DELETE","/playlist/"+encodeURIComponent(this.state.curPlaylist.name)).then(function(e){var a=t.state.playlist;a.splice(t.state.playlist.indexOf(t.state.curPlaylist),1),G.dispatch({type:"setPlaylists",playlists:a}),t.setState({modalDeleteShow:!1,playlist:a,curPlaylist:!1}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_playlist_deleted"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_delete_playlist"),level:"error"})})}},{key:"exportPlaylist",value:function(e){this._ismounted&&G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(e.name)+"/export").then(function(t){var a="data:application/octet-stream;base64,"+window.btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n=document.getElementById("downloadAnchor");n.setAttribute("href",a),n.setAttribute("download",e.name+".json"),n.click()}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_export_playlist"),level:"error"})})}},{key:"importPlaylist",value:function(e){this._ismounted&&this.setState({importPlaylistShow:!0,curPlaylist:e})}},{key:"onImportPlaylist",value:function(e,t){var a=this;this.setState({importPlaylistShow:!1},function(){e&&a._ismounted&&G.getState().APIManager.taliesinApiRequest("PUT","/playlist/"+encodeURIComponent(a.state.curPlaylist.name)+"/add_media",JSON.parse(t)).then(function(){a.refreshPlaylists()}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_import_playlist"),level:"error"})})})}},{key:"onCloseStreamModal",value:function(e){this._ismounted&&(e&&G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(this.state.curPlaylist.name)+"/load?"+e.type+"&format="+e.format+"&channels="+e.channels+"&bitrate="+e.bitrate+"&sample_rate="+e.sampleRate).then(function(e){var t=G.getState().streamList;t.push(e),G.dispatch({type:"setStreamList",streamList:t}),G.dispatch({type:"loadStream",stream:e}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_play_playlist_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlists.message_error_play_playlist"),level:"error"})}),this.setState({editStreamShow:!1}))}},{key:"deleteMedia",value:function(e){var t=this;this._ismounted&&G.getState().APIManager.taliesinApiRequest("DELETE","/playlist/"+this.state.shownPlaylist.name,{data_source:e.data_source,path:e.path}).then(function(){var a=t.state.mediaList;a.splice(a.indexOf(e),1),t.setState({mediaList:a})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_delete_media"),level:"error"})})}},{key:"refreshPlaylists",value:function(){G.getState().APIManager.taliesinApiRequest("GET","/playlist").then(function(e){G.dispatch({type:"setPlaylists",playlists:e}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_playlists_refreshed"),level:"info"})}).fail(function(e){G.dispatch({type:"setPlaylists",playlists:[]}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_refreshing_playlists"),level:"error"})})}},{key:"addToStream",value:function(e,t){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage",{command:"append_list",parameters:[{playlist:t}]}).then(function(t){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage",{command:"info"}).then(function(e){G.dispatch({type:"setStream",stream:e}),G.getState().NotificationManager.addNotification({message:$.t("common.message_adding_stream_ok"),level:"info"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_adding_stream"),level:"error"})})}},{key:"addToPlaylist",value:function(e,t){G.getState().APIManager.taliesinApiRequest("PUT","/playlist/"+encodeURIComponent(e)+"/add_media",[{playlist:t}]).then(function(t){G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(e)).then(function(e){G.dispatch({type:"setPlaylist",playlist:e}),G.getState().NotificationManager.addNotification({message:$.t("common.message_adding_stream_ok"),level:"info"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_adding_stream"),level:"error"})})}},{key:"render",value:function(){var e=this;if(this.state.showPlaylist){var t=[];return this.state.mediaList.forEach(function(a,n){var i;a.cover&&(i=s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+a.cover,responsive:!0,style:{maxWidth:"100px",maxHeight:"100px"}})),t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,i),s.a.createElement("td",null,a.data_source),s.a.createElement("td",null,a.path),s.a.createElement("td",null,s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("playlist.delete_element"),onClick:function(){return e.deleteMedia(a)}},s.a.createElement(L.a,{name:"trash"}))))))}),s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12,sm:12,xs:12},s.a.createElement(_.a,{title:$.t("playlist.show_all_playlists"),onClick:function(){return e.showList()}},s.a.createElement(L.a,{name:"list"})))),s.a.createElement(re.a,{striped:!0,bordered:!0,condensed:!0,hover:!0},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,$.t("common.cover")),s.a.createElement("th",null,$.t("common.data_source")),s.a.createElement("th",null,$.t("common.path")),s.a.createElement("th",null))),s.a.createElement("tbody",null,t)))}var a=[];return this.state.playlist.forEach(function(t,n){var i=[],l=[];e.state.streamList.forEach(function(a,n){i.push(s.a.createElement(y.a,{key:n,onClick:function(){return e.addToStream(a.name,t.name)}},"- ",a.display_name||$.t("common.no_name")))}),e.state.playlist.forEach(function(a,n){a.name!==t.name&&l.push(s.a.createElement(y.a,{key:n+1,onClick:function(){return e.addToPlaylist(a.name,t.name)}},"- ",a.name))}),a.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){return e.showPlaylist(t)}},t.name)),s.a.createElement("td",{className:"hidden-xs"},t.description),s.a.createElement("td",{className:"hidden-xs"},t.elements||"N/A"),s.a.createElement("td",null,"all"===t.scope?s.a.createElement(L.a,{name:"users"}):s.a.createElement(L.a,{name:"user"})),s.a.createElement("td",{className:"text-center"},s.a.createElement(Z.a,{className:"hidden-xs"},s.a.createElement(_.a,{title:$.t("common.play_now"),onClick:function(){e.playNow(t)}},s.a.createElement(L.a,{name:"play"})),s.a.createElement(_.a,{title:$.t("common.create_stream"),onClick:function(){e.playAdvanced(t)}},s.a.createElement(L.a,{name:"play"}),"\xa0",s.a.createElement(L.a,{name:"cog"})),s.a.createElement(_.a,{title:$.t("common.edit"),onClick:function(){return e.editPlaylist(t)},disabled:!e.canUpdate(t)},s.a.createElement(L.a,{name:"pencil"})),s.a.createElement(_.a,{title:$.t("common.save"),onClick:function(){return e.exportPlaylist(t)}},s.a.createElement(L.a,{name:"save"})),s.a.createElement(_.a,{title:$.t("common.import"),onClick:function(){return e.importPlaylist(t)}},s.a.createElement(L.a,{name:"upload"})),s.a.createElement(ee.a,{id:"add-playlist",pullRight:!0,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-plus"}))},s.a.createElement(y.a,null,$.t("common.add_to_stream")),i,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,$.t("common.add_to_playlist")),l),s.a.createElement(_.a,{title:$.t("common.delete"),onClick:function(){return e.deletePlaylist(t)},disabled:!e.canUpdate(t)},s.a.createElement(L.a,{name:"trash"}))),s.a.createElement(ee.a,{className:"visible-xs",id:"xs-manage-"+t.name,pullRight:!0,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"}))},s.a.createElement(y.a,{onClick:function(){e.playNow(t)}},s.a.createElement(L.a,{name:"play"}),"\xa0",$.t("common.play_now")),s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:function(){e.playAdvanced(t)}},s.a.createElement(L.a,{name:"play"}),s.a.createElement(L.a,{name:"cog"}),"\xa0",$.t("common.create_stream")),s.a.createElement(y.a,{onClick:function(){return e.editPlaylist(t)},disabled:!e.canUpdate(t)},s.a.createElement(L.a,{name:"pencil"}),"\xa0",$.t("common.edit")),s.a.createElement(y.a,{onClick:function(){return e.exportPlaylist(t)}},s.a.createElement(L.a,{name:"save"}),"\xa0",$.t("common.save")),s.a.createElement(y.a,{onClick:function(){return e.importPlaylist(t)}},s.a.createElement(L.a,{name:"upload"}),"\xa0",$.t("common.import")),s.a.createElement(y.a,null,s.a.createElement(L.a,{name:"plus"}),"\xa0",$.t("common.add_to_stream")),i,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,s.a.createElement(L.a,{name:"plus"}),"\xa0",$.t("common.add_to_playlist")),l,s.a.createElement(y.a,{onClick:function(){return e.deletePlaylist(t)},disabled:!e.canUpdate(t)},s.a.createElement(L.a,{name:"trash"}),"\xa0",$.t("common.delete"))))))}),s.a.createElement("div",null,s.a.createElement("a",{href:"exportPlaylist",name:"downloadAnchor",id:"downloadAnchor",className:"hidden"},"#"),s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("playlist.add_playlist"),onClick:function(){return e.addPlaylist()}},s.a.createElement(L.a,{name:"plus"})),s.a.createElement(_.a,{title:$.t("playlist.refresh_list"),onClick:function(){return e.refreshPlaylists()}},s.a.createElement(L.a,{name:"refresh"}))),s.a.createElement(re.a,{striped:!0,bordered:!0,condensed:!0,hover:!0},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,$.t("common.name")),s.a.createElement("th",{className:"hidden-xs"},$.t("common.description")),s.a.createElement("th",{className:"hidden-xs"},$.t("common.elements")),s.a.createElement("th",null,$.t("common.scope")),s.a.createElement("th",null))),s.a.createElement("tbody",null,a)),s.a.createElement(oe,{show:this.state.modalDeleteShow,title:$.t("playlist.delete_playlist"),message:this.state.modalDeleteMessage,onCloseCb:this.onDeletePlaylist}),s.a.createElement(ce,{show:this.state.addPlaylistShow,onCloseCb:this.onSavePlaylist,add:this.state.add,playlist:this.state.curPlaylist}),s.a.createElement(me,{show:this.state.importPlaylistShow,onCloseCb:this.onImportPlaylist}),s.a.createElement(he,{show:this.state.editStreamShow,playlist:this.state.curPlaylist,onCloseCb:this.runPlaylistAdvanced}))}}]),t}(n.Component),ge=a(581),ye=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,title:e.title,message:e.message,value:e.value,cb:e.onCloseCb},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.handleChange=a.handleChange.bind(Object(g.a)(Object(g.a)(a))),a.getValidationState=a.getValidationState.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({show:e.show,title:e.title,message:e.message,value:e.value,cb:e.onCloseCb})}},{key:"close",value:function(e,t){var a=this;t&&t.preventDefault(),this.setState({show:!1},function(){a.state.cb&&a.state.cb(!!e&&a.state.value)})}},{key:"getValidationState",value:function(){return this.state.value&&this.state.value.length?"success":"error"}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){var e=this;return s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,this.state.title)),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(t){e.close(!0,t)}},s.a.createElement(P.a,{controlId:"formBasicText",validationState:this.getValidationState()},s.a.createElement(ge.a,null,this.state.message),s.a.createElement(A.a,{type:"text",value:this.state.value,placeholder:$.t("common.value"),onChange:this.handleChange}),s.a.createElement(A.a.Feedback,null)))),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!0)}},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),fe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={streamList:G.getState().streamList,modalConfirmShow:!1,modalRenameShow:!1,modalSaveShow:!1,modalTitle:"",modalMessage:"",modalValue:"",curStream:!1},G.subscribe(function(){var e=G.getState();"setStreamList"!==e.lastAction&&"setStream"!==e.lastAction||!a._ismounted||a.setState({streamList:e.streamList},function(){a.buildStreamExternalList()})}),a.playStream=a.playStream.bind(Object(g.a)(Object(g.a)(a))),a.playStreamExternal=a.playStreamExternal.bind(Object(g.a)(Object(g.a)(a))),a.deleteStream=a.deleteStream.bind(Object(g.a)(Object(g.a)(a))),a.renameStream=a.renameStream.bind(Object(g.a)(Object(g.a)(a))),a.saveStream=a.saveStream.bind(Object(g.a)(Object(g.a)(a))),a.detailsStream=a.detailsStream.bind(Object(g.a)(Object(g.a)(a))),a.reloadStream=a.reloadStream.bind(Object(g.a)(Object(g.a)(a))),a.resetStream=a.resetStream.bind(Object(g.a)(Object(g.a)(a))),a.confirmDelete=a.confirmDelete.bind(Object(g.a)(Object(g.a)(a))),a.confirmRename=a.confirmRename.bind(Object(g.a)(Object(g.a)(a))),a.confirmSave=a.confirmSave.bind(Object(g.a)(Object(g.a)(a))),a.reloadStreamList=a.reloadStreamList.bind(Object(g.a)(Object(g.a)(a))),a.buildStreamExternalList=a.buildStreamExternalList.bind(Object(g.a)(Object(g.a)(a))),a.buildStreamExternal=a.buildStreamExternal.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({streamList:G.getState().streamList,modalConfirmShow:!1,modalRenameShow:!1,modalSaveShow:!1,modalTitle:"",modalMessage:"",modalValue:"",curStream:!1})}},{key:"componentDidMount",value:function(){this._ismounted=!0,this.buildStreamExternalList()}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"buildStreamExternalList",value:function(){var e=this,t=this.state.streamList;t.forEach(function(t){t.external=e.buildStreamExternal(t)}),this.setState({streamList:t})}},{key:"buildStreamExternal",value:function(e){return e?e.webradio?"data:application/mpegurl;base64,"+btoa("#EXTM3U\n\n#EXTINF:0,"+(e.display_name||"no name")+"\n"+G.getState().taliesinApiUrl+"/stream/"+e.name+"\n"):G.getState().taliesinApiUrl+"/stream/"+e.name:""}},{key:"playStream",value:function(e){G.dispatch({type:"loadStreamAndPlay",stream:e,index:0})}},{key:"deleteStream",value:function(e){this.setState({modalConfirmShow:!0,modalTitle:$.t("stream.remove_title"),modalMessage:$.t("stream.remove_message",{stream:e.display_name||$.t("common.no_name")}),curStream:e})}},{key:"renameStream",value:function(e){this.setState({modalRenameShow:!0,modalTitle:$.t("stream.rename_title"),modalMessage:$.t("stream.rename_message",{stream:e.display_name||$.t("common.no_name")}),modalValue:e.display_name,curStream:e})}},{key:"saveStream",value:function(e){this.setState({modalSaveShow:!0,modalTitle:$.t("stream.save_as_playlist_title"),modalMessage:$.t("stream.save_as_playlist_message",{stream:e.display_name||$.t("common.no_name")}),modalValue:e.display_name,curStream:e})}},{key:"detailsStream",value:function(e){G.dispatch({type:"setStreamDetails",stream:e}),G.dispatch({type:"setCurrentBrowse",browse:"streamDetails"})}},{key:"reloadStream",value:function(e){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e.name)+"/manage",{command:"reload"}).then(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reload_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reload_error"),level:"error"})})}},{key:"resetStream",value:function(e){var t=this;G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e.name)+"/manage",{command:"reset_url"}).then(function(a){var n=G.getState().streamList;for(var s in n)if(n[s].name===e.name){n[s].name=a.name;break}G.dispatch({type:"setStreamList",streamList:n}),t.setState({streamList:n}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reset_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reset_error"),level:"error"})})}},{key:"confirmDelete",value:function(e){var t=this;e?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.curStream.name)+"/manage",{command:"stop"}).then(function(){var e=G.getState().streamList;for(var a in e)if(e[a].name===t.state.curStream.name){e.splice(a,1);break}G.dispatch({type:"setStreamList",streamList:e}),G.getState().profile.stream.name===t.state.curStream.name&&G.dispatch({type:"loadStream",stream:!1}),t.setState({streamList:e,modalConfirmShow:!1}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_delete_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_delete_error"),level:"error"}),t.setState({modalConfirmShow:!1})}):this.setState({modalConfirmShow:!1})}},{key:"confirmRename",value:function(e){var t=this;e?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.curStream.name)+"/manage",{command:"rename",parameters:{name:e}}).then(function(){var a=G.getState().streamList;for(var n in a)if(a[n].name===t.state.curStream.name){a[n].display_name=e;break}G.dispatch({type:"setStreamList",streamList:a}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_rename_ok"),level:"info"}),t.setState({streamList:a,modalRenameShow:!1})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_rename_error"),level:"error"}),t.setState({modalRenameShow:!1})}):this.setState({modalRenameShow:!1})}},{key:"confirmSave",value:function(e){var t=this;e?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.curStream.name)+"/manage",{command:"save",parameters:{name:e}}).then(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_save_ok"),level:"info"}),t.setState({modalSaveShow:!1})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_save_error"),level:"error"}),t.setState({modalSaveShow:!1})}):this.setState({modalSaveShow:!1})}},{key:"reloadStreamList",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("GET","/stream").then(function(t){G.dispatch({type:"setStreamList",streamList:t}),e.setState({streamList:t}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_list_reload_ok"),level:"info"})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_list_reload_error"),level:"error"})})}},{key:"playStreamExternal",value:function(e){V()("#play-external-anchor-"+e.name)[0].click()}},{key:"render",value:function(){var e=this,t=[];return this.state.streamList.forEach(function(a,n){var i,l;a.webradio?(i=$.t("common.webradio"),a.random&&(l=s.a.createElement(L.a,{name:"random"}))):i=$.t("common.jukebox"),t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){return e.detailsStream(a)}},a.display_name||$.t("common.no_name"))),s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){return e.detailsStream(a)}},i," ",l)),s.a.createElement("td",{className:"hidden-xs"},s.a.createElement("a",{role:"button",onClick:function(){return e.detailsStream(a)}},a.elements)),s.a.createElement("td",{className:"hidden-xs"},s.a.createElement("a",{role:"button",onClick:function(){return e.detailsStream(a)}},a.format+" - "+(a.stereo?$.t("common.stereo"):$.t("common.mono"))+" - "+a.sample_rate+" "+$.t("common.khz")+" - "+a.bitrate/1e3+" "+$.t("common.bps"))),s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){return e.detailsStream(a)}},a.clients&&a.clients.length||0)),s.a.createElement("td",{className:"text-center"},s.a.createElement("a",{href:a.external,style:{display:"none"},id:"play-external-anchor-"+a.name,download:(a.display_name||$.t("common.no_name"))+".m3u"},$.t("common.external")),s.a.createElement(Z.a,{className:"hidden-xs hidden-sm"},s.a.createElement(_.a,{title:$.t("common.play_now"),onClick:function(){return e.playStream(a)}},s.a.createElement(L.a,{name:"play"})),s.a.createElement(_.a,{title:$.t("common.external"),onClick:function(){return e.playStreamExternal(a)}},s.a.createElement(L.a,{name:"external-link"})),s.a.createElement(_.a,{title:$.t("common.rename"),onClick:function(){return e.renameStream(a)}},s.a.createElement(L.a,{name:"pencil"})),s.a.createElement(_.a,{title:$.t("stream.save_as_playlist"),onClick:function(){return e.saveStream(a)}},s.a.createElement(L.a,{name:"floppy-o"})),s.a.createElement(_.a,{title:$.t("stream.reload"),onClick:function(){return e.reloadStream(a)}},s.a.createElement(L.a,{name:"exchange"})),s.a.createElement(_.a,{title:$.t("stream.reset_url"),onClick:function(){return e.resetStream(a)}},s.a.createElement(L.a,{name:"unlock-alt"})),s.a.createElement(_.a,{title:$.t("stream.delete"),onClick:function(){return e.deleteStream(a)}},s.a.createElement(L.a,{name:"trash"}))),s.a.createElement(ee.a,{className:"visible-xs visible-sm",id:"xs-manage-"+a.name,pullRight:!0,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"}))},s.a.createElement(y.a,{onClick:function(){return e.playStream(a)}},s.a.createElement(L.a,{name:"play"}),"\xa0",$.t("common.play_now")),s.a.createElement(y.a,{onClick:function(){return e.playStreamExternal(a)}},s.a.createElement(L.a,{name:"external-link"}),"\xa0",$.t("common.external")),s.a.createElement(y.a,{onClick:function(){return e.renameStream(a)}},s.a.createElement(L.a,{name:"pencil"}),"\xa0",$.t("common.rename")),s.a.createElement(y.a,{onClick:function(){return e.saveStream(a)}},s.a.createElement(L.a,{name:"floppy-o"}),"\xa0",$.t("stream.save_as_playlist")),s.a.createElement(y.a,{onClick:function(){return e.reloadStream(a)}},s.a.createElement(L.a,{name:"exchange"}),"\xa0",$.t("stream.reload")),s.a.createElement(y.a,{onClick:function(){return e.resetStream(a)}},s.a.createElement(L.a,{name:"unlock-alt"}),"\xa0",$.t("stream.reset_url")),s.a.createElement(y.a,{onClick:function(){return e.deleteStream(a)}},s.a.createElement(L.a,{name:"trash"}),"\xa0",$.t("stream.delete"))))))}),s.a.createElement("div",null,s.a.createElement(_.a,{title:$.t("stream.reload"),onClick:this.reloadStreamList},s.a.createElement(L.a,{name:"refresh"})),s.a.createElement(re.a,{striped:!0,bordered:!0,condensed:!0,hover:!0},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,$.t("common.name")),s.a.createElement("th",null,$.t("common.type")),s.a.createElement("th",{className:"hidden-xs"},$.t("common.elements")),s.a.createElement("th",{className:"hidden-xs"},$.t("stream.format")),s.a.createElement("th",null,$.t("stream.clients")),s.a.createElement("th",null))),s.a.createElement("tbody",null,t)),s.a.createElement(oe,{show:this.state.modalConfirmShow,title:this.state.modalTitle,message:this.state.modalMessage,onCloseCb:this.confirmDelete}),s.a.createElement(ye,{show:this.state.modalRenameShow,title:this.state.modalTitle,message:this.state.modalMessage,onCloseCb:this.confirmRename,value:this.state.modalValue}),s.a.createElement(ye,{show:this.state.modalSaveShow,title:this.state.modalTitle,message:this.state.modalMessage,onCloseCb:this.confirmSave,value:this.state.modalValue}))}}]),t}(n.Component),be=a(65),ve=a.n(be),Se=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e)))._ismounted=!1,a.state={show:e.show,dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,categoryContent:{},categoryContentEdit:{},iconPath:"",onCloseCb:e.onCloseCb,edit:!1},a.loadCategoryContent(),a.loadCategoryContent=a.loadCategoryContent.bind(Object(g.a)(Object(g.a)(a))),a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.save=a.save.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeContent=a.handleChangeContent.bind(Object(g.a)(Object(g.a)(a))),a.handleEdit=a.handleEdit.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({show:e.show,dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,categoryContent:{},categoryContentEdit:{},iconPath:"",onCloseCb:e.onCloseCb,edit:!1},function(){t.loadCategoryContent()})}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"loadCategoryContent",value:function(){var e=this;this._ismounted&&this.state.show&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.dataSource)+"/info/category/"+encodeURI(this.state.category)+"/"+encodeURI(this.state.categoryValue)).then(function(t){var a=e.state.categoryContent;a.content=t.info,e.setState({categoryContent:a},function(){var t=e.state.categoryContent;e.setState({categoryContent:t})})}).fail(function(){e.setState({categoryContent:{content:""}})})}},{key:"close",value:function(e){var t=this;e&&e.preventDefault(),this.state.onCloseCb&&this.setState({show:!1},function(){t.state.onCloseCb()})}},{key:"save",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("PUT","/data_source/"+encodeURIComponent(this.state.dataSource)+"/info/category/"+encodeURI(this.state.category)+"/"+encodeURI(this.state.categoryValue),this.state.categoryContentEdit).then(function(){e.setState({categoryContent:e.state.categoryContentEdit,edit:!1}),G.getState().NotificationManager.addNotification({message:$.t("modal.category_save_ok"),level:"info"})}).fail(function(){e.setState({categoryContent:{content:""},edit:!1}),G.getState().NotificationManager.addNotification({message:$.t("modal.cagegory_save_error"),level:"error"})})}},{key:"handleChangeContent",value:function(e){var t=this.state.categoryContent;t.content=e.target.value,this.setState({categoryContent:t})}},{key:"handleEdit",value:function(){this.state.edit?this.setState({edit:!this.state.edit}):this.setState({edit:!this.state.edit,categoryContentEdit:this.state.categoryContent})}},{key:"render",value:function(){var e,t=this;return e=this.state.edit?s.a.createElement(A.a,{componentClass:"textarea",value:this.state.categoryContentEdit.content,onChange:this.handleChangeContent}):s.a.createElement("p",null,this.state.categoryContent.content),s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,s.a.createElement(_.a,{onClick:this.handleEdit,className:"btn",title:$.t("common.edit")},s.a.createElement(L.a,{name:"pencil"})),"\xa0",this.state.category,": ",this.state.categoryValue)),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(e){t.close(e)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.content"))),s.a.createElement(E.a,{md:8},e)))),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return t.save()},disabled:!this.state.edit},$.t("common.save")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return t.close()}},$.t("common.close"))))}}]),t}(n.Component),Ee=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,path:e.path,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,streamList:G.getState().streamList,playlist:G.getState().playlists,addPlaylistShow:!1,editCategoryShow:!1,onEditCategory:e.onEditCategory,hideRefresh:e.hideRefresh,manageModalShow:!1},a.playElement=a.playElement.bind(Object(g.a)(Object(g.a)(a))),a.runPlayElement=a.runPlayElement.bind(Object(g.a)(Object(g.a)(a))),a.playElementAdvanced=a.playElementAdvanced.bind(Object(g.a)(Object(g.a)(a))),a.addToStream=a.addToStream.bind(Object(g.a)(Object(g.a)(a))),a.addToPlaylist=a.addToPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.addToNewPlaylist=a.addToNewPlaylist.bind(Object(g.a)(Object(g.a)(a))),a.onSavePlaylist=a.onSavePlaylist.bind(Object(g.a)(Object(g.a)(a))),a.runPlayElementAdvanced=a.runPlayElementAdvanced.bind(Object(g.a)(Object(g.a)(a))),a.refreshFolder=a.refreshFolder.bind(Object(g.a)(Object(g.a)(a))),a.viewCategory=a.viewCategory.bind(Object(g.a)(Object(g.a)(a))),a.onCloseCategory=a.onCloseCategory.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectRemove=a.handleSelectRemove.bind(Object(g.a)(Object(g.a)(a))),a.limitStrLenghth=a.limitStrLenghth.bind(Object(g.a)(Object(g.a)(a))),G.subscribe(function(){var e=G.getState();"setPlaylists"===e.lastAction?a.setState({playlist:e.playlists}):"setStreamList"===e.lastAction&&a.setState({streamList:e.streamList})}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,path:e.path,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,streamList:G.getState().streamList,playlist:G.getState().playlists,addPlaylistShow:!1,editCategoryShow:!1,onEditCategory:e.onEditCategory,hideRefresh:e.hideRefresh,manageModalShow:!1})}},{key:"playElement",value:function(){var e=this,t=G.getState().streamList.find(function(e){return e.display_name.startsWith("{"+G.getState().profile.currentPlayer.name+"}")});t?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(t.name)+"/manage",{command:"stop"}).then(function(){var a=G.getState().streamList;for(var n in a)if(a[n].name===t.name){a.splice(n,1);break}G.dispatch({type:"setStreamList",streamList:a}),G.getState().profile.stream.name===t.name&&G.dispatch({type:"loadStream",stream:!1}),e.runPlayElement()}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_delete_stream"),level:"error"})}):this.runPlayElement()}},{key:"runPlayElement",value:function(){var e,t;this.state.path?(e="/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/path/"+encodeURI(this.state.path).replace(/#/g,"%23").replace(/\+/g,"%2B"),t=this.state.element.name):(e="/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/category/"+encodeURI(this.state.category)+"/"+encodeURI(this.state.categoryValue).replace(/#/g,"%23").replace(/\+/g,"%2B"),t=this.state.categoryValue,this.state.subCategory&&(e+="/"+encodeURI(this.state.subCategory)+"/"+encodeURI(this.state.subCategoryValue),t+=" - "+this.state.subCategoryValue)),G.getState().APIManager.taliesinApiRequest("GET",e+"?jukebox&recursive&name="+encodeURI("{")+G.getState().profile.currentPlayer.name+encodeURI("} - ")+encodeURI(t)).then(function(e){var t=G.getState().streamList;t.push(e),G.dispatch({type:"setStreamList",streamList:t}),G.dispatch({type:"loadStreamAndPlay",stream:e,index:0}),G.getState().NotificationManager.addNotification({message:$.t("common.message_play_stream_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_play"),level:"error"})})}},{key:"playElementAdvanced",value:function(){this.setState({show:!0})}},{key:"runPlayElementAdvanced",value:function(e){var t;e&&(this.state.path?t="/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/path/"+encodeURI(this.state.path).replace(/#/g,"%23"):(t="/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/category/"+encodeURI(this.state.category)+"/"+encodeURI(this.state.categoryValue),this.state.subCategory&&(t+="/"+encodeURI(this.state.subCategory)+"/"+encodeURI(this.state.subCategoryValue))),G.getState().APIManager.taliesinApiRequest("GET",t+"?"+e.type+(e.recursive?"&recursive":"")+"&format="+e.format+"&channels="+e.channels+"&bitrate="+e.bitrate+"&samplerate="+e.sampleRate+(e.random?"&random":"")+(e.name?"&name="+encodeURI(e.name):"")).then(function(t){var a=G.getState().streamList;a.push(t),G.dispatch({type:"setStreamList",streamList:a}),G.dispatch({type:e.playNow?"loadStreamAndPlay":"loadStream",stream:t,index:0})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_play_stream"),level:"error"})}));this.setState({show:!1})}},{key:"addToStream",value:function(e){var t;t=this.state.path?{data_source:this.state.dataSource,path:this.state.path,recursive:!0}:{data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,sub_category:this.state.subCategory?this.state.subCategory:void 0,sub_category_value:this.state.subCategoryValue?this.state.subCategoryValue:void 0},G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage",{command:"append_list",parameters:[t]}).then(function(t){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e)+"/manage",{command:"info"}).then(function(e){G.dispatch({type:"setStream",stream:e}),G.getState().NotificationManager.addNotification({message:$.t("common.message_adding_stream_ok"),level:"info"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_adding_stream"),level:"error"})})}},{key:"addToPlaylist",value:function(e){var t;t=this.state.path?{data_source:this.state.dataSource,path:this.state.path,recursive:!0}:{data_source:this.state.dataSource,category:this.state.category,category_value:this.state.categoryValue,sub_category:this.state.subCategory?this.state.subCategory:void 0,sub_category_value:this.state.subCategoryValue?this.state.subCategoryValue:void 0},G.getState().APIManager.taliesinApiRequest("PUT","/playlist/"+encodeURIComponent(e)+"/add_media",[t]).then(function(t){G.getState().APIManager.taliesinApiRequest("GET","/playlist/"+encodeURIComponent(e)).then(function(e){G.dispatch({type:"setPlaylist",playlist:e}),G.getState().NotificationManager.addNotification({message:$.t("common.message_add_playlist_ok"),level:"info"})})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_add_playlist"),level:"error"})})}},{key:"addToNewPlaylist",value:function(){this.setState({addPlaylistShow:!0})}},{key:"onSavePlaylist",value:function(e,t){var a=this;this.setState({addPlaylistShow:!1},function(){var n;e&&(n=a.state.path?{data_source:a.state.dataSource,path:a.state.path,recursive:!0}:{data_source:a.state.dataSource,category:a.state.category,category_value:a.state.categoryValue,sub_category:a.state.subCategory?a.state.subCategory:void 0,sub_category_value:a.state.subCategoryValue?a.state.subCategoryValue:void 0},t.media=[n],G.getState().APIManager.taliesinApiRequest("POST","/playlist/",t).then(function(){var e=a.state.playlist;e.push(t),G.dispatch({type:"setPlaylists",playlists:e}),a.setState({playlist:e,curPlaylist:!1}),G.getState().NotificationManager.addNotification({message:$.t("playlist.message_playlist_added"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("playlist.message_error_adding_playlist"),level:"error"})}))})}},{key:"refreshFolder",value:function(){G.getState().APIManager.taliesinApiRequest("PUT","/data_source/"+encodeURIComponent(this.state.dataSource)+"/refresh/"+encodeURI(this.state.path).replace(/#/g,"%23")).then(function(e){G.getState().NotificationManager.addNotification({message:$.t("common.message_folder_refreshing"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_refreshing_folder"),level:"error"})})}},{key:"viewCategory",value:function(){this.setState({editCategoryShow:!0})}},{key:"onCloseCategory",value:function(){var e=this;this.setState({editCategoryShow:!1},function(){e.state.onEditCategory&&e.state.onEditCategory()})}},{key:"handleSelectRemove",value:function(){this.setState({removeDropdown:!this.state.removeDropdown})}},{key:"limitStrLenghth",value:function(e,t){return e.length>t?e.substring(0,t)+"...":e}},{key:"render",value:function(){var e,t,a,n,i,l=this,r=[],o=[s.a.createElement(y.a,{key:0,onClick:function(){return l.addToNewPlaylist()}},"New playlist")];return this.state.streamList.forEach(function(e,t){r.push(s.a.createElement(y.a,{key:t,onClick:function(){return l.addToStream(e.name)}},s.a.createElement("span",{className:"visible-xs"},"- ",e.display_name?l.limitStrLenghth(e.display_name,20):$.t("common.no_name")),s.a.createElement("span",{className:"hidden-xs"},"- ",e.display_name||$.t("common.no_name"))))}),this.state.playlist.forEach(function(e,t){o.push(s.a.createElement(y.a,{key:t+1,onClick:function(){return l.addToPlaylist(e.name)}},s.a.createElement("span",{className:"visible-xs"},"- ",l.limitStrLenghth(e.name,20)),s.a.createElement("span",{className:"hidden-xs"},"- ",e.name)))}),this.state.hideRefresh||"folder"!==this.state.element.type||!G.getState().profile.isAdmin&&"me"!==G.getState().profile.dataSource.scope||(e=s.a.createElement(_.a,{title:$.t("common.refresh_folder"),onClick:this.refreshFolder},s.a.createElement(L.a,{name:"refresh"})),t=s.a.createElement(y.a,null,s.a.createElement(L.a,{name:"refresh"}),"\xa0",$.t("common.refresh_folder"))),this.state.path||(i=s.a.createElement(Se,{show:this.state.editCategoryShow,onCloseCb:this.onCloseCategory,dataSource:this.state.dataSource,category:this.state.subCategory||this.state.category,categoryValue:this.state.subCategoryValue||this.state.categoryValue}),a=s.a.createElement(_.a,{title:$.t("common.view_category"),onClick:this.viewCategory},s.a.createElement(L.a,{name:"eye"})),n=s.a.createElement(y.a,null,s.a.createElement(L.a,{name:"eye"}),"\xa0",$.t("common.view_category"))),s.a.createElement("div",null,s.a.createElement(Z.a,{className:"hidden-xs"},s.a.createElement(_.a,{title:$.t("common.play_now"),onClick:this.playElement},s.a.createElement(L.a,{name:"play"})),s.a.createElement(_.a,{title:$.t("common.create_stream"),onClick:this.playElementAdvanced},s.a.createElement(L.a,{name:"play"}),"\xa0",s.a.createElement(L.a,{name:"cog"})),e,a,s.a.createElement(ee.a,{id:"add"-this.state.element.name,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-plus"}))},s.a.createElement(y.a,null,$.t("common.add_to_stream")),r,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,$.t("common.add_to_playlist")),o,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:function(){l.setState({manageModalShow:!0})}},$.t("common.manage_in_stream_playlist")))),s.a.createElement(ee.a,{className:"visible-xs",id:"xs-manage"-this.state.element.name,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"}))},s.a.createElement(y.a,{onClick:this.playElement},s.a.createElement(L.a,{name:"play"}),"\xa0",$.t("common.play_now")),s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:this.playElementAdvanced},s.a.createElement(L.a,{name:"play"}),s.a.createElement(L.a,{name:"cog"}),"\xa0",$.t("common.create_stream")),t,n,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,s.a.createElement(L.a,{name:"plus"}),"\xa0",$.t("common.add_to_stream")),r,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,s.a.createElement(L.a,{name:"plus"}),"\xa0",$.t("common.add_to_playlist")),o,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:function(){l.setState({manageModalShow:!0})}},$.t("common.manage_in_stream_playlist"))),s.a.createElement(he,{show:this.state.show,dataSource:this.state.dataSource,element:this.state.element,path:this.state.path,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue,onCloseCb:this.runPlayElementAdvanced}),s.a.createElement(ce,{show:this.state.addPlaylistShow,onCloseCb:this.onSavePlaylist,add:!0,playlist:!1}),s.a.createElement(ae,{show:this.state.manageModalShow,onCloseCb:function(){l.setState({manageModalShow:!1})},dataSource:this.state.dataSource,element:this.state.element,path:this.state.path,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue}),i)}}]),t}(n.Component),Ce=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={element:e.element,dataSource:e.dataSource,path:e.path,thumb:!1,thumbLoaded:!1,visible:!1,hideRefresh:e.hideRefresh},a.handleChangePath=a.handleChangePath.bind(Object(g.a)(Object(g.a)(a))),a.handleOpenFile=a.handleOpenFile.bind(Object(g.a)(Object(g.a)(a))),a.onChangeVisibility=a.onChangeVisibility.bind(Object(g.a)(Object(g.a)(a))),a.getThumbnail=a.getThumbnail.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({element:e.element,dataSource:e.dataSource,path:e.path,hideRefresh:e.hideRefresh})}},{key:"componentDidMount",value:function(){this._ismounted=!0,this.state.visible&&!this.state.thumbLoaded&&this.getThumbnail()}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"handleChangePath",value:function(e){var t=this;G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.dataSource})}),G.dispatch({type:"setCurrentPath",path:(this.state.path?this.state.path+"/":"")+e})}},{key:"handleOpenFile",value:function(e){var t=this.state.element;t.data_source=this.state.dataSource,this.setState({show:!0,modalMedia:t,modalTitle:this.state.element.name})}},{key:"onChangeVisibility",value:function(e){var t=this;this.setState({visible:e},function(){e&&!t.state.thumbLoaded&&t.getThumbnail()})}},{key:"getThumbnail",value:function(){var e=this;this._ismounted&&(this.state.thumb||"audio"!==this.state.element.type&&"folder"!==this.state.element.type&&"image"!==this.state.element.type?this.setState({thumb:!1,thumbLoaded:!0}):G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/path/"+encodeURI(this.state.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"/"+encodeURI(this.state.element.name).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(t){e.setState({thumb:t,thumbLoaded:!0})}).fail(function(){e.setState({thumb:!1,thumbLoaded:!0})}))}},{key:"render",value:function(){var e=this,t="";return t=this.state.thumbLoaded?this.state.thumb?"folder"===this.state.element.type||"artist"===this.state.element.type||"album"===this.state.element.type||"year"===this.state.element.type||"genre"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.thumb,alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):(this.state.element.type,s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.thumb,alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name)))):"folder"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/folder-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):"audio"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/audio-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):"artist"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/artist-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):"album"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/album-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):"year"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/year-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):"genre"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/genre-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):s.a.createElement("a",{role:"button",onClick:function(){return e.handleOpenFile(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/unknown-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):s.a.createElement("div",{className:"text-center"},s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)},title:this.state.element.name},s.a.createElement(L.a,{name:"spinner",spin:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name)))),s.a.createElement(E.a,{md:3,sm:3,xs:6,className:"panel panel-default"},s.a.createElement(ve.a,{scrollCheck:!0,scrollThrottle:100,intervalDelay:8e3,onChange:this.onChangeVisibility,minTopValue:10,partialVisibility:!0},t),s.a.createElement("div",{className:"text-center"},s.a.createElement(Ee,{dataSource:this.state.dataSource,path:this.state.path+"/"+this.state.element.name,element:this.state.element,hideRefresh:this.state.hideRefresh})),s.a.createElement(ne,{show:this.state.show,media:this.state.modalMedia,title:this.state.modalTitle}))}}]),t}(n.Component),ke=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={recentExpanded:!1,recent:[],recentLoaded:!1,randomExpanded:!1,random:[],randomLoaded:!1},a.loadRecent=a.loadRecent.bind(Object(g.a)(Object(g.a)(a))),a.loadRandom=a.loadRandom.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectRecentMedia=a.handleSelectRecentMedia.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectRandomMedia=a.handleSelectRandomMedia.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({recentExpanded:!1,recent:[],recentLoaded:!1,randomExpanded:!1,random:[],randomLoaded:!1})}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"handleSelectRecentMedia",value:function(){var e=this;this.setState({recentExpanded:!this.state.recentExpanded,recent:[],recentLoaded:!1},function(){e.state.recentExpanded&&e.loadRecent()})}},{key:"handleSelectRandomMedia",value:function(){var e=this;this.setState({randomExpanded:!this.state.randomExpanded,random:[],randomLoaded:!1},function(){e.state.randomExpanded&&e.loadRandom()})}},{key:"loadRecent",value:function(){var e=this;this._ismounted&&this.setState({recent:[],recentLoaded:!1},function(){G.getState().APIManager.taliesinApiRequest("PUT","/search/",{type:"audio",sort:"last_updated",sort_direction:"desc"}).then(function(t){var a=[],n=[];t.forEach(function(e,t){var i=e.path.substring(0,e.path.lastIndexOf("/")),l=i.substring(0,i.lastIndexOf("/")),r=i.substring(i.lastIndexOf("/")+1);if(!a.find(function(t){return t.pathParent===i&&t.data_source===e.data_source})){var o={data_source:e.data_source,type:"folder",path:l,name:r,pathParent:i};a.push(o),n.push(s.a.createElement(Ce,{key:t,dataSource:e.data_source,path:l,element:o,className:"dashboard-list",hideRefresh:!0}))}}),e.setState({recent:n,recentLoaded:!0})}).fail(function(t){e.setState({recent:[],recentLoaded:!0})})})}},{key:"loadRandom",value:function(){var e=this;this._ismounted&&this.setState({random:[],randomLoaded:!1},function(){G.getState().APIManager.taliesinApiRequest("PUT","/search/",{type:"audio",sort:"random",limit:12}).then(function(t){var a=[],n=[];t.forEach(function(e,t){var i=e.path.substring(0,e.path.lastIndexOf("/")),l=i.substring(0,i.lastIndexOf("/")),r=i.substring(i.lastIndexOf("/")+1);if(!a.find(function(t){return t.pathParent===i&&t.data_source===e.data_source})){var o={data_source:e.data_source,type:"folder",path:l,name:r,pathParent:i};a.push(o),n.push(s.a.createElement(Ce,{key:t,dataSource:e.data_source,path:l,element:o,className:"dashboard-list",hideRefresh:!0}))}}),e.setState({random:n,randomLoaded:!0})}).fail(function(t){e.setState({random:[],randomLoaded:!0})})})}},{key:"render",value:function(){var e,t,a;return"connected"===G.getState().status||"noauth"===G.getState().status?(this.state.recentLoaded||(e=s.a.createElement(L.a,{name:"spinner",spin:!0})),this.state.randomLoaded||(t=s.a.createElement(L.a,{name:"spinner",spin:!0})),!G.getState().dataSourceList.length&&G.getState().dataSourceListLoaded&&(a=s.a.createElement("h4",{className:"bg-warning"},$.t("dashboard.no_data_source"))),s.a.createElement("div",null,s.a.createElement("h2",null,$.t("dashboard.title")),a,s.a.createElement(le.a,{id:"myPanel"},s.a.createElement(C.a,{defaultExpanded:!0},s.a.createElement(C.a.Heading,null,s.a.createElement(C.a.Title,{toggle:!0},$.t("dashboard.streams"))),s.a.createElement(C.a.Collapse,null,s.a.createElement(C.a.Body,null,s.a.createElement(fe,null)))),s.a.createElement(C.a,null,s.a.createElement(C.a.Heading,null,s.a.createElement(C.a.Title,{toggle:!0},$.t("dashboard.playlists"))),s.a.createElement(C.a.Collapse,null,s.a.createElement(C.a.Body,null,s.a.createElement(pe,null)))),s.a.createElement(C.a,null,s.a.createElement(C.a.Heading,null,s.a.createElement(C.a.Title,{toggle:!0,onClick:this.handleSelectRecentMedia},$.t("dashboard.recent"))),s.a.createElement(C.a.Collapse,null,s.a.createElement(C.a.Body,null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:2,sm:2,xs:2},s.a.createElement(_.a,{title:$.t("dashboard.refresh"),onClick:this.loadRecent},s.a.createElement(L.a,{name:"refresh"})))),e,s.a.createElement(S.a,null,this.state.recent)))),s.a.createElement(C.a,null,s.a.createElement(C.a.Heading,null,s.a.createElement(C.a.Title,{toggle:!0,onClick:this.handleSelectRandomMedia},$.t("dashboard.random"))),s.a.createElement(C.a.Collapse,null,s.a.createElement(C.a.Body,null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:2,sm:2,xs:2},s.a.createElement(_.a,{title:$.t("dashboard.refresh"),onClick:this.loadRandom},s.a.createElement(L.a,{name:"refresh"})))),t,s.a.createElement(S.a,null,this.state.random))))))):"connect"===G.getState().status?s.a.createElement("div",null,s.a.createElement("h2",null,$.t("dashboard.title")),s.a.createElement("h3",null,$.t("dashboard.connecting_message"))):s.a.createElement("div",null,s.a.createElement("h2",null,$.t("dashboard.title")),s.a.createElement("h3",null,$.t("dashboard.connect_message")))}}]),t}(n.Component),_e=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,path:e.path,element:e.element,show:!1,modalMedia:!1,modalTitle:!1},a.handleChangePath=a.handleChangePath.bind(Object(g.a)(Object(g.a)(a))),a.handleDetailsFile=a.handleDetailsFile.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,path:e.path,element:e.element,show:!1,modalMedia:!1,modalTitle:!1})}},{key:"handleChangePath",value:function(e){var t=this;G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.dataSource})}),G.dispatch({type:"setCurrentPath",path:this.state.path+"/"+e})}},{key:"handleDetailsFile",value:function(e){var t=this.state.element;t.data_source=this.state.dataSource,this.setState({show:!0,modalMedia:t,modalTitle:this.state.element.name})}},{key:"render",value:function(){var e,t=this;return e="folder"===this.state.element.type?s.a.createElement("a",{role:"button",onClick:function(){return t.handleChangePath(t.state.element.name)}},this.state.element.name):s.a.createElement("a",{role:"button",onClick:function(){return t.handleDetailsFile(t.state.element.name)}},this.state.element.name),s.a.createElement(S.a,{className:"row-media"},s.a.createElement(E.a,{md:8,sm:8,xs:6},e),s.a.createElement(E.a,{md:4,sm:4,xs:6,className:"text-right"},s.a.createElement(Ee,{dataSource:this.state.dataSource,path:this.state.path+"/"+this.state.element.name,element:this.state.element})),s.a.createElement(ne,{show:this.state.show,media:this.state.modalMedia,title:this.state.modalTitle}))}}]),t}(n.Component),xe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,path:e.path,view:e.view,elementList:[],elementListInitial:[],filter:"",loaded:!1,offset:0,limit:100,unavailable:!1},a.getElementList(),a.filterList=a.filterList.bind(Object(g.a)(Object(g.a)(a))),a.navigate=a.navigate.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({dataSource:e.dataSource,path:e.path,view:e.view,elementList:[],elementListInitial:[],filter:"",loaded:!1,offset:0,limit:100},function(){t.getElementList()})}},{key:"filterList",value:function(e){var t=this.state.elementListInitial;t=t.filter(function(t){return-1!==t.name.toLowerCase().search(e.target.value.toLowerCase())}),this.setState({elementList:t,offset:0})}},{key:"getElementList",value:function(){var e=this;!this.state.loaded&&this.state.dataSource&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/path/"+encodeURI(this.state.path).replace(/#/g,"%23").replace(/\+/g,"%2B")).then(function(t){e.setState({loaded:!0,elementListInitial:t,elementList:t})}).fail(function(t){503===t.status?e.setState({loaded:!0,elementListInitial:[],elementList:[],unavailable:!0}):e.setState({loaded:!0,elementListInitial:[],elementList:[]})})}},{key:"navigate",value:function(e){this.setState({offset:this.state.offset+e})}},{key:"render",value:function(){var e,t=this,a=[],n=this.state.elementList;if(this.state.loaded){if(this.state.unavailable)a.push(s.a.createElement("h4",{className:"bg-warning"},$.t("data_source.unavailabe")));else if("icon"===this.state.view){for(e in n)if(e>=this.state.offset&&a.push(s.a.createElement(Ce,{key:e,dataSource:this.state.dataSource,path:this.state.path,element:n[e]})),e>this.state.offset+this.state.limit)break}else for(e in n)if(e>=this.state.offset&&a.push(s.a.createElement(_e,{key:e,dataSource:this.state.dataSource,path:this.state.path,element:n[e]})),e>this.state.offset+this.state.limit)break;return s.a.createElement("div",null,s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,sm:12,xs:12,className:"text-right"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{disabled:!this.state.offset,onClick:function(){t.navigate(-100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.previous_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-left"}))),s.a.createElement(_.a,{disabled:this.state.offset+this.state.limit>=n.length,onClick:function(){t.navigate(100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.next_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-right"})))))),s.a.createElement(S.a,null,s.a.createElement("input",{type:"text",placeholder:"Filter",value:this.filter,className:"form-control",onChange:this.filterList})),a,s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,sm:12,xs:12,className:"text-right"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{disabled:!this.state.offset,onClick:function(){t.navigate(-100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.previous_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-left"}))),s.a.createElement(_.a,{disabled:this.state.offset+this.state.limit>=n.length,onClick:function(){t.navigate(100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.next_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-right"})))))))}return s.a.createElement(S.a,null,s.a.createElement(L.a,{name:"spinner",size:"2x",spin:!0}))}}]),t}(n.Component),Oe=a(583),je=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={view:e.view,elementList:[],elementListInitial:[],filter:"",loaded:!1,groupBy:1,offset:0},a.getElementList(),a.filterList=a.filterList.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeGroupBy=a.handleChangeGroupBy.bind(Object(g.a)(Object(g.a)(a))),a.handleNavigationPrevious=a.handleNavigationPrevious.bind(Object(g.a)(Object(g.a)(a))),a.handleNavigationNext=a.handleNavigationNext.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({view:e.view,elementList:[],elementListInitial:[],filter:"",loaded:!1},function(){t.getElementList()})}},{key:"filterList",value:function(e){var t=this.state.elementListInitial;t=t.filter(function(t){return-1!==t.name.toLowerCase().search(e.target.value.toLowerCase())}),this.setState({elementList:t})}},{key:"handleNavigationNext",value:function(){var e=this;this.setState({offset:this.state.offset+100,loaded:!1},function(){e.getElementList()})}},{key:"handleNavigationPrevious",value:function(){var e=this;this.setState({offset:this.state.offset-100,loaded:!1},function(){e.getElementList()})}},{key:"getElementList",value:function(){var e=this;this.state.loaded||G.getState().APIManager.taliesinApiRequest("PUT","/search/",{sort:"last_updated",sort_direction:"desc",offset:this.state.offset}).then(function(t){switch(e.state.groupBy){case 0:e.setState({loaded:!0,elementListInitial:t,elementList:t});break;case 1:var a=[];t.forEach(function(e){var t=e.path.substring(0,e.path.lastIndexOf("/")),n=t.substring(0,t.lastIndexOf("/")),s=t.substring(t.lastIndexOf("/")+1);if(!a.find(function(a){return a.pathParent===t&&a.data_source===e.data_source})){var i={data_source:e.data_source,type:"folder",path:n,name:s,pathParent:t};a.push(i)}}),e.setState({loaded:!0,elementListInitial:a,elementList:a});break;default:e.setState({loaded:!0,elementListInitial:[],elementList:[]})}}).fail(function(t){e.setState({loaded:!0,elementListInitial:[],elementList:[]})})}},{key:"handleChangeGroupBy",value:function(e){var t=this;this.setState({groupBy:e,loaded:!1},function(){t.getElementList()})}},{key:"render",value:function(){var e=this,t=[],a=this.state.elementList,n=s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",{className:"hidden-xs"},"Group by"),s.a.createElement(Oe.a,{className:"hidden-xs"},s.a.createElement(de.a,{type:"radio",name:"groupBy",value:this.state.groupBy,onChange:this.handleChangeGroupBy},s.a.createElement(ue.a,{value:0},$.t("common.file")),s.a.createElement(ue.a,{value:1},$.t("common.folder")),s.a.createElement(ue.a,{value:2},$.t("common.artist")),s.a.createElement(ue.a,{value:3},$.t("common.album")),s.a.createElement(ue.a,{value:4},$.t("common.date")))),s.a.createElement(ee.a,{className:"visible-xs",id:"grouypBy",title:s.a.createElement("span",null,"Group by")},s.a.createElement(y.a,{onClick:function(){return e.handleChangeGroupBy(0)},className:0===this.state.groupBy?"bg-success":""},$.t("common.file")),s.a.createElement(y.a,{onClick:function(){return e.handleChangeGroupBy(1)},className:1===this.state.groupBy?"bg-success":""},$.t("common.folder")),s.a.createElement(y.a,{onClick:function(){return e.handleChangeGroupBy(2)},className:2===this.state.groupBy?"bg-success":""},$.t("common.artist")),s.a.createElement(y.a,{onClick:function(){return e.handleChangeGroupBy(3)},className:3===this.state.groupBy?"bg-success":""},$.t("common.album")),s.a.createElement(y.a,{onClick:function(){return e.handleChangeGroupBy(4)},className:4===this.state.groupBy?"bg-success":""},$.t("common.date")))),s.a.createElement(E.a,{md:6,sm:6,xs:6,className:"text-right"},s.a.createElement("span",{className:"hidden-xs"},$.t("common.navigation")," - "),$.t("common.page",{page:this.state.offset/100+1}),"\xa0",s.a.createElement("br",{className:"hidden-xs"}),s.a.createElement(Z.a,null,s.a.createElement(_.a,{onClick:this.handleNavigationPrevious,disabled:!this.state.offset},s.a.createElement("span",{className:"hidden-xs"},$.t("common.previous_page")),s.a.createElement(L.a,{name:"chevron-left",className:"visible-xs"})),s.a.createElement(_.a,{onClick:this.handleNavigationNext},s.a.createElement("span",{className:"hidden-xs"},$.t("common.next_page")),s.a.createElement(L.a,{name:"chevron-right",className:"visible-xs"})))));return this.state.loaded?"icon"===this.state.view?(a.forEach(function(e,a){t.push(s.a.createElement(Ce,{key:a,dataSource:e.data_source,path:e.path,element:e}))}),s.a.createElement("div",null,n,s.a.createElement(S.a,null,s.a.createElement("input",{type:"text",placeholder:"Filter",value:this.filter,className:"form-control",onChange:this.filterList})),s.a.createElement(S.a,null,t))):(a.forEach(function(e,a){t.push(s.a.createElement(_e,{key:a,dataSource:e.data_source,path:e.path,element:e}))}),s.a.createElement("div",null,n,s.a.createElement(S.a,null,s.a.createElement("input",{type:"text",placeholder:$.t("common.filter"),value:this.filter,className:"form-control",onChange:this.filterList})),t)):s.a.createElement("div",null,n,s.a.createElement(S.a,null,s.a.createElement(L.a,{name:"spinner",size:"2x",spin:!0})))}}]),t}(n.Component),we=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,modal:""},a.handleChangePath=a.handleChangePath.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,modal:""})}},{key:"handleChangePath",value:function(e){"media"===this.state.element.type?this.setState({modal:s.a.createElement(ne,{show:!0,media:this.state.element,title:this.state.element.tags.title||this.state.element.name})}):this.state.subCategory?G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:e}):G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:e})}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{className:"row-media"},s.a.createElement(E.a,{md:8,sm:8,xs:6},s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)}},this.state.element.name)),s.a.createElement(E.a,{md:4,sm:4,xs:6,className:"text-right"},s.a.createElement(Ee,{dataSource:this.state.dataSource,path:this.state.element.path,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue,element:this.state.element})),this.state.modal)}}]),t}(n.Component),Pe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,modal:""},a.handleChangePath=a.handleChangePath.bind(Object(g.a)(Object(g.a)(a))),a.onChangeVisibility=a.onChangeVisibility.bind(Object(g.a)(Object(g.a)(a))),a.getThumbnail=a.getThumbnail.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,element:e.element,modal:""})}},{key:"handleChangePath",value:function(e){"media"===this.state.element.type?this.setState({modal:s.a.createElement(ne,{show:!0,media:this.state.element,title:this.state.element.tags.title||this.state.element.name})}):this.state.subCategory?G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:e}):G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:e})}},{key:"onChangeVisibility",value:function(e){var t=this;this.setState({visible:e},function(){e&&!t.state.thumbLoaded&&t.getThumbnail()})}},{key:"getThumbnail",value:function(){var e=this;this.state.thumb?this.setState({thumb:!1,thumbLoaded:!0}):"media"!==this.state.element.type?this.setState({thumb:!1,thumbLoaded:!0}):G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/path/"+encodeURI(this.state.element.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(t){e.setState({thumb:t,thumbLoaded:!0})}).fail(function(){e.setState({thumb:!1,thumbLoaded:!0})})}},{key:"render",value:function(){var e=this,t="";return t=this.state.thumbLoaded?this.state.thumb?s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.thumb,alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/"+this.state.element.type+"-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name))):s.a.createElement("div",null,s.a.createElement("a",{role:"button",onClick:function(){return e.handleChangePath(e.state.element.name)},title:this.state.element.name},s.a.createElement(b.a,{src:"/images/unknown-128.png",alt:this.state.element.name,className:"elementImage",responsive:!0}),s.a.createElement(L.a,{name:"spinner",spin:!0}),s.a.createElement("div",{className:"hideOverflow"},s.a.createElement("span",null,this.state.element.name)))),s.a.createElement(E.a,{md:3,sm:3,xs:6,className:"panel panel-default"},s.a.createElement(ve.a,{scrollCheck:!0,scrollThrottle:100,intervalDelay:8e3,onChange:this.onChangeVisibility,minTopValue:10,partialVisibility:!0},t),s.a.createElement("div",{className:"text-center"},s.a.createElement(Ee,{dataSource:this.state.dataSource,path:this.state.element.path,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue,element:this.state.element})),this.state.modal)}}]),t}(n.Component),Ne=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue},a.handleChangeCategory=a.handleChangeCategory.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue})}},{key:"handleChangeCategory",value:function(e){this.state.categoryValue?G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:this.state.categoryValue,subCategory:e}):G.dispatch({type:"setCurrentCategory",category:e})}},{key:"render",value:function(){var e,t,a,n,i,l=this;return this.state.categoryValue&&!this.state.subCategory&&(e=s.a.createElement(_.a,{onClick:function(){return l.handleChangeCategory(!1)}},"Media")),this.state.subCategoryValue||"artist"===this.state.subCategory||"artist"===this.state.category||(t=s.a.createElement(_.a,{onClick:function(){return l.handleChangeCategory("artist")}},"Artist")),this.state.subCategoryValue||"album"===this.state.subCategory||"album"===this.state.category||(a=s.a.createElement(_.a,{onClick:function(){return l.handleChangeCategory("album")}},"Album")),this.state.subCategoryValue||"year"===this.state.subCategory||"year"===this.state.category||(n=s.a.createElement(_.a,{onClick:function(){return l.handleChangeCategory("year")}},"Years")),this.state.subCategoryValue||"genre"===this.state.subCategory||"genre"===this.state.category||(i=s.a.createElement(_.a,{onClick:function(){return l.handleChangeCategory("genre")}},"Genre")),s.a.createElement(Z.a,null,e,t,a,n,i)}}]),t}(n.Component),Me=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,currentCategory:e.subCategory||e.category,currentValue:e.subCategoryValue||e.categoryValue,offset:0,limit:100,view:e.view,elementList:[],elementListInitial:[],filter:"",loaded:!1},a.getElementList(),a.filterList=a.filterList.bind(Object(g.a)(Object(g.a)(a))),a.navigate=a.navigate.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,currentCategory:e.subCategory||e.category,currentValue:e.subCategoryValue||e.categoryValue,offset:0,limit:100,view:e.view,elementList:[],elementListInitial:[],filter:"",loaded:!1},function(){t.getElementList()})}},{key:"getElementList",value:function(){var e=this;if(!this.state.loaded&&this.state.dataSource){var t="/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/category/"+encodeURI(this.state.category);this.state.categoryValue&&(t+="/"+encodeURIComponent(this.state.categoryValue),this.state.subCategory&&(t+="/"+this.state.subCategory,this.state.subCategoryValue&&(t+="/"+encodeURIComponent(this.state.subCategoryValue)))),G.getState().APIManager.taliesinApiRequest("GET",t).then(function(t){e.setState({loaded:!0,elementListInitial:t,elementList:t})}).fail(function(t){e.setState({loaded:!0,elementListInitial:[],elementList:[]})})}}},{key:"filterList",value:function(e){var t=this.state.elementListInitial;t=t.filter(function(t){return-1!==t.name.toLowerCase().search(e.target.value.toLowerCase())}),this.setState({elementList:t})}},{key:"navigate",value:function(e){this.setState({offset:this.state.offset+e})}},{key:"render",value:function(){var e,t=this,a=[],n=this.state.elementList;if(this.state.loaded){for(e in n){if(e>=this.state.offset){var i=this.state.categoryValue?this.state.categoryValue:n[e].name,l=!!this.state.categoryValue&&n[e].name;"icon"===this.state.view?a.push(s.a.createElement(Pe,{key:e,dataSource:this.state.dataSource,category:this.state.category,categoryValue:i,subCategory:this.state.subCategory,subCategoryValue:l,element:n[e]})):a.push(s.a.createElement(we,{key:e,dataSource:this.state.dataSource,category:this.state.category,categoryValue:i,subCategory:this.state.subCategory,subCategoryValue:l,element:n[e]}))}if(e>this.state.offset+this.state.limit)break}return s.a.createElement("div",null,s.a.createElement(S.a,{style:{marginBottom:"10px"}},s.a.createElement(E.a,{md:6,sm:8,xs:8},s.a.createElement(Ne,{category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue})),s.a.createElement(E.a,{md:6,sm:4,xs:4,className:"text-right"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{disabled:!this.state.offset,onClick:function(){t.navigate(-100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.previous_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-left"}))),s.a.createElement(_.a,{disabled:this.state.offset+this.state.limit>=n.length,onClick:function(){t.navigate(100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.next_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-right"})))))),s.a.createElement(S.a,{style:{marginBottom:"10px"}},s.a.createElement("input",{type:"text",placeholder:$.t("common.filter"),value:this.filter,className:"form-control",onChange:this.filterList})),s.a.createElement(S.a,null,a),s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:6,sm:8,xs:8},s.a.createElement(Ne,{category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue})),s.a.createElement(E.a,{md:6,sm:4,xs:4,className:"text-right"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{disabled:!this.state.offset,onClick:function(){t.navigate(-100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.previous_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-left"}))),s.a.createElement(_.a,{disabled:this.state.offset+this.state.limit>=n.length,onClick:function(){t.navigate(100)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.next_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-right"})))))))}return s.a.createElement(S.a,null,s.a.createElement(L.a,{name:"spinner",size:"2x",spin:!0}))}}]),t}(n.Component),Ae=a(584),Re=a(55),Le=a.n(Re),Te=(a(373),function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={criteria:{query:"",type:"",data_source:G.getState().dataSourceList.map(function(e){return e.name}),tags:[],metrics:{},sort:"path",sort_direction:"asc",limit:25,offset:0},addMetrics:!1,searchResult:[],searching:!1,searchPanel:!0,firstLoad:!0,modalShow:!1,modalMedia:!1,modalTitle:""},a.handleSelectPanel=a.handleSelectPanel.bind(Object(g.a)(Object(g.a)(a))),a.changeSelectDataSource=a.changeSelectDataSource.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeQuery=a.handleChangeQuery.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeType=a.handleChangeType.bind(Object(g.a)(Object(g.a)(a))),a.handleAddTag=a.handleAddTag.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeTagKey=a.handleChangeTagKey.bind(Object(g.a)(Object(g.a)(a))),a.handleSetTagKey=a.handleSetTagKey.bind(Object(g.a)(Object(g.a)(a))),a.handleSetTagOperator=a.handleSetTagOperator.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeTagValue=a.handleChangeTagValue.bind(Object(g.a)(Object(g.a)(a))),a.handleAddMetrics=a.handleAddMetrics.bind(Object(g.a)(Object(g.a)(a))),a.handleSetMetrics=a.handleSetMetrics.bind(Object(g.a)(Object(g.a)(a))),a.handleSetMetricsOperator=a.handleSetMetricsOperator.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsValue=a.handleChangeMetricsValue.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsValueMax=a.handleChangeMetricsValueMax.bind(Object(g.a)(Object(g.a)(a))),a.handleRemoveMetrics=a.handleRemoveMetrics.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsPlayedAt=a.handleChangeMetricsPlayedAt.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsPlayedAtMax=a.handleChangeMetricsPlayedAtMax.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsLastSeen=a.handleChangeMetricsLastSeen.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsLastSeenMax=a.handleChangeMetricsLastSeenMax.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsLastUpdated=a.handleChangeMetricsLastUpdated.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeMetricsLastUpdatedMax=a.handleChangeMetricsLastUpdatedMax.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeSort=a.handleChangeSort.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeSortDirection=a.handleChangeSortDirection.bind(Object(g.a)(Object(g.a)(a))),a.runSearch=a.runSearch.bind(Object(g.a)(Object(g.a)(a))),a.openMedia=a.openMedia.bind(Object(g.a)(Object(g.a)(a))),a.closeMedia=a.closeMedia.bind(Object(g.a)(Object(g.a)(a))),a.navigate=a.navigate.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({criteria:{query:"",type:"",data_source:G.getState().dataSourceList.map(function(e){return e.name}),tags:[],metrics:{},sort:"path",sort_direction:"asc",limit:100,offset:0},addMetrics:!1,searchResult:[],searching:!1,searchPanel:!0,firstLoad:!0,modalShow:!1,modalMedia:!1,modalTitle:""})}},{key:"getValidationState",value:function(){return"success"}},{key:"handleSelectPanel",value:function(){this.setState({searchPanel:!this.state.searchPanel})}},{key:"handleChangeType",value:function(e){var t=this.state.criteria;t.type=e.target.value,this.setState({criteria:t})}},{key:"changeSelectDataSource",value:function(e){var t=this.state.criteria,a=t.data_source.indexOf(e);-1===a?t.data_source.push(e):t.data_source.splice(a,1),this.setState({criteria:t})}},{key:"handleChangeQuery",value:function(e){var t=this.state.criteria;""!==e.target.value?t.query=e.target.value:delete t.query,this.setState({criteria:t})}},{key:"handleAddTag",value:function(){var e=this.state.criteria;e.tags.push({key:"",operator:"contains",value:""}),this.setState({criteria:e})}},{key:"handleChangeTagKey",value:function(e,t){var a=this.state.criteria;a.tags[e].key=t.target.value,this.setState({criteria:a})}},{key:"handleSetTagKey",value:function(e,t){var a=this.state.criteria;a.tags[e].key=t,this.setState({criteria:a})}},{key:"handleSetTagOperator",value:function(e,t){var a=this.state.criteria;a.tags[e].operator=t.target.value,this.setState({criteria:a})}},{key:"handleChangeTagValue",value:function(e,t){var a=this.state.criteria;a.tags[e].value=t.target.value,this.setState({criteria:a})}},{key:"handleAddMetrics",value:function(){var e,t=this,a=[s.a.createElement("option",{key:"0",value:""},"Select new metrics")];this.state.criteria.metrics.nb_play||a.push(s.a.createElement("option",{key:"1",value:"nb_play"},$.t("advanced_search.number_times_played"))),this.state.criteria.metrics.played_at||a.push(s.a.createElement("option",{key:"2",value:"played_at"},$.t("advanced_search.date_played"))),this.state.criteria.metrics.last_seen||a.push(s.a.createElement("option",{key:"3",value:"last_seen"},$.t("advanced_search.date_last_seen"))),this.state.criteria.metrics.last_updated||a.push(s.a.createElement("option",{key:"4",value:"last_updated"},$.t("advanced_search.date_last_updated"))),e=s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),onChange:function(e){return t.handleSetMetrics(e)}},a),this.setState({addMetrics:e})}},{key:"handleSetMetrics",value:function(e){var t=this.state.criteria;switch(e.target.value){case"nb_play":t.metrics.nb_play={operator:"equals",value:0,value_max:0};break;case"played_at":t.metrics.played_at={operator:"equals",value:0,value_max:0};break;case"last_seen":t.metrics.last_seen={operator:"equals",value:0,value_max:0};break;case"last_updated":t.metrics.last_updated={operator:"equals",value:0,value_max:0}}this.setState({criteria:t,addMetrics:!1})}},{key:"handleSetMetricsOperator",value:function(e,t){var a=this.state.criteria;a.metrics[e].operator=t.target.value,this.setState({criteria:a,addMetrics:!1})}},{key:"handleChangeMetricsValue",value:function(e,t){var a=this.state.criteria;a.metrics[e].value=parseInt(t.target.value,10),this.setState({criteria:a,addMetrics:!1})}},{key:"handleChangeMetricsValueMax",value:function(e,t){var a=this.state.criteria;a.metrics[e].value_max=parseInt(t.target.value,10),this.setState({criteria:a,addMetrics:!1})}},{key:"handleChangeMetricsPlayedAt",value:function(e){var t=this.state.criteria;t.metrics.played_at.value=Math.round(e.valueOf()/1e3),this.setState({criteria:t,addMetrics:!1})}},{key:"handleChangeMetricsPlayedAtMax",value:function(e){var t=this.state.criteria;t.metrics.played_at.value_max=Math.round(e.valueOf()/1e3),this.setState({criteria:t,addMetrics:!1})}},{key:"handleChangeMetricsLastSeen",value:function(e){var t=this.state.criteria;t.metrics.last_seen.value=Math.round(e.valueOf()/1e3),this.setState({criteria:t,addMetrics:!1})}},{key:"handleChangeMetricsLastSeenMax",value:function(e){var t=this.state.criteria;t.metrics.last_seen.value_max=Math.round(e.valueOf()/1e3),this.setState({criteria:t,addMetrics:!1})}},{key:"handleChangeMetricsLastUpdated",value:function(e){var t=this.state.criteria;t.metrics.last_updated.value=Math.round(e.valueOf()/1e3),this.setState({criteria:t,addMetrics:!1})}},{key:"handleChangeMetricsLastUpdatedMax",value:function(e){var t=this.state.criteria;t.metrics.last_updated.value_max=Math.round(e.valueOf()/1e3),this.setState({criteria:t,addMetrics:!1})}},{key:"handleRemoveMetrics",value:function(e){var t=this.state.criteria;delete t.metrics[e],this.setState({criteria:t,addMetrics:!1})}},{key:"handleChangeSort",value:function(e){var t=this.state.criteria;t.sort=e.target.value,this.setState({criteria:t})}},{key:"handleChangeSortDirection",value:function(e){var t=this.state.criteria;t.sort_direction=e.target.value,this.setState({criteria:t})}},{key:"runSearch",value:function(e){var t=this;e&&e.preventDefault(),this.setState({searching:!0,searchResult:[],firstLoad:!1,searchPanel:!1},function(){G.getState().APIManager.taliesinApiRequest("PUT","/search/",t.state.criteria).then(function(e){t.setState({searchResult:e,searching:!1},function(){var e=t.state.searchResult;e.forEach(function(a){a.cover||G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(a.data_source)+"/browse/path/"+encodeURI(a.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(n){a.cover=n,t.setState({searchResult:e})})})})}).fail(function(){t.setState({searchResult:[],searching:!1})})})}},{key:"navigate",value:function(e){var t=this,a=this.state.criteria;a.offset+=e,this.setState({criteria:a},function(){t.runSearch()})}},{key:"openMedia",value:function(e){this.setState({modalShow:!0,modalMedia:e,modalTitle:e.tags.title||e.name})}},{key:"closeMedia",value:function(){this.setState({modalShow:!1})}},{key:"render",value:function(){var e,t,a,n,i=this,l=[],r=[],o=[],c=[];return G.getState().dataSourceList.forEach(function(e,t){l.push(s.a.createElement(Ae.a,{key:t,inline:!0,checked:-1!==i.state.criteria.data_source.indexOf(e.name),onChange:function(){return i.changeSelectDataSource(e.name)}},e.name))}),this.state.criteria.tags.forEach(function(e,t){var a="";e.key&&(a=e.key),r.push(s.a.createElement(S.a,{key:t},s.a.createElement(E.a,{xs:2},s.a.createElement(ge.a,null,"Key"),s.a.createElement(M.a,null,s.a.createElement(ee.a,{title:a||"Select key",id:"keyList",className:"form-control"},s.a.createElement(y.a,{onClick:function(){return i.handleSetTagKey(t,"title")}},$.t("common.title")),s.a.createElement(y.a,{onClick:function(){return i.handleSetTagKey(t,"artist")}},$.t("common.artist")),s.a.createElement(y.a,{onClick:function(){return i.handleSetTagKey(t,"album")}},$.t("common.album")),s.a.createElement(y.a,{onClick:function(){return i.handleSetTagKey(t,"date")}},$.t("common.year")),s.a.createElement(y.a,{onClick:function(){return i.handleSetTagKey(t,"genre")}},$.t("common.genre")),s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,null,s.a.createElement(A.a,{type:"text",value:a,placeholder:$.t("advanced_search.tag_key"),autoFocus:!0,onChange:function(e){i.handleChangeTagKey(t,e)}}))))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.operator")),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),value:e.operator,onChange:function(e){return i.handleSetTagOperator(t,e)}},s.a.createElement("option",{value:"contains"},$.t("advanced_search.operator_contains")),s.a.createElement("option",{value:"equals"},$.t("advanced_search.operator_equals")),s.a.createElement("option",{value:"different"},$.t("advanced_search.operator_different")),s.a.createElement("option",{value:"lower"},$.t("advanced_search.operator_lower")),s.a.createElement("option",{value:"higher"},$.t("advanced_search.operator_higher")),s.a.createElement("option",{value:"empty"},$.t("advanced_search.operator_empty")))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.value")),s.a.createElement(A.a,{type:"text",value:e.name,placeholder:$.t("advanced_search.tag_name"),onChange:function(e){i.handleChangeTagValue(t,e)},disabled:"empty"===e.operator})),s.a.createElement(E.a,{xs:2},s.a.createElement(ge.a,null,$.t("advanced_search.remove")),s.a.createElement(M.a,null,s.a.createElement(_.a,{title:$.t("advanced_search.remove"),onClick:function(){return i.handleRemoveTag(t)}},s.a.createElement(L.a,{name:"times"}))))))}),this.state.addMetrics&&(e=s.a.createElement(S.a,null,s.a.createElement(E.a,null,s.a.createElement(ge.a,null,$.t("advanced_search.new_metric_value")),this.state.addMetrics))),this.state.criteria.metrics.nb_play&&(n="","between"===this.state.criteria.metrics.nb_play.operator&&(n=s.a.createElement("div",null,s.a.createElement(ge.a,null,$.t("advanced_search.value_max")),s.a.createElement(A.a,{type:"text",value:this.state.criteria.metrics.nb_play.value_max,placeholder:$.t("advanced_search.value"),onChange:function(e){i.handleChangeMetricsValueMax("nb_play",e)}}))),o.push(s.a.createElement(S.a,{key:0},s.a.createElement(E.a,{xs:2},s.a.createElement("span",{className:"label label-info"},$.t("advanced_search.number_times_played"))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.operator")),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),value:this.state.criteria.metrics.nb_play.operator,onChange:function(e){return i.handleSetMetricsOperator("nb_play",e)}},s.a.createElement("option",{value:"contains"},$.t("advanced_search.operator_contains")),s.a.createElement("option",{value:"equals"},$.t("advanced_search.operator_equals")),s.a.createElement("option",{value:"different"},$.t("advanced_search.operator_different")),s.a.createElement("option",{value:"lower"},$.t("advanced_search.operator_lower")),s.a.createElement("option",{value:"higher"},$.t("advanced_search.operator_higher")),s.a.createElement("option",{value:"empty"},$.t("advanced_search.operator_empty")))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.value")),s.a.createElement(A.a,{type:"text",value:this.state.criteria.metrics.nb_play.value,placeholder:$.t("advanced_search.value"),onChange:function(e){i.handleChangeMetricsValue("nb_play",e)}}),n),s.a.createElement(E.a,{xs:2},s.a.createElement(ge.a,null,$.t("advanced_search.remove")),s.a.createElement(M.a,null,s.a.createElement(_.a,{title:$.t("advanced_search.remove"),onClick:function(){return i.handleRemoveMetrics("nb_play")}},s.a.createElement(L.a,{name:"times"}))))))),this.state.criteria.metrics.played_at&&(n="","between"===this.state.criteria.metrics.played_at.operator&&(n=s.a.createElement("div",null,s.a.createElement(ge.a,null,"Value max"),s.a.createElement(Le.a,{value:1e3*this.state.criteria.metrics.played_at.value_max,onChange:this.handleChangeMetricsPlayedAtMax}))),o.push(s.a.createElement(S.a,{key:1},s.a.createElement(E.a,{xs:2},s.a.createElement("span",{className:"label label-info"},$.t("advanced_search.played_at"))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.operator")),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),value:this.state.criteria.metrics.played_at.operator,onChange:function(e){return i.handleSetMetricsOperator("played_at",e)}},s.a.createElement("option",{value:"equals"},$.t("advanced_search.operator_on")),s.a.createElement("option",{value:"different"},$.t("advanced_search.operator_not_on")),s.a.createElement("option",{value:"lower"},$.t("advanced_search.operator_before")),s.a.createElement("option",{value:"higher"},$.t("advanced_search.operator_after")),s.a.createElement("option",{value:"between"},$.t("advanced_search.operator_between")))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.value")),s.a.createElement(Le.a,{value:1e3*this.state.criteria.metrics.played_at.value,onChange:this.handleChangeMetricsPlayedAt}),n),s.a.createElement(E.a,{xs:2},s.a.createElement(ge.a,null,$.t("advanced_search.remove")),s.a.createElement(M.a,null,s.a.createElement(_.a,{title:$.t("advanced_search.remove"),onClick:function(){return i.handleRemoveMetrics("played_at")}},s.a.createElement(L.a,{name:"times"}))))))),this.state.criteria.metrics.last_seen&&(n="","between"===this.state.criteria.metrics.last_seen.operator&&(n=s.a.createElement("div",null,s.a.createElement(ge.a,null,$.t("advanced_search.value_max")),s.a.createElement(Le.a,{value:1e3*this.state.criteria.metrics.last_seen.value_max,onChange:this.handleChangeMetricsLastSeenMax}))),o.push(s.a.createElement(S.a,{key:2},s.a.createElement(E.a,{xs:2},s.a.createElement("span",{className:"label label-info"},$.t("advanced_search.last_seen"))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.operator")),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),value:this.state.criteria.metrics.last_seen.operator,onChange:function(e){return i.handleSetMetricsOperator("last_seen",e)}},s.a.createElement("option",{value:"equals"},$.t("advanced_search.operator_on")),s.a.createElement("option",{value:"different"},$.t("advanced_search.operator_not_on")),s.a.createElement("option",{value:"lower"},$.t("advanced_search.operator_before")),s.a.createElement("option",{value:"higher"},$.t("advanced_search.operator_after")),s.a.createElement("option",{value:"between"},$.t("advanced_search.operator_between")))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,"Value"),s.a.createElement(Le.a,{value:1e3*this.state.criteria.metrics.last_seen.value,onChange:this.handleChangeMetricsLastSeen}),n),s.a.createElement(E.a,{xs:2},s.a.createElement(ge.a,null,$.t("advanced_search.remove")),s.a.createElement(M.a,null,s.a.createElement(_.a,{title:$.t("advanced_search.remove"),onClick:function(){return i.handleRemoveMetrics("last_seen")}},s.a.createElement(L.a,{name:"times"}))))))),this.state.criteria.metrics.last_updated&&(n="","between"===this.state.criteria.metrics.last_updated.operator&&(n=s.a.createElement("div",null,s.a.createElement(ge.a,null,$.t("advanced_search.value_max")),s.a.createElement(Le.a,{value:1e3*this.state.criteria.metrics.last_updated.value_max,onChange:this.handleChangeMetricsLastUpdatedMax}))),o.push(s.a.createElement(S.a,{key:3},s.a.createElement(E.a,{xs:2},s.a.createElement("span",{className:"label label-info"},$.t("advanced_search.last_updated"))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.operator")),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),value:this.state.criteria.metrics.last_updated.operator,onChange:function(e){return i.handleSetMetricsOperator("last_updated",e)}},s.a.createElement("option",{value:"equals"},$.t("advanced_search.operator_on")),s.a.createElement("option",{value:"different"},$.t("advanced_search.operator_not_on")),s.a.createElement("option",{value:"lower"},$.t("advanced_search.operator_before")),s.a.createElement("option",{value:"higher"},$.t("advanced_search.operator_after")),s.a.createElement("option",{value:"between"},$.t("advanced_search.operator_between")))),s.a.createElement(E.a,{xs:4},s.a.createElement(ge.a,null,$.t("advanced_search.value")),s.a.createElement(Le.a,{value:1e3*this.state.criteria.metrics.last_updated.value,onChange:this.handleChangeMetricsLastUpdated}),n),s.a.createElement(E.a,{xs:2},s.a.createElement(ge.a,null,$.t("advanced_search.remove")),s.a.createElement(M.a,null,s.a.createElement(_.a,{title:$.t("advanced_search.remove"),onClick:function(){return i.handleRemoveMetrics("last_updated")}},s.a.createElement(L.a,{name:"times"}))))))),this.state.searchResult.forEach(function(e,t){var a;e.cover&&(a=s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+e.cover,responsive:!0,style:{maxWidth:"100px",maxHeight:"100px"}})),c.push(s.a.createElement("tr",{key:t},s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){i.openMedia(e)}},e.data_source)),s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){i.openMedia(e)}},e.tags.title?e.tags.title:e.name)),s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){i.openMedia(e)}},e.path)),s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){i.openMedia(e)}},e.nb_play,"\xa0",$.t("common.times"))),s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){i.openMedia(e)}},a))))}),a=s.a.createElement("tr",null,s.a.createElement("td",{colspan:"4"},s.a.createElement("strong",null,$.t("advanced_search.no_result_found")))),this.state.firstLoad||(t=this.state.searching?s.a.createElement("div",null,$.t("advanced_search.searching")," ",s.a.createElement(L.a,{name:"spinner",spin:!0})):s.a.createElement("div",null,s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,sm:12,xs:12,className:"text-right"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{disabled:!this.state.criteria.offset,onClick:function(){i.navigate(-25)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.previous_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-left"}))),s.a.createElement(_.a,{disabled:this.state.offset+this.state.criteria.limit>=c.length,onClick:function(){i.navigate(25)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.next_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-right"})))))),s.a.createElement("table",{className:"table table-striped table-hover"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,$.t("common.data_source")),s.a.createElement("th",null,$.t("common.name")),s.a.createElement("th",null,$.t("common.path")),s.a.createElement("th",null,$.t("common.nb_play")),s.a.createElement("th",null,$.t("common.cover")))),s.a.createElement("tbody",null,c.length?c:a)),s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,sm:12,xs:12,className:"text-right"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{disabled:!this.state.criteria.offset,onClick:function(){i.navigate(-25)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.previous_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-left"}))),s.a.createElement(_.a,{disabled:this.state.offset+this.state.criteria.limit>=c.length,onClick:function(){i.navigate(25)}},s.a.createElement("span",{className:"hidden-sm hidden-xs"},$.t("common.next_page")),s.a.createElement("span",{className:"visible-sm visible-xs"},s.a.createElement(L.a,{name:"chevron-right"})))))))),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:function(e){i.runSearch(e)}},s.a.createElement(P.a,{controlId:"formBasicText",validationState:this.getValidationState()},s.a.createElement(C.a,{collapsible:!0,header:$.t("advanced_search.search_query"),onSelect:this.handleSelectPanel,expanded:this.state.searchPanel},s.a.createElement(S.a,null,s.a.createElement(ge.a,null,$.t("advanced_search.search_query")),s.a.createElement(A.a,{type:"text",value:this.state.criteria.query,placeholder:$.t("advanced_search.text_to_search"),onChange:this.handleChangeQuery})),s.a.createElement(S.a,null,s.a.createElement(ge.a,null,$.t("advanced_search.media_type")),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.select"),value:this.state.criteria.type,onChange:this.handleChangeType},s.a.createElement("option",{value:""},$.t("advanced_search.type_all")),s.a.createElement("option",{value:"audio"},$.t("advanced_search.type_audio")),s.a.createElement("option",{value:"video"},$.t("advanced_search.type_video")),s.a.createElement("option",{value:"image"},$.t("advanced_search.type_image")),s.a.createElement("option",{value:"subtitle"},$.t("advanced_search.type_subtitle")),s.a.createElement("option",{value:"unknown"},$.t("advanced_search.type_unknown")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement("h3",null,$.t("common.data_source"))),s.a.createElement(S.a,null,l),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement("h3",null,$.t("common.tags"))),s.a.createElement(S.a,null,r),s.a.createElement(S.a,{style:{paddingTop:"10px"}},s.a.createElement(_.a,{title:"Add tag",onClick:this.handleAddTag},s.a.createElement(L.a,{name:"plus"}))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement("h3",null,$.t("advanced_search.metrics"))),o,e,s.a.createElement(S.a,{style:{paddingTop:"10px"}},s.a.createElement(_.a,{title:$.t("advanced_search.add_tag"),onClick:this.handleAddMetrics},s.a.createElement(L.a,{name:"plus"}))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement("h3",null,$.t("advanced_search.sort"))),s.a.createElement(S.a,{style:{paddingTop:"10px"}},s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.sort_by"),value:this.state.criteria.sort,onChange:this.handleChangeSort},s.a.createElement("option",{value:"path"},$.t("common.path")),s.a.createElement("option",{value:"name"},$.t("common.name")),s.a.createElement("option",{value:"last_updated"},$.t("advanced_search.last_updated")),s.a.createElement("option",{value:"last_played"},$.t("advanced_search.last_seen")),s.a.createElement("option",{value:"nb_play"},$.t("advanced_search.nb_play")),s.a.createElement("option",{value:"random"},$.t("advanced_search.random"))),s.a.createElement(A.a,{componentClass:"select",placeholder:$.t("advanced_search.sort_direction"),value:this.state.criteria.sort_direction,onChange:this.handleChangeSortDirection},s.a.createElement("option",{value:"asc"},$.t("advanced_search.asc")),s.a.createElement("option",{value:"desc"},$.t("advanced_search.desc")))),s.a.createElement(S.a,null,s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(_.a,{title:$.t("advanced_search.search"),onClick:this.runSearch},$.t("advanced_search.search")," ",s.a.createElement(L.a,{name:"search"}))))),t,s.a.createElement(ne,{show:this.state.modalShow,media:this.state.modalMedia,title:this.state.modalTitle,onClose:this.closeMedia}))}}]),t}(n.Component)),Ie=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,player:e.player||{name:"",description:"",host:"",port:0,password:""},add:e.add,onCloseCb:e.onCloseCb},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeName=a.handleChangeName.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeDescription=a.handleChangeDescription.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeHost=a.handleChangeHost.bind(Object(g.a)(Object(g.a)(a))),a.handleChangePort=a.handleChangePort.bind(Object(g.a)(Object(g.a)(a))),a.handleChangePassword=a.handleChangePassword.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({show:e.show,player:e.player||{name:"",description:"",host:"",port:0,password:""},add:e.add,onCloseCb:e.onCloseCb})}},{key:"close",value:function(e,t){t&&t.preventDefault(),e?this.state.onCloseCb(!0,this.state.add,this.state.player):this.state.onCloseCb(!1)}},{key:"handleChangeName",value:function(e){var t=this.state.player;t.name=e.target.value,this.setState({player:t})}},{key:"handleChangeDescription",value:function(e){var t=this.state.player;t.description=e.target.value,this.setState({player:t})}},{key:"handleChangeHost",value:function(e){var t=this.state.player;t.host=e.target.value,this.setState({player:t})}},{key:"handleChangePort",value:function(e){var t=this.state.player;t.port=e.target.value,this.setState({player:t})}},{key:"handleChangePassword",value:function(e){var t=this.state.player;t.password=e.target.value,this.setState({player:t})}},{key:"render",value:function(){var e=this;return s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,this.state.add?$.t("modal.add_player"):$.t("modal.edit_player"))),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(t){e.close(!0,t)}},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.name"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.player.name,placeholder:$.t("common.name"),disabled:!this.state.add,onChange:this.handleChangeName}))),s.a.createElement("hr",null),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.description"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.player.description,placeholder:$.t("common.description"),onChange:this.handleChangeDescription}))),s.a.createElement("hr",null),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.mpd_host"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.player.host,placeholder:$.t("modal.mpd_host"),onChange:this.handleChangeHost}))),s.a.createElement("hr",null),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.mpd_port"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"number",min:"0",value:this.state.player.port,placeholder:$.t("modal.mpd_port"),onChange:this.handleChangePort}))),s.a.createElement("hr",null),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.mpd_password"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"password",value:this.state.player.password,placeholder:$.t("modal.mpd_password"),onChange:this.handleChangePassword}))))),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!0)}},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),Ve=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={playerList:[],switchList:[],showModal:!1,addPlayer:!0,currentPlayer:{},modalDeleteShow:!1},a.internalPlayerList=[],a.getInitialList(),a.getInitialList=a.getInitialList.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectSwitch=a.handleSelectSwitch.bind(Object(g.a)(Object(g.a)(a))),a.handleSavePlayers=a.handleSavePlayers.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeEnabled=a.handleChangeEnabled.bind(Object(g.a)(Object(g.a)(a))),a.handleAddPlayer=a.handleAddPlayer.bind(Object(g.a)(Object(g.a)(a))),a.handleEditPlayer=a.handleEditPlayer.bind(Object(g.a)(Object(g.a)(a))),a.handleDeletePlayer=a.handleDeletePlayer.bind(Object(g.a)(Object(g.a)(a))),a.savePlayer=a.savePlayer.bind(Object(g.a)(Object(g.a)(a))),a.confirmDeletePlayer=a.confirmDeletePlayer.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({playerList:[],switchList:[],showModal:!1,addPlayer:!0,currentPlayer:{},modalDeleteShow:!1},function(){t.getInitialList()})}},{key:"getInitialList",value:function(){var e=this;G.getState().APIManager.benoicApiRequest("GET","/device").then(function(t){return t.forEach(function(t){return G.getState().APIManager.benoicApiRequest("GET","/device/"+encodeURIComponent(t.name)+"/overview").then(function(a){if(a.switches){var n=e.state.switchList;for(var s in a.switches)a.switches[s].device=t.name,a.switches[s].name=s,n.push(a.switches[s]);return e.setState({switchList:n})}})})}),G.getState().APIManager.carleonApiRequest("GET","/service").then(function(t){t.forEach(function(t){"service-mpd"===t.name&&(t.element.forEach(function(e){var t=G.getState().externalPlayerList.find(function(t){return t.name===e.name});t?(e.enabled=t.enabled,e.switch=t.switch):(e.enabled=!1,e.switch=!1)}),e.setState({playerList:t.element}))})})}},{key:"handleSelectSwitch",value:function(e,t,a){var n=this.state.playerList;for(var s in n)if(n[s].name===e.name){n[s].switch=!(!t||!a)&&{device:t,name:a};break}this.setState({playerList:n})}},{key:"handleSavePlayers",value:function(){var e=[],t=[];this.internalPlayerList.forEach(function(a){var n={name:a.name,switch:a.switch,enabled:a.enabled};e.push(JSON.stringify(n)),t.push(n)}),G.getState().APIManager.taliesinApiRequest("PUT","/config/external_player",e).then(function(){G.dispatch({type:"setExternalPlayerList",externalPlayerList:t}),G.getState().NotificationManager.addNotification({message:$.t("player.message_saved"),level:"info"})})}},{key:"handleChangeEnabled",value:function(e){var t=this.state.playerList;t[e].enabled=!t[e].enabled,this.setState({playerList:t})}},{key:"handleAddPlayer",value:function(){this.setState({showModal:!0,addPlayer:!0,currentPlayer:!1})}},{key:"handleEditPlayer",value:function(e){this.setState({showModal:!0,addPlayer:!1,currentPlayer:e})}},{key:"handleDeletePlayer",value:function(e){this.setState({modalDeleteShow:!0,currentPlayer:e})}},{key:"savePlayer",value:function(e,t,a){var n=this;this.setState({showModal:!1},function(){e&&(t?G.getState().APIManager.carleonApiRequest("POST","/service-mpd/",{name:a.name,description:a.description||void 0,host:a.host||void 0,port:a.port||void 0,password:a.password||void 0}).then(function(e){G.getState().NotificationManager.addNotification({message:$.t("player.message_saved"),level:"info"}),n.getInitialList()}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("player.message_saved_error"),level:"error"})}):G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(a.name),{description:a.description||void 0,host:a.host||void 0,port:a.port||void 0,password:a.password||void 0}).then(function(e){G.getState().NotificationManager.addNotification({message:$.t("player.message_saved"),level:"info"}),n.getInitialList()}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("player.message_saved_error"),level:"error"})}))})}},{key:"confirmDeletePlayer",value:function(e){var t=this;this.setState({modalDeleteShow:!1},function(){e&&G.getState().APIManager.carleonApiRequest("DELETE","/service-mpd/"+encodeURIComponent(t.state.currentPlayer.name)).then(function(e){G.getState().NotificationManager.addNotification({message:$.t("player.message_deleted"),level:"info"}),t.getInitialList()}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("player.message_deleted_error"),level:"error"})})})}},{key:"render",value:function(){var e=this,t=[];return this.internalPlayerList=[],this.state.playerList.forEach(function(a,n){var i,l=[s.a.createElement(y.a,{key:"0",eventKey:"0",onClick:function(){return e.handleSelectSwitch(a)},className:a.switch?"":"bg-success"},$.t("common.none"))];i=a.enabled?s.a.createElement(de.a,{type:"checkbox",defaultValue:["1"],onChange:function(){e.handleChangeEnabled(n)}},s.a.createElement(ue.a,{value:"1"},$.t("common.enabled"))):s.a.createElement(de.a,{type:"checkbox",onChange:function(){e.handleChangeEnabled(n)}},s.a.createElement(ue.a,{value:"1"},$.t("common.disabled"))),e.state.switchList.forEach(function(t,n){l.push(s.a.createElement(y.a,{key:n+1,eventKey:n+1,onClick:function(){return e.handleSelectSwitch(a,t.device,t.name)},className:a.switch&&a.switch.device===t.device&&a.switch.name===t.name?"bg-success":""},t.display))}),t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,a.name),s.a.createElement("td",null,s.a.createElement(ee.a,{id:"switch-"+a.name,title:e.state.switchList.length&&a.switch?e.state.switchList.find(function(e){return e.name===a.switch.name}).display:$.t("common.none")},l)),s.a.createElement("td",null,s.a.createElement(de.a,{type:"checkbox",defaultValue:[1]},i)),s.a.createElement("td",null,s.a.createElement(Z.a,null,s.a.createElement(_.a,{onClick:function(){e.handleEditPlayer(a)},title:$.t("common.edit")},s.a.createElement(L.a,{name:"pencil"})),s.a.createElement(_.a,{onClick:function(){e.handleDeletePlayer(a)},title:$.t("common.delete")},s.a.createElement(L.a,{name:"trash"})))))),e.internalPlayerList.push(a)}),s.a.createElement("div",null,s.a.createElement(_.a,{onClick:function(){e.handleAddPlayer()},title:$.t("common.add")},s.a.createElement(L.a,{name:"plus"})),s.a.createElement("table",{className:"table"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("td",null,$.t("common.name")),s.a.createElement("td",null,$.t("player.switch_attached")),s.a.createElement("td",null,$.t("common.enabled")),s.a.createElement("td",null))),s.a.createElement("tbody",null,t)),s.a.createElement(_.a,{title:$.t("common.save"),onClick:this.handleSavePlayers},$.t("common.save")),s.a.createElement(Ie,{show:this.state.showModal,player:this.state.currentPlayer,add:this.state.addPlayer,onCloseCb:this.savePlayer}),s.a.createElement(oe,{show:this.state.modalDeleteShow,title:$.t("player.delete_title"),message:$.t("player.delete_message",{player:this.state.currentPlayer.name}),onCloseCb:this.confirmDeletePlayer}))}}]),t}(n.Component),Ue=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:e.show,dataSource:e.add?{name:"",description:"",icon:"",scope:"me",path:""}:e.dataSource,iconPath:"",onCloseCb:e.onCloseCb,add:e.add},a.close=a.close.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeName=a.handleChangeName.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeDescription=a.handleChangeDescription.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeScope=a.handleChangeScope.bind(Object(g.a)(Object(g.a)(a))),a.handleChangePath=a.handleChangePath.bind(Object(g.a)(Object(g.a)(a))),a.getNameValidationState=a.getNameValidationState.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({show:e.show,dataSource:e.add?{name:"",description:"",icon:"",scope:"me",path:""}:e.dataSource,iconPath:"",onCloseCb:e.onCloseCb,add:e.add,nameValidateMessage:""})}},{key:"close",value:function(e,t){var a=this;t&&t.preventDefault(),e&&this.state.onCloseCb?this.state.onCloseCb(this.state.dataSource,this.state.add):this.setState({show:!1},function(){a.state.onCloseCb(!1,a.state.add)})}},{key:"getNameValidationState",value:function(){var e=this;return this.state.add?this.state.dataSource.name?G.getState().dataSourceList.find(function(t){return t.name===e.state.dataSource.name})?"error":"success":"error":"success"}},{key:"handleChangeName",value:function(e){var t=this.state.dataSource;t.name=e.target.value,this.setState({dataSource:t})}},{key:"handleChangeDescription",value:function(e){var t=this.state.dataSource;t.description=e.target.value,this.setState({dataSource:t})}},{key:"handleChangeScope",value:function(e){var t=this.state.dataSource;t.scope=e.target.value,this.setState({dataSource:t})}},{key:"handleChangePath",value:function(e){var t=this.state.dataSource;t.path=e.target.value,this.setState({dataSource:t})}},{key:"render",value:function(){var e=this,t=this.state.add?$.t("modal.title_add_data_source"):$.t("modal.title_edit_data_source",{data_source:this.state.dataSource.name}),a="",n=s.a.createElement("span",null,"me"===this.state.dataSource.scope?"Me":"All");return G.getState().profile.isAdmin&&this.state.add&&(n=s.a.createElement(A.a,{value:this.state.dataSource.scope,onChange:this.handleChangeScope,disabled:!this.state.add,componentClass:"select",placeholder:$.t("common.select")},s.a.createElement("option",{value:"me"},$.t("common.scope_me")),s.a.createElement("option",{value:"all"},$.t("common.scope_all")))),this.state.add&&(a=s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("modal.path_on_server"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.dataSource.path,placeholder:$.t("modal.enter_valid_path"),onChange:this.handleChangePath}))))),s.a.createElement(X.a,{show:this.state.show},s.a.createElement(X.a.Header,null,s.a.createElement(X.a.Title,null,t)),s.a.createElement(X.a.Body,null,s.a.createElement("form",{onSubmit:function(t){e.close(!0,t)}},s.a.createElement(P.a,{controlId:"formName",validationState:this.getNameValidationState()},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.name"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.dataSource.name,placeholder:$.t("common.name"),onChange:this.handleChangeName,disabled:!this.state.add})))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.description"))),s.a.createElement(E.a,{md:8},s.a.createElement(A.a,{type:"text",value:this.state.dataSource.description,placeholder:$.t("common.description"),onChange:this.handleChangeDescription}))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(te.a,null,$.t("common.scope"))),s.a.createElement(E.a,{md:8},n)),a)),s.a.createElement(X.a.Footer,null,s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!0)},disabled:"success"!==this.getNameValidationState()},$.t("common.ok")),s.a.createElement(_.a,{bsStyle:"primary",onClick:function(){return e.close(!1)}},$.t("common.cancel"))))}}]),t}(n.Component),De=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSourceList:G.getState().dataSourceList,dataSourceToDelete:!1,isAdmin:G.getState().profile.isAdmin,refreshStatus:{},modalShow:!1,dataSourceEdit:!1,modalAdd:!1,modalDeleteShow:!1,modalDeleteMessage:""},a.canUpdate=a.canUpdate.bind(Object(g.a)(Object(g.a)(a))),a.editDataSource=a.editDataSource.bind(Object(g.a)(Object(g.a)(a))),a.refreshDataSource=a.refreshDataSource.bind(Object(g.a)(Object(g.a)(a))),a.stopRefreshDataSource=a.stopRefreshDataSource.bind(Object(g.a)(Object(g.a)(a))),a.cleanDataSource=a.cleanDataSource.bind(Object(g.a)(Object(g.a)(a))),a.deleteDataSource=a.deleteDataSource.bind(Object(g.a)(Object(g.a)(a))),a.confirmDeleteDataSource=a.confirmDeleteDataSource.bind(Object(g.a)(Object(g.a)(a))),a.getRefreshStatusList=a.getRefreshStatusList.bind(Object(g.a)(Object(g.a)(a))),a.getRefreshStatus=a.getRefreshStatus.bind(Object(g.a)(Object(g.a)(a))),a.addDataSource=a.addDataSource.bind(Object(g.a)(Object(g.a)(a))),a.refreshDataSourceList=a.refreshDataSourceList.bind(Object(g.a)(Object(g.a)(a))),a.onCloseModal=a.onCloseModal.bind(Object(g.a)(Object(g.a)(a))),a.openDataSource=a.openDataSource.bind(Object(g.a)(Object(g.a)(a))),a.getRefreshStatusList(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSourceList:G.getState().dataSourceList,dataSourceToDelete:!1,isAdmin:G.getState().profile.isAdmin,refreshStatus:{},modalShow:!1,dataSourceEdit:!1,modalAdd:!1,modalDeleteShow:!1,modalDeleteMessage:""})}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"getRefreshStatusList",value:function(){var e=this;this.state.dataSourceList.forEach(function(t){e.getRefreshStatus(t)})}},{key:"getRefreshStatus",value:function(e){var t=this;this.state.modalShow||this.state.modalDeleteShow?!this._ismounted||"running"!==this.state.refreshStatus[e.name].status&&"pending"!==this.state.refreshStatus[e.name].status&&"preparing"!==this.state.refreshStatus[e.name].status||window.setTimeout(function(){t.getRefreshStatus(e)},5e3):G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(e.name)+"/refresh/").then(function(a){var n=t.state.refreshStatus;n[e.name]=a,t.setState({refreshStatus:n}),e.status=a.status,G.dispatch({type:"setDataSource",dataSource:e}),!t._ismounted||"running"!==a.status&&"pending"!==a.status&&"preparing"!==a.status||window.setTimeout(function(){t.getRefreshStatus(e)},5e3)})}},{key:"canUpdate",value:function(e){return this.state.isAdmin||"me"===e.scope}},{key:"getRefreshStatusValue",value:function(e){return!!this.state.refreshStatus[e.name]&&this.state.refreshStatus[e.name].status}},{key:"editDataSource",value:function(e){this.setState({modalShow:!0,modalAdd:!1,dataSourceEdit:e})}},{key:"addDataSource",value:function(){this.setState({modalShow:!0,modalAdd:!0})}},{key:"refreshDataSourceList",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("GET","/data_source").then(function(t){G.dispatch({type:"setDataSourceList",dataSourceList:t,loaded:!0}),e.getRefreshStatusList()}).fail(function(e){G.dispatch({type:"setDataSourceList",dataSourceList:[],currentDataSource:!1,loaded:!0})})}},{key:"onCloseModal",value:function(e,t){var a=this;e?t?G.getState().APIManager.taliesinApiRequest("POST","/data_source/",e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_added_ok"),level:"info"});var t=a.state.dataSourceList;t.push(e),a.setState({dataSourceList:t,modalShow:!1}),a.getRefreshStatus(e),1===t.length&&G.dispatch({type:"setCurrentDataSource",currentDataSource:e}),a.refreshDataSource(e)}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_add_error"),level:"error"})}):G.getState().APIManager.taliesinApiRequest("PUT","/data_source/"+encodeURIComponent(e.name),e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_updated_ok"),level:"info"});var t=a.state.dataSourceList;for(var n in t)if(t[n].name===e.name){t[n]=e,a.setState({dataSourceList:t,modalShow:!1});break}}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_update_error"),level:"error"})}):this.setState({modalShow:!1})}},{key:"refreshDataSource",value:function(e){var t=this;G.getState().APIManager.taliesinApiRequest("PUT","/data_source/"+encodeURIComponent(e.name)+"/refresh/").then(function(){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_refresh_started"),level:"info"}),t.getRefreshStatus(e)}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_refresh_error"),level:"error"})})}},{key:"stopRefreshDataSource",value:function(e){var t=this;G.getState().APIManager.taliesinApiRequest("DELETE","/data_source/"+encodeURIComponent(e.name)+"/refresh/").then(function(){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_refresh_stopped"),level:"info"}),t.getRefreshStatus(e)}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_refresh_stop_error"),level:"error"})})}},{key:"cleanDataSource",value:function(e){var t=this;G.getState().APIManager.taliesinApiRequest("POST","/data_source/"+encodeURIComponent(e.name)+"/clean/").then(function(){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_clean_started"),level:"info"});var a=t.state.refreshStatus;a[e.name]={status:"prepare"},t.setState({refreshStatus:a}),t.getRefreshStatus(e)}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_clean_error"),level:"error"})})}},{key:"deleteDataSource",value:function(e){this.setState({dataSourceToDelete:e,modalDeleteShow:!0,modalDeleteMessage:$.t("data_source.message_confirm_delete",{data_source:e.name})})}},{key:"openDataSource",value:function(e){G.dispatch({type:"setCurrentDataSource",currentDataSource:e}),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:""})}},{key:"confirmDeleteDataSource",value:function(e){var t=this;this.setState({modalDeleteShow:!1},function(){e&&G.getState().APIManager.taliesinApiRequest("DELETE","/data_source/"+encodeURIComponent(t.state.dataSourceToDelete.name)).then(function(){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_delete_ok"),level:"info"});var e=t.state.dataSourceList;for(var a in e)if(e[a].name===t.state.dataSourceToDelete.name){e.splice(a,1),t.setState({dataSourceList:e});break}var n=t.state.refreshStatus;delete n[t.state.dataSourceToDelete.name],t.setState({refreshStatus:n})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("data_source.message_delete_error"),level:"error"})})})}},{key:"render",value:function(){var e=this,t=[];return this.state.dataSourceList.forEach(function(a,n){var i="";if(e.state.refreshStatus[a.name])if("not running"===e.state.refreshStatus[a.name].status)i=s.a.createElement(L.a,{name:"check"});else if("running"===e.state.refreshStatus[a.name].status){var l="0%";e.state.refreshStatus[a.name].total&&(l=Math.round(1e4*e.state.refreshStatus[a.name].read/e.state.refreshStatus[a.name].total)/100+"%"),i=s.a.createElement("div",null,s.a.createElement(L.a,{name:"spinner",spin:!0}),"\xa0",s.a.createElement("span",null,l))}else i="pending"===e.state.refreshStatus[a.name].status?s.a.createElement(L.a,{name:"pause"}):"prepare"===e.state.refreshStatus[a.name].status?s.a.createElement("div",null,s.a.createElement(L.a,{name:"spinner",spin:!0}),"\xa0",s.a.createElement("span",null,$.t("data_source.refresh_prepare"))):"error"===e.state.refreshStatus[a.name].status?s.a.createElement(L.a,{name:"exclamation-circle"}):s.a.createElement(L.a,{name:"question"});t.push(s.a.createElement("tr",{key:n},s.a.createElement("td",null,s.a.createElement("a",{role:"button",onClick:function(){return e.openDataSource(a)}},a.name)),s.a.createElement("td",{className:"hidden-xs"},s.a.createElement("a",{role:"button",onClick:function(){return e.openDataSource(a)}},a.description)),s.a.createElement("td",{className:"text-center"},"all"===a.scope?s.a.createElement(L.a,{name:"users"}):s.a.createElement(L.a,{name:"user"})),s.a.createElement("td",{className:"hidden-xs"},a.last_updated?new Date(1e3*a.last_updated).toLocaleString():""),s.a.createElement("td",{className:"text-center"},i),s.a.createElement("td",{className:"text-center"},s.a.createElement(Z.a,{className:"hidden-xs"},s.a.createElement(_.a,{title:$.t("common.edit"),onClick:function(){return e.editDataSource(a)},disabled:!e.canUpdate(a)},s.a.createElement(L.a,{name:"pencil"})),s.a.createElement(_.a,{title:$.t("data_source.refresh"),onClick:function(){return e.refreshDataSource(a)},disabled:!e.canUpdate(a)||"not running"!==e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"refresh"})),s.a.createElement(_.a,{title:$.t("data_source.stop_refresh"),onClick:function(){return e.stopRefreshDataSource(a)},disabled:!e.canUpdate(a)||"not running"===e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"stop"})),s.a.createElement(_.a,{title:$.t("data_source.clean"),onClick:function(){return e.cleanDataSource(a)},disabled:!e.canUpdate(a)||"not running"!==e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"eraser"})),s.a.createElement(_.a,{title:$.t("common.delete"),onClick:function(){return e.deleteDataSource(a)},disabled:!e.canUpdate(a)||"not running"!==e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"trash"}))),s.a.createElement(ee.a,{className:"visible-xs",id:"xs-manage"-a.name,pullRight:!0,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"}))},s.a.createElement(y.a,{onClick:function(){return e.editDataSource(a)},disabled:!e.canUpdate(a)},s.a.createElement(L.a,{name:"pencil"}),"\xa0",$.t("common.edit")),s.a.createElement(y.a,{onClick:function(){return e.refreshDataSource(a)},disabled:!e.canUpdate(a)||"not running"!==e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"refresh"}),"\xa0",$.t("data_source.refresh")),s.a.createElement(y.a,{onClick:function(){return e.stopRefreshDataSource(a)},disabled:!e.canUpdate(a)||"not running"===e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"stop"}),"\xa0",$.t("data_source.stop_refresh")),s.a.createElement(y.a,{onClick:function(){return e.cleanDataSource(a)},disabled:!e.canUpdate(a)||"not running"!==e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"eraser"}),"\xa0",$.t("data_source.clean")),s.a.createElement(y.a,{onClick:function(){return e.deleteDataSource(a)},disabled:!e.canUpdate(a)||"not running"!==e.getRefreshStatusValue(a)},s.a.createElement(L.a,{name:"trash"}),"\xa0",$.t("common.delete"))))))}),s.a.createElement("div",null,s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("data_source.add"),onClick:function(){return e.addDataSource()}},s.a.createElement(L.a,{name:"plus"})),s.a.createElement(_.a,{title:$.t("data_source.refresh"),onClick:function(){return e.refreshDataSourceList()}},s.a.createElement(L.a,{name:"refresh"}))),s.a.createElement(re.a,{striped:!0,bordered:!0,condensed:!0,hover:!0},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,$.t("common.name")),s.a.createElement("th",{className:"hidden-xs"},$.t("common.description")),s.a.createElement("th",null,$.t("common.scope")),s.a.createElement("th",{className:"hidden-xs"},$.t("data_source.last_refresh")),s.a.createElement("th",null,$.t("data_source.refresh_status")),s.a.createElement("th",null))),s.a.createElement("tbody",null,t)),s.a.createElement(Ue,{show:this.state.modalShow,onCloseCb:this.onCloseModal,dataSource:this.state.dataSourceEdit,add:this.state.modalAdd}),s.a.createElement(oe,{show:this.state.modalDeleteShow,title:$.t("data_source.delete_title"),message:this.state.modalDeleteMessage,onCloseCb:this.confirmDeleteDataSource}))}}]),t}(n.Component),Be=a(68),qe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={audioExtensions:[],videoExtensions:[],subtitleExtensions:[],imageExtensions:[],coverFilePattern:[]},a.getConfigValues(),a.getConfigValues=a.getConfigValues.bind(Object(g.a)(Object(g.a)(a))),a.handleDeleteAudioExtensions=a.handleDeleteAudioExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleAdditionAudioExtensions=a.handleAdditionAudioExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDragAudioExtensions=a.handleDragAudioExtensions.bind(Object(g.a)(Object(g.a)(a))),a.saveAudioExtensions=a.saveAudioExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDeleteVideoExtensions=a.handleDeleteVideoExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleAdditionVideoExtensions=a.handleAdditionVideoExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDragVideoExtensions=a.handleDragVideoExtensions.bind(Object(g.a)(Object(g.a)(a))),a.saveVideoExtensions=a.saveVideoExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDeleteSubtitleExtensions=a.handleDeleteSubtitleExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleAdditionSubtitleExtensions=a.handleAdditionSubtitleExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDragSubtitleExtensions=a.handleDragSubtitleExtensions.bind(Object(g.a)(Object(g.a)(a))),a.saveSubtitleExtensions=a.saveSubtitleExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDeleteImageExtensions=a.handleDeleteImageExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleAdditionImageExtensions=a.handleAdditionImageExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDragImageExtensions=a.handleDragImageExtensions.bind(Object(g.a)(Object(g.a)(a))),a.saveImageExtensions=a.saveImageExtensions.bind(Object(g.a)(Object(g.a)(a))),a.handleDeleteCoverFilePattern=a.handleDeleteCoverFilePattern.bind(Object(g.a)(Object(g.a)(a))),a.handleAdditionCoverFilePattern=a.handleAdditionCoverFilePattern.bind(Object(g.a)(Object(g.a)(a))),a.handleDragCoverFilePattern=a.handleDragCoverFilePattern.bind(Object(g.a)(Object(g.a)(a))),a.saveCoverFilePattern=a.saveCoverFilePattern.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"getConfigValues",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("GET","/config/audio_file_extension").then(function(t){var a=[];t.forEach(function(e,t){a.push({id:t,text:e})}),e.setState({audioExtensions:a})}),G.getState().APIManager.taliesinApiRequest("GET","/config/video_file_extension").then(function(t){var a=[];t.forEach(function(e,t){a.push({id:t,text:e})}),e.setState({videoExtensions:a})}),G.getState().APIManager.taliesinApiRequest("GET","/config/subtitle_file_extension").then(function(t){var a=[];t.forEach(function(e,t){a.push({id:t,text:e})}),e.setState({subtitleExtensions:a})}),G.getState().APIManager.taliesinApiRequest("GET","/config/image_file_extension").then(function(t){var a=[];t.forEach(function(e,t){a.push({id:t,text:e})}),e.setState({imageExtensions:a})}),G.getState().APIManager.taliesinApiRequest("GET","/config/cover_file_pattern").then(function(t){var a=[];t.forEach(function(e,t){a.push({id:t,text:e})}),e.setState({coverFilePattern:a})})}},{key:"handleDeleteAudioExtensions",value:function(e){var t=this.state.audioExtensions;t.splice(e,1),this.setState({audioExtensions:t})}},{key:"handleAdditionAudioExtensions",value:function(e){var t=this.state.audioExtensions;t.push({id:t.length+1,text:e}),this.setState({audioExtensions:t})}},{key:"handleDragAudioExtensions",value:function(e,t,a){var n=this.state.audioExtensions;n.splice(t,1),n.splice(a,0,e),this.setState({audioExtensions:n})}},{key:"saveAudioExtensions",value:function(){var e=[];this.state.audioExtensions.forEach(function(t){e.push(t.text)}),G.getState().APIManager.taliesinApiRequest("PUT","/config/audio_file_extension",e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_success"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_error"),level:"error"})})}},{key:"handleDeleteVideoExtensions",value:function(e){var t=this.state.videoExtensions;t.splice(e,1),this.setState({videoExtensions:t})}},{key:"handleAdditionVideoExtensions",value:function(e){var t=this.state.videoExtensions;t.push({id:t.length+1,text:e}),this.setState({videoExtensions:t})}},{key:"handleDragVideoExtensions",value:function(e,t,a){var n=this.state.videoExtensions;n.splice(t,1),n.splice(a,0,e),this.setState({videoExtensions:n})}},{key:"saveVideoExtensions",value:function(){var e=[];this.state.videoExtensions.forEach(function(t){e.push(t.text)}),G.getState().APIManager.taliesinApiRequest("PUT","/config/video_file_extension",e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_success"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_error"),level:"error"})})}},{key:"handleDeleteSubtitleExtensions",value:function(e){var t=this.state.subtitleExtensions;t.splice(e,1),this.setState({subtitleExtensions:t})}},{key:"handleAdditionSubtitleExtensions",value:function(e){var t=this.state.subtitleExtensions;t.push({id:t.length+1,text:e}),this.setState({subtitleExtensions:t})}},{key:"handleDragSubtitleExtensions",value:function(e,t,a){var n=this.state.subtitleExtensions;n.splice(t,1),n.splice(a,0,e),this.setState({subtitleExtensions:n})}},{key:"saveSubtitleExtensions",value:function(){var e=[];this.state.subtitleExtensions.forEach(function(t){e.push(t.text)}),G.getState().APIManager.taliesinApiRequest("PUT","/config/subtitle_file_extension",e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_success"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_error"),level:"error"})})}},{key:"handleDeleteImageExtensions",value:function(e){var t=this.state.imageExtensions;t.splice(e,1),this.setState({imageExtensions:t})}},{key:"handleAdditionImageExtensions",value:function(e){var t=this.state.imageExtensions;t.push({id:t.length+1,text:e}),this.setState({imageExtensions:t})}},{key:"handleDragImageExtensions",value:function(e,t,a){var n=this.state.imageExtensions;n.splice(t,1),n.splice(a,0,e),this.setState({imageExtensions:n})}},{key:"saveImageExtensions",value:function(){var e=[];this.state.imageExtensions.forEach(function(t){e.push(t.text)}),G.getState().APIManager.taliesinApiRequest("PUT","/config/image_file_extension",e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_success"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_error"),level:"error"})})}},{key:"handleDeleteCoverFilePattern",value:function(e){var t=this.state.coverFilePattern;t.splice(e,1),this.setState({coverFilePattern:t})}},{key:"handleAdditionCoverFilePattern",value:function(e){var t=this.state.coverFilePattern;t.push({id:t.length+1,text:e}),this.setState({coverFilePattern:t})}},{key:"handleDragCoverFilePattern",value:function(e,t,a){var n=this.state.coverFilePattern;n.splice(t,1),n.splice(a,0,e),this.setState({coverFilePattern:n})}},{key:"saveCoverFilePattern",value:function(){var e=[];this.state.coverFilePattern.forEach(function(t){e.push(t.text)}),G.getState().APIManager.taliesinApiRequest("PUT","/config/cover_file_pattern",e).then(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_success"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("config.message_save_error"),level:"error"})})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h3",null,$.t("config.audioExtensions")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:11,sm:11,xs:11},s.a.createElement(Be.WithContext,{tags:this.state.audioExtensions,handleDelete:this.handleDeleteAudioExtensions,handleAddition:this.handleAdditionAudioExtensions,handleDrag:this.handleDragAudioExtensions})),s.a.createElement(E.a,{md:1,sm:1,xs:1},s.a.createElement(_.a,{bsStyle:"primary",onClick:this.saveAudioExtensions},$.t("common.save")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h3",null,$.t("config.videoExtensions")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:11,sm:11,xs:11},s.a.createElement(Be.WithContext,{tags:this.state.videoExtensions,handleDelete:this.handleDeleteVideoExtensions,handleAddition:this.handleAdditionVideoExtensions,handleDrag:this.handleDragVideoExtensions})),s.a.createElement(E.a,{md:1,sm:1,xs:1},s.a.createElement(_.a,{bsStyle:"primary",onClick:this.saveVideoExtensions},$.t("common.save")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h3",null,$.t("config.subtitleExtensions")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:11,sm:11,xs:11},s.a.createElement(Be.WithContext,{tags:this.state.subtitleExtensions,handleDelete:this.handleDeleteSubtitleExtensions,handleAddition:this.handleAdditionSubtitleExtensions,handleDrag:this.handleDragSubtitleExtensions})),s.a.createElement(E.a,{md:1,sm:1,xs:1},s.a.createElement(_.a,{bsStyle:"primary",onClick:this.saveSubtitleExtensions},$.t("common.save")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h3",null,$.t("config.imageExtensions")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:11,sm:11,xs:11},s.a.createElement(Be.WithContext,{tags:this.state.imageExtensions,handleDelete:this.handleDeleteImageExtensions,handleAddition:this.handleAdditionImageExtensions,handleDrag:this.handleDragImageExtensions})),s.a.createElement(E.a,{md:1,sm:1,xs:1},s.a.createElement(_.a,{bsStyle:"primary",onClick:this.saveImageExtensions},$.t("common.save")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("h3",null,$.t("config.coverFilePattern")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:11,sm:11,xs:11},s.a.createElement(Be.WithContext,{tags:this.state.coverFilePattern,handleDelete:this.handleDeleteCoverFilePattern,handleAddition:this.handleAdditionCoverFilePattern,handleDrag:this.handleDragCoverFilePattern})),s.a.createElement(E.a,{md:1,sm:1,xs:1},s.a.createElement(_.a,{bsStyle:"primary",onClick:this.saveCoverFilePattern},$.t("common.save")))),s.a.createElement(S.a,null,s.a.createElement("hr",null)))}}]),t}(n.Component),Fe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={stream:e.stream,media:e.media,index:e.index,elements:e.elements,date:e.date,imgThumbBlob:!1,coverLoaded:!1,modalShow:!1,modalTitle:a.buildTitle(e.media),visible:!1,highlight:e.highlight},a.loadCover=a.loadCover.bind(Object(g.a)(Object(g.a)(a))),a.handleOpenModal=a.handleOpenModal.bind(Object(g.a)(Object(g.a)(a))),a.handlePlayNow=a.handlePlayNow.bind(Object(g.a)(Object(g.a)(a))),a.handleRemove=a.handleRemove.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectDataSource=a.handleSelectDataSource.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectArtist=a.handleSelectArtist.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectAlbum=a.handleSelectAlbum.bind(Object(g.a)(Object(g.a)(a))),a.onChangeVisibility=a.onChangeVisibility.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({stream:e.stream,media:e.media,index:e.index,elements:e.elements,date:e.date,imgThumbBlob:!1,coverLoaded:!1,modalShow:!1,modalTitle:this.buildTitle(e.media),visible:!1,highlight:e.highlight})}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"buildTitle",value:function(e,t,a){var n="";return e&&(t>-1&&(n+=(t+1<10?"0"+(t+1):t+1)+"/"+(a<10?"0"+a:a)+" - "),e.tags?(-1===t&&(e.tags.artist||e.tags.album_artist)&&(n+=(e.tags.artist||e.tags.album_artist)+" - "),n+=e.tags.title||e.name.replace(/\.[^\/.]+$/,"")):n+=e.name.replace(/\.[^\/.]+$/,"")),n}},{key:"loadCover",value:function(){var e=this;this.state.media.data_source&&this.state.media.path&&this._ismounted&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.media.data_source)+"/browse/path/"+encodeURI(this.state.media.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(t){e.setState({imgThumbBlob:t,coverLoaded:!0})}).fail(function(){e.setState({imgThumbBlob:!1,coverLoaded:!0})})}},{key:"handleOpenModal",value:function(){this._ismounted&&this.setState({modalShow:!0})}},{key:"handlePlayNow",value:function(){var e=this;G.dispatch({type:"loadStreamAndPlay",stream:G.getState().streamList.find(function(t){return t.name===e.state.stream}),index:this.state.index})}},{key:"handleRemove",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream)+"/manage",{command:"remove_list",parameters:{index:this.state.index}}).then(function(){var t=G.getState().streamList;for(var a in t)if(t[a].name===e.state.stream){t[a].elements--,G.dispatch({type:"setStreamList",streamList:t}),G.dispatch({type:"setCurrentBrowse",browse:"showStreamMediaList"});break}})}},{key:"handleSelectDataSource",value:function(){var e=this;G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(t){return t.name===e.state.media.data_source})}),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:""})}},{key:"handleSelectArtist",value:function(){var e=this;G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(t){return t.name===e.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"artist",categoryValue:this.state.media.tags.artist||this.state.media.tags.album_artist})}},{key:"handleSelectAlbum",value:function(){var e=this;G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(t){return t.name===e.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"album",categoryValue:this.state.media.tags.album})}},{key:"onChangeVisibility",value:function(e){var t=this;this.setState({visible:e},function(){e&&!t.state.coverLoaded&&t.loadCover()})}},{key:"render",value:function(){var e,t,a,n,i,l;return this.state.media.tags?(e=this.state.media.tags.artist||this.state.media.tags.album_artist,t=this.state.media.tags.album,a=this.state.media.tags.title||this.state.media.name):a=this.state.media.name,this.state.date?n=s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(te.a,{className:"visible-xs visible-sm"},$.t("common.date"))," ",new Date(1e3*this.state.date).toLocaleString()):this.state.stream&&!this.state.stream.webradio?l=s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("common.play_now"),onClick:this.handlePlayNow},s.a.createElement(L.a,{name:"play"})),s.a.createElement(_.a,{title:$.t("common.remove_from_list"),onClick:this.handleRemove},s.a.createElement(L.a,{name:"trash"}))),"\xa0\xa0",(this.state.elements>=10&&this.state.index<9?"0":"")+(this.state.index+1)+"/"+this.state.elements,"\xa0",this.state.highlight?s.a.createElement(L.a,{name:"music"}):""):this.state.stream&&this.state.stream.webradio&&(l=s.a.createElement(E.a,{md:2,sm:12,xs:12},this.state.highlight?s.a.createElement(L.a,{name:"music"}):"")),i=this.state.imgThumbBlob?s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.imgThumbBlob,thumbnail:!0,responsive:!0,className:"cover-image-thumb"}):s.a.createElement(b.a,{src:"/images/album-128.png",alt:this.state.media.name,className:"cover-image-thumb",responsive:!0}),s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,{className:"row-media"+(this.state.highlight?" bg-success":"")},n,l,s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(te.a,{className:"visible-xs visible-sm"},$.t("common.data_source")),s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:this.handleSelectDataSource},this.state.media.data_source))),s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(te.a,{className:"visible-xs visible-sm"},$.t("common.artist")),s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:this.handleSelectArtist},e))),s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(te.a,{className:"visible-xs visible-sm"},$.t("common.album")),s.a.createElement("span",null,s.a.createElement("a",{role:"button",onClick:this.handleSelectAlbum},t))),s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(te.a,{className:"visible-xs visible-sm"},$.t("common.title")),s.a.createElement("a",{role:"button",onClick:this.handleOpenModal},a)),s.a.createElement(E.a,{md:2,sm:12,xs:12},s.a.createElement(ve.a,{scrollCheck:!0,scrollThrottle:100,intervalDelay:8e3,onChange:this.onChangeVisibility,minTopValue:10,partialVisibility:!0},s.a.createElement("a",{role:"button",onClick:this.handleOpenModal},i)))),s.a.createElement(ne,{show:this.state.modalShow,media:this.state.media,title:this.state.modalTitle}))}}]),t}(n.Component),Ge=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={stream:e.stream,list:[],offset:a.getInitialoffset(e.stream),limit:100,listLoaded:!1},a.getMediaList(),G.subscribe(function(){var e=G.getState();"loadStreamAndPlay"!==e.lastAction&&"setJukeboxIndex"!==e.lastAction||a.getMediaList()}),a.getMediaList=a.getMediaList.bind(Object(g.a)(Object(g.a)(a))),a.handleMediaListPrevious=a.handleMediaListPrevious.bind(Object(g.a)(Object(g.a)(a))),a.handleMediaListNext=a.handleMediaListNext.bind(Object(g.a)(Object(g.a)(a))),a.getInitialoffset=a.getInitialoffset.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({stream:e.stream,list:[],offset:this.getInitialoffset(e.stream),limit:100,listLoaded:!1},function(){t.getMediaList()})}},{key:"getInitialoffset",value:function(e){var t=0;return e.name&&e.name===G.getState().profile.stream.name&&(t=e.webradio?G.getState().profile.mediaNow&&G.getState().profile.mediaNow.index:G.getState().profile.jukeboxIndex),t>100?t-=5:t=0,t}},{key:"getMediaList",value:function(){var e=this;this.state.stream.name&&G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"list",parameters:{offset:this.state.offset,limit:this.state.limit}}).then(function(t){var a=[];t.forEach(function(t,n){G.getState().profile.mediaNow&&t.data_source===G.getState().profile.mediaNow.data_source&&t.path===G.getState().profile.mediaNow.path?a.push(s.a.createElement(Fe,{stream:!e.state.stream.webradio&&e.state.stream.name,elements:e.state.stream.elements,media:t,index:n+e.state.offset,key:n,highlight:!0})):a.push(s.a.createElement(Fe,{stream:!e.state.stream.webradio&&e.state.stream.name,elements:e.state.stream.elements,media:t,index:n+e.state.offset,key:n}))}),e.setState({list:a,listLoaded:!0})})}},{key:"handleMediaListPrevious",value:function(){var e=this,t=this.state.offset-this.state.limit;t<0&&(t=0),this.setState({offset:t,listLoaded:!1},function(){e.getMediaList()})}},{key:"handleMediaListNext",value:function(){var e=this;this.setState({offset:this.state.offset+this.state.limit,listLoaded:!1},function(){e.getMediaList()})}},{key:"render",value:function(){var e;return this.state.stream.webradio||(e=s.a.createElement(E.a,{md:2})),s.a.createElement("div",null,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:4},s.a.createElement(Z.a,null,s.a.createElement(_.a,{onClick:this.handleMediaListPrevious,disabled:!this.state.offset},$.t("common.previous_page")),s.a.createElement(_.a,{onClick:this.handleMediaListNext,disabled:this.state.offset+this.state.list.length>=this.state.stream.elements},$.t("common.next_page")))),s.a.createElement(E.a,{md:2,sm:6,xs:6},s.a.createElement(te.a,null,$.t("stream.total_media_files"))),s.a.createElement(E.a,{md:2,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.elements))),s.a.createElement(S.a,{className:"hidden-xs"},e,s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.data_source"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.artist"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.album"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.title"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.cover")))),this.state.list,this.state.listLoaded?"":s.a.createElement(L.a,{name:"spinner",spin:!0}))}}]),t}(n.Component),We=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={stream:e.stream,playExternalAnchor:a.buildStreamExternal(e.stream),modalConfirmShow:!1,modalRenameShow:!1,modalSaveShow:!1,modalTitle:"",modalMessage:"",modalValue:"",historyExpanded:!0,historyList:[],historyOffset:0,historyLoaded:!1,mediaListExpanded:!1,mediaList:[],mediaListOffset:0,mediaListLoaded:!1},a.deleteStream=a.deleteStream.bind(Object(g.a)(Object(g.a)(a))),a.renameStream=a.renameStream.bind(Object(g.a)(Object(g.a)(a))),a.saveStream=a.saveStream.bind(Object(g.a)(Object(g.a)(a))),a.reloadStream=a.reloadStream.bind(Object(g.a)(Object(g.a)(a))),a.refreshStream=a.refreshStream.bind(Object(g.a)(Object(g.a)(a))),a.resetStream=a.resetStream.bind(Object(g.a)(Object(g.a)(a))),a.confirmDelete=a.confirmDelete.bind(Object(g.a)(Object(g.a)(a))),a.confirmRename=a.confirmRename.bind(Object(g.a)(Object(g.a)(a))),a.confirmSave=a.confirmSave.bind(Object(g.a)(Object(g.a)(a))),a.playStreamExternal=a.playStreamExternal.bind(Object(g.a)(Object(g.a)(a))),a.playStream=a.playStream.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectHistory=a.handleSelectHistory.bind(Object(g.a)(Object(g.a)(a))),a.getHistory=a.getHistory.bind(Object(g.a)(Object(g.a)(a))),a.handleHistoryPrevious=a.handleHistoryPrevious.bind(Object(g.a)(Object(g.a)(a))),a.handleHistoryNext=a.handleHistoryNext.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectMediaList=a.handleSelectMediaList.bind(Object(g.a)(Object(g.a)(a))),a.handleHistoryRefresh=a.handleHistoryRefresh.bind(Object(g.a)(Object(g.a)(a))),a.getHistory(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({stream:e.stream,playExternalAnchor:this.buildStreamExternal(e.stream),modalConfirmShow:!1,modalRenameShow:!1,modalSaveShow:!1,modalTitle:"",modalMessage:"",modalValue:"",historyExpanded:!0,historyList:[],historyOffset:0,historyLoaded:!1,mediaListExpanded:!1,mediaList:[],mediaListOffset:0,mediaListLoaded:!1},function(){t.getHistory()})}},{key:"deleteStream",value:function(){this.setState({modalConfirmShow:!0,modalTitle:$.t("stream.remove_title"),modalMessage:$.t("stream.remove_message",{stream:this.state.stream.display_name||$.t("common.no_name")})})}},{key:"renameStream",value:function(){this.setState({modalRenameShow:!0,modalTitle:$.t("stream.rename_title"),modalMessage:$.t("stream.rename_message",{stream:this.state.stream.display_name||$.t("common.no_name")}),modalValue:this.state.stream.display_name})}},{key:"saveStream",value:function(){this.setState({modalSaveShow:!0,modalTitle:$.t("stream.save_as_playlist_title"),modalMessage:$.t("stream.save_as_playlist_message",{stream:this.state.stream.display_name||$.t("common.no_name")}),modalValue:this.state.stream.display_name})}},{key:"reloadStream",value:function(){G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"reload"}).then(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reload_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reload_error"),level:"error"})})}},{key:"refreshStream",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"info"}).then(function(t){G.dispatch({type:"setStream",stream:t}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_refresh_ok"),level:"info"}),e.setState({stream:t})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_refresh_error"),level:"error"})})}},{key:"resetStream",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"reset_url"}).then(function(t){var a=G.getState().streamList;for(var n in a)if(a[n].name===e.state.stream.name){a[n].name=t.name,e.setState({stream:a[n]});break}G.dispatch({type:"setStreamList",streamList:a}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reset_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_reset_error"),level:"error"})})}},{key:"confirmDelete",value:function(e){var t=this;e&&G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"stop"}).then(function(){var e=G.getState().streamList;for(var a in e)if(e[a].name===t.state.stream.name){e.splice(a,1);break}G.dispatch({type:"setStreamList",streamList:e}),G.getState().profile.stream.name===t.state.stream.name&&G.dispatch({type:"loadStream",stream:!1}),t.setState({modalConfirmShow:!1}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_delete_ok"),level:"info"}),G.dispatch({type:"setCurrentBrowse",browse:"manageStream"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_delete_error"),level:"error"}),t.setState({modalConfirmShow:!1})})}},{key:"confirmRename",value:function(e){var t=this;e&&G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"rename",parameters:{name:e}}).then(function(){var a=G.getState().streamList;for(var n in a)if(a[n].name===t.state.stream.name){a[n].display_name=e,t.setState({stream:a[n],modalRenameShow:!1});break}G.dispatch({type:"setStreamList",streamList:a}),G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_rename_ok"),level:"info"})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_rename_error"),level:"error"}),t.setState({modalRenameShow:!1})})}},{key:"confirmSave",value:function(e){var t=this;e&&G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"save",parameters:{name:e}}).then(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_save_ok"),level:"info"}),t.setState({modalSaveShow:!1})}).fail(function(){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_save_error"),level:"error"}),t.setState({modalSaveShow:!1})})}},{key:"playStreamExternal",value:function(){V()("#play-external-anchor")[0].click()}},{key:"buildStreamExternal",value:function(e){return e?e.webradio?"data:application/mpegurl;base64,"+btoa("#EXTM3U\n\n#EXTINF:0,"+(e.display_name||$.t("common.no_name"))+"\n"+G.getState().taliesinApiUrl+"/stream/"+e.name+"\n"):G.getState().taliesinApiUrl+"/stream/"+e.name:""}},{key:"playStream",value:function(){G.dispatch({type:"loadStreamAndPlay",stream:this.state.stream})}},{key:"getHistory",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"history",parameters:{offset:this.state.historyOffset?this.state.historyOffset:void 0,limit:10}}).then(function(t){var a=[];t.forEach(function(e,t){a.push(s.a.createElement(Fe,{media:e.media,date:e.datestamp,key:t}))}),e.setState({historyList:a,historyLoaded:!0})}).fail(function(t){G.getState().NotificationManager.addNotification({message:$.t("stream.message_stream_history_error"),level:"error"}),e.setState({historyList:[],historyLoaded:!0})})}},{key:"handleSelectHistory",value:function(){var e=this;this.setState({historyExpanded:!this.state.historyExpanded,historyList:[],historyLoaded:!1},function(){e.state.historyExpanded&&e.getHistory()})}},{key:"handleHistoryPrevious",value:function(){var e=this;this.setState({historyOffset:this.state.historyOffset-10,historyList:[],historyLoaded:!1},function(){e.getHistory()})}},{key:"handleHistoryNext",value:function(){var e=this;this.setState({historyOffset:this.state.historyOffset+10,historyList:[],historyLoaded:!1},function(){e.getHistory()})}},{key:"handleHistoryRefresh",value:function(){var e=this;this.setState({historyList:[],historyLoaded:!1},function(){e.getHistory()})}},{key:"handleSelectMediaList",value:function(){this.setState({mediaListExpanded:!this.state.mediaListExpanded})}},{key:"render",value:function(){var e,t,a,n,i=[];return this.state.stream.webradio&&(e=this.state.stream.random?s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.random"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,$.t("common.yes")))):s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.random"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,$.t("common.no"))))),this.state.stream.stored_playlist&&(t=s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("stream.playlist_attached"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.stored_playlist)))),this.state.stream.clients.forEach(function(e,t){i.push(s.a.createElement("div",{key:t},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement("hr",null))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:3,sm:6,xs:6},s.a.createElement(te.a,null,$.t("stream.ip_address"))),s.a.createElement(E.a,{md:3,sm:6,xs:6},s.a.createElement("span",null,e.ip_address)),s.a.createElement(E.a,{md:3,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.user_agent"))),s.a.createElement(E.a,{md:3,sm:6,xs:6},s.a.createElement("span",null,e.user_agent)))))}),i.length||i.push(s.a.createElement(S.a,{key:0},s.a.createElement(E.a,{md:3,sm:3,xs:3},s.a.createElement(te.a,null,$.t("common.none"))))),this.state.stream.webradio&&(a=s.a.createElement(C.a,{collapsible:!0,header:$.t("stream.history"),eventKey:"3",onSelect:this.handleSelectHistory,defaultExpanded:!0},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:12},s.a.createElement(Z.a,null,s.a.createElement(_.a,{onClick:this.handleHistoryPrevious,disabled:!this.state.historyOffset},$.t("common.previous_page")),s.a.createElement(_.a,{onClick:this.handleHistoryNext},$.t("common.next_page")),s.a.createElement(_.a,{onClick:this.handleHistoryRefresh},$.t("common.refresh"))))),s.a.createElement(S.a,{className:"hidden-xs"},s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.date"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.data_source"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.artist"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.album"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.title"))),s.a.createElement(E.a,{md:2},s.a.createElement(te.a,null,$.t("common.cover")))),this.state.historyList,this.state.historyLoaded?"":s.a.createElement(L.a,{name:"spinner",spin:!0}))),this.state.mediaListExpanded&&(n=s.a.createElement(Ge,{stream:this.state.stream})),s.a.createElement("div",null,s.a.createElement(S.a,{style:{marginBottom:"10px"}},s.a.createElement(E.a,{md:12},s.a.createElement("a",{href:this.state.playExternalAnchor,style:{display:"none"},id:"play-external-anchor",download:(this.state.stream.display_name||$.t("common.no_name"))+".m3u"},"External"),s.a.createElement(Z.a,{className:"hidden-xs"},s.a.createElement(_.a,{title:$.t("common.play"),onClick:this.playStream},s.a.createElement(L.a,{name:"play"})),s.a.createElement(_.a,{title:$.t("common.external"),onClick:this.playStreamExternal},s.a.createElement(L.a,{name:"external-link"})),s.a.createElement(_.a,{title:$.t("common.rename"),onClick:this.renameStream},s.a.createElement(L.a,{name:"pencil"})),s.a.createElement(_.a,{title:$.t("stream.save_as_playlist"),onClick:this.saveStream},s.a.createElement(L.a,{name:"floppy-o"})),s.a.createElement(_.a,{title:$.t("stream.reload"),onClick:this.reloadStream},s.a.createElement(L.a,{name:"exchange"})),s.a.createElement(_.a,{title:$.t("stream.reset_url"),onClick:this.resetStream},s.a.createElement(L.a,{name:"unlock-alt"})),s.a.createElement(_.a,{title:$.t("stream.delete"),onClick:this.deleteStream},s.a.createElement(L.a,{name:"trash"})),s.a.createElement(_.a,{title:$.t("stream.reload"),onClick:this.refreshStream},s.a.createElement(L.a,{name:"refresh"}))),s.a.createElement(ee.a,{className:"visible-xs",id:"xs-manage"-this.state.stream.name,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-cog"}))},s.a.createElement(y.a,{onClick:this.playStream},s.a.createElement(L.a,{name:"play"}),"\xa0",$.t("common.play")),s.a.createElement(y.a,{onClick:this.playStreamExternal},s.a.createElement(L.a,{name:"external-link"}),"\xa0",$.t("common.external")),s.a.createElement(y.a,{onClick:this.renameStream},s.a.createElement(L.a,{name:"pencil"}),"\xa0",$.t("common.rename")),s.a.createElement(y.a,{onClick:this.saveStream},s.a.createElement(L.a,{name:"floppy-o"}),"\xa0",$.t("stream.save_as_playlist")),s.a.createElement(y.a,{onClick:this.reloadStream},s.a.createElement(L.a,{name:"exchange"}),"\xa0",$.t("stream.reload")),s.a.createElement(y.a,{onClick:this.resetStream},s.a.createElement(L.a,{name:"unlock-alt"}),"\xa0",$.t("stream.reset_url")),s.a.createElement(y.a,{onClick:this.deleteStream},s.a.createElement(L.a,{name:"trash"}),"\xa0",$.t("stream.delete"))))),s.a.createElement(le.a,null,a,s.a.createElement(C.a,{collapsible:!0,header:$.t("stream.media_list"),eventKey:"2",onSelect:this.handleSelectMediaList},n),s.a.createElement(C.a,{collapsible:!0,header:$.t("stream.info"),eventKey:"1"},s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.name"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.display_name))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("stream.stream_name"))),s.a.createElement(E.a,{md:6,sm:6,xs:6,className:"large-label"},s.a.createElement("span",null,this.state.stream.name))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.url"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:G.getState().taliesinApiUrl+"/stream/"+this.state.stream.name},"direct link"))),t,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.type"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.webradio?$.t("common.webradio"):$.t("common.jukebox")))),e,s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.format"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.format))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.channels"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.stereo?$.t("common.stereo"):$.t("common.mono")))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.sample_rate"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.sample_rate," kHz"))),s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement(te.a,null,$.t("common.bitrate"))),s.a.createElement(E.a,{md:6,sm:6,xs:6},s.a.createElement("span",null,this.state.stream.bitrate/1e3," bps")))),s.a.createElement(C.a,{collapsible:!0,header:$.t("stream.clients"),eventKey:"4"},i),s.a.createElement(oe,{show:this.state.modalConfirmShow,title:this.state.modalTitle,message:this.state.modalMessage,onCloseCb:this.confirmDelete}),s.a.createElement(ye,{show:this.state.modalRenameShow,title:this.state.modalTitle,message:this.state.modalMessage,onCloseCb:this.confirmRename,value:this.state.modalValue}),s.a.createElement(ye,{show:this.state.modalSaveShow,title:this.state.modalTitle,message:this.state.modalMessage,onCloseCb:this.confirmSave,value:this.state.modalValue})))}}]),t}(n.Component),Ke=a(590),He=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={subPath:e.subPath,path:e.path},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({subPath:e.subPath,path:e.path})}},{key:"trimSlashes",value:function(e){return e.replace(new RegExp("^[/]+|[/]+$","g"),"")}},{key:"handleGotoPath",value:function(e){G.dispatch({type:"setCurrentPath",path:this.trimSlashes(e)})}},{key:"render",value:function(){var e=this;return s.a.createElement(Ke.a.Item,{onClick:function(){return e.handleGotoPath(e.state.path)}},this.state.subPath)}}]),t}(n.Component),Je=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,path:e.path},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,path:e.path})}},{key:"handleGotoRoot",value:function(){G.dispatch({type:"setCurrentPath",path:""})}},{key:"render",value:function(){var e=this,t=[],a="";return this.state.path.split("/").forEach(function(e){a+=e+"/",e&&t.push(s.a.createElement(He,{path:a,subPath:e,key:a}))}),s.a.createElement(Ke.a,null,s.a.createElement(Ke.a.Item,{onClick:function(){return e.handleGotoRoot()}},this.state.dataSource),t)}}]),t}(n.Component),ze=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,path:e.path||"/",imgThumbBlob:!1},a.loadCover=a.loadCover.bind(Object(g.a)(Object(g.a)(a))),a.loadCover(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({dataSource:e.dataSource,path:e.path||"/",imgThumbBlob:!1},function(){t.loadCover()})}},{key:"loadCover",value:function(){var e=this;G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.dataSource)+"/browse/path/"+encodeURI(this.state.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(t){e.setState({imgThumbBlob:t})}).fail(function(){e.setState({imgThumbBlob:!1})})}},{key:"render",value:function(){var e=this.state.path;e.indexOf("/")>-1&&(e=e.substring(e.lastIndexOf("/")+1));var t={type:"folder",path:this.state.path,name:e};return this.state.imgThumbBlob?s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:8},s.a.createElement(Je,{dataSource:this.state.dataSource,path:this.state.path})),s.a.createElement(E.a,{md:3,sm:3,xs:3,className:"text-right"},s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.imgThumbBlob,thumbnail:!0,responsive:!0})),s.a.createElement(E.a,{md:3,sm:3,xs:1,className:"text-right"},s.a.createElement("div",{className:"text-right"},s.a.createElement(Ee,{dataSource:this.state.dataSource,path:this.state.path,element:t})))):s.a.createElement(S.a,null,s.a.createElement(E.a,{md:9,sm:9,xs:6},s.a.createElement(Je,{dataSource:this.state.dataSource,path:this.state.path})),s.a.createElement(E.a,{md:3,sm:3,xs:6,className:"text-right"},s.a.createElement("div",{className:"text-right"},s.a.createElement(Ee,{dataSource:this.state.dataSource,path:this.state.path,element:t}))))}}]),t}(n.Component),$e=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue},a.handleGotoCategory=a.handleGotoCategory.bind(Object(g.a)(Object(g.a)(a))),a.handleGotoCategoryValue=a.handleGotoCategoryValue.bind(Object(g.a)(Object(g.a)(a))),a.handleGotoSubcategory=a.handleGotoSubcategory.bind(Object(g.a)(Object(g.a)(a))),a.handleGotoSubcategoryValue=a.handleGotoSubcategoryValue.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue})}},{key:"handleGotoCategory",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentCategory",category:this.state.category})}},{key:"handleGotoCategoryValue",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:this.state.categoryValue})}},{key:"handleGotoSubcategory",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory})}},{key:"handleGotoSubcategoryValue",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentCategory",category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue})}},{key:"render",value:function(){var e=[s.a.createElement(Ke.a.Item,{key:0,onClick:this.handleGotoCategory},this.state.category)];return this.state.categoryValue&&(e.push(s.a.createElement(Ke.a.Item,{key:1,onClick:this.handleGotoCategoryValue},this.state.categoryValue)),this.state.subCategory&&(e.push(s.a.createElement(Ke.a.Item,{key:2,onClick:this.handleGotoSubcategory},this.state.subCategory)),this.state.subCategoryValue&&e.push(s.a.createElement(Ke.a.Item,{key:3,onClick:this.handleGotoSubcategoryValue},this.state.subCategoryValue)))),s.a.createElement(Ke.a,null,s.a.createElement(Ke.a.Item,null,this.state.dataSource),e)}}]),t}(n.Component),Qe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,imgThumbBlob:!1,editCategoryShow:!1},a.onOpenCategory=a.onOpenCategory.bind(Object(g.a)(Object(g.a)(a))),a.onCloseCategory=a.onCloseCategory.bind(Object(g.a)(Object(g.a)(a))),a.onEditCategory=a.onEditCategory.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({dataSource:e.dataSource,category:e.category,categoryValue:e.categoryValue,subCategory:e.subCategory,subCategoryValue:e.subCategoryValue,imgThumbBlob:!1,editCategoryShow:!1})}},{key:"onOpenCategory",value:function(){this.setState({editCategoryShow:!0})}},{key:"onCloseCategory",value:function(){this.setState({editCategoryShow:!1,imgThumbBlob:!1})}},{key:"onEditCategory",value:function(){this.setState({imgThumbBlob:!1})}},{key:"render",value:function(){var e={type:this.state.subCategory||this.state.category,name:this.state.subCategoryValue||this.state.categoryValue};return this.state.imgThumbBlob?s.a.createElement(S.a,null,s.a.createElement(E.a,{md:6,sm:6,xs:8},s.a.createElement($e,{dataSource:this.state.dataSource,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue})),s.a.createElement(E.a,{md:3,sm:3,xs:3,className:"text-right"},s.a.createElement("a",{role:"button",onClick:this.onOpenCategory,title:$.t("browse.view_category_content")},s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.imgThumbBlob,thumbnail:!0,responsive:!0}))),s.a.createElement(E.a,{md:3,sm:3,xs:1,className:"text-right"},s.a.createElement("div",{className:"text-right"},s.a.createElement(Ee,{dataSource:this.state.dataSource,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue,element:e}))),s.a.createElement(Se,{show:this.state.editCategoryShow,onCloseCb:this.onCloseCategory,dataSource:this.state.dataSource,category:this.state.subCategory||this.state.category,categoryValue:this.state.subCategoryValue||this.state.categoryValue})):s.a.createElement(S.a,null,s.a.createElement(E.a,{md:9,sm:9,xs:6},s.a.createElement($e,{dataSource:this.state.dataSource,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue})),s.a.createElement(E.a,{md:3,sm:3,xs:6,className:"text-right"},s.a.createElement("div",{className:"text-right"},s.a.createElement(Ee,{dataSource:this.state.dataSource,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue,element:e,onEditCategory:this.onEditCategory}))))}}]),t}(n.Component),Ye=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={dataSource:G.getState().profile.dataSource,browse:G.getState().profile.browse,path:G.getState().profile.path,view:G.getState().profile.view,category:!1,categoryValue:!1,subCategory:!1,subCategoryValue:!1,imgThumbBlob:!1,showMainScreen:!0},G.subscribe(function(){var e=G.getState();"setCurrentDataSource"===e.lastAction||"setDataSourceList"===e.lastAction?a.setState({dataSource:e.profile.dataSource,path:e.profile.path}):"setCurrentPath"===e.lastAction?a.setState({path:e.profile.path}):"setCurrentBrowse"===e.lastAction?a.setState({browse:e.profile.browse}):"setCurrentCategory"===e.lastAction?a.setState({category:e.profile.category,categoryValue:e.profile.categoryValue,subCategory:e.profile.subCategory,subCategoryValue:e.profile.subCategoryValue}):"setCurrentView"===e.lastAction?a.setState({view:e.profile.view}):"showFullScreen"===e.lastAction?a.setState({showMainScreen:!e.showFullScreen}):"setStoredValues"===e.lastAction&&a.setState({view:e.profile.view})}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.showMainScreen?"path"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.files")),s.a.createElement(ze,{dataSource:this.state.dataSource.name,path:this.state.path}),s.a.createElement(xe,{dataSource:this.state.dataSource.name,path:this.state.path,view:this.state.view})):"playlist"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.playlists")),s.a.createElement(pe,{view:this.state.view,playlist:G.getState().profile.playlist})):"recent"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.recent")),s.a.createElement(je,{view:this.state.view})):"category"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.category")),s.a.createElement(Qe,{dataSource:this.state.dataSource.name,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue}),s.a.createElement(Me,{dataSource:this.state.dataSource.name,category:this.state.category,categoryValue:this.state.categoryValue,subCategory:this.state.subCategory,subCategoryValue:this.state.subCategoryValue,view:this.state.view})):"managePlayer"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.external")),s.a.createElement(Ve,null)):"manageStream"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.streams")),s.a.createElement(fe,null)):"manageDataSource"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.data_source")),s.a.createElement(De,null)):"manageConfig"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.config")),s.a.createElement(qe,null)):"streamDetails"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.stream")),s.a.createElement(We,{stream:G.getState().profile.streamDetails})):"showStreamMediaList"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.stream_media_list")),s.a.createElement(Ge,{stream:G.getState().profile.stream})):"advancedSearch"===this.state.browse?s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement("h2",null,$.t("mainScreen.advanced_search")),s.a.createElement(Te,null)):s.a.createElement(ie.a,{className:"main-screen"},s.a.createElement(ke,null)):s.a.createElement("div",null)}}]),t}(n.Component),Xe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={stream:G.getState().profile.stream,media:G.getState().profile.mediaNow,jukeboxIndex:G.getState().profile.jukeboxIndex,currentPlayer:G.getState().profile.currentPlayer,show:G.getState().showFullScreen,title:"",imgBlob:!1,status:G.getState().profile.currentPlayerStatus,repeat:G.getState().profile.currentPlayerRepeat,random:G.getState().profile.currentPlayerRandom,volume:G.getState().profile.currentPlayerVolume},G.subscribe(function(){a._ismounted&&("loadStream"===G.getState().lastAction?a.setState({stream:G.getState().profile.stream},function(){a.loadMedia()}):"setJukeboxIndex"===G.getState().lastAction?a.setState({jukeboxIndex:G.getState().profile.jukeboxIndex},function(){a.loadMedia()}):"setMediaNow"===G.getState().lastAction?a.setState({media:G.getState().profile.mediaNow},function(){a.loadMedia()}):"setCurrentPlayerStatus"===G.getState().lastAction?a.setState({status:G.getState().profile.currentPlayerStatus,repeat:G.getState().profile.currentPlayerRepeat,random:G.getState().profile.currentPlayerRandom,volume:G.getState().profile.currentPlayerVolume}):"showFullScreen"===G.getState().lastAction?a.setState({stream:G.getState().profile.stream,media:G.getState().profile.mediaNow,jukeboxIndex:G.getState().profile.jukeboxIndex,show:G.getState().showFullScreen,title:"",imgBlob:!1,status:G.getState().profile.currentPlayerStatus,repeat:G.getState().profile.currentPlayerRepeat,random:G.getState().profile.currentPlayerRandom,volume:G.getState().profile.currentPlayerVolume},function(){a.loadMedia()}):"loadStream"===G.getState().lastAction||"loadStreamAndPlay"===G.getState().lastAction?a.setState({stream:G.getState().profile.stream},function(){a.loadMedia()}):"setCurrentPlayerStatus"===G.getState().lastAction&&a.setState({status:G.getState().profile.currentPlayerStatus,repeat:G.getState().profile.currentPlayerRepeat,random:G.getState().profile.currentPlayerRandom,volume:G.getState().profile.currentPlayerVolume}))}),a.loadMedia=a.loadMedia.bind(Object(g.a)(Object(g.a)(a))),a.buildTitle=a.buildTitle.bind(Object(g.a)(Object(g.a)(a))),a.handleClose=a.handleClose.bind(Object(g.a)(Object(g.a)(a))),a.getMediaCover=a.getMediaCover.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectArtist=a.handleSelectArtist.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectAlbum=a.handleSelectAlbum.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectYear=a.handleSelectYear.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectGenre=a.handleSelectGenre.bind(Object(g.a)(Object(g.a)(a))),a.handlePlayerAction=a.handlePlayerAction.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeVolume=a.handleChangeVolume.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectFolder=a.handleSelectFolder.bind(Object(g.a)(Object(g.a)(a))),a.getMediaFolder=a.getMediaFolder.bind(Object(g.a)(Object(g.a)(a))),a.loadMedia(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({stream:G.getState().profile.stream,media:G.getState().profile.mediaNow,jukeboxIndex:G.getState().profile.jukeboxIndex,show:G.getState().showFullScreen,title:"",imgBlob:!1,status:G.getState().profile.currentPlayerStatus,repeat:G.getState().profile.currentPlayerRepeat,random:G.getState().profile.currentPlayerRandom,volume:G.getState().profile.currentPlayerVolume},function(){t.loadMedia()})}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"loadMedia",value:function(){this._ismounted&&(this.setState({title:this.buildTitle()}),this.getMediaCover(),this.getMediaFolder())}},{key:"buildTitle",value:function(){var e="";return this.state.media&&(this.state.jukeboxIndex>-1&&!this.state.stream.webradio&&(e+=(this.state.jukeboxIndex+1<10?"0"+(this.state.jukeboxIndex+1):this.state.jukeboxIndex+1)+"/"+(this.state.stream.elements<10?"0"+this.state.stream.elements:this.state.stream.elements)+" - "),this.state.media.tags&&this.state.media.tags.title?e+=this.state.media.tags.title:e+=this.state.media.name.replace(/\.[^\/.]+$/,"")),e}},{key:"handleClose",value:function(){G.dispatch({type:"showFullScreen",show:!1})}},{key:"handleSelectArtist",value:function(e){var t=this;G.dispatch({type:"showFullScreen",show:!1}),G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"artist",categoryValue:e})}},{key:"getMediaFolder",value:function(){var e=this.state.media;e&&(e.path?(e.path.lastIndexOf("/")>-1?e.folder=e.path.substring(0,e.path.lastIndexOf("/")):e.folder="",this.setState({media:e})):(e.folder="",this.setState({media:e})))}},{key:"handleSelectAlbum",value:function(e){var t=this;G.dispatch({type:"showFullScreen",show:!1}),G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"album",categoryValue:e})}},{key:"handleSelectYear",value:function(e){var t=this;G.dispatch({type:"showFullScreen",show:!1}),G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"year",categoryValue:e})}},{key:"handleSelectGenre",value:function(e){var t=this;G.dispatch({type:"showFullScreen",show:!1}),G.dispatch({type:"setCurrentBrowse",browse:"category"}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentCategory",category:"genre",categoryValue:e})}},{key:"handlePlayerAction",value:function(e){G.dispatch({type:"setPlayerAction",action:e})}},{key:"handleChangeVolume",value:function(e){this._ismounted&&this.setState({volume:this.state.volume+e},function(){G.dispatch({type:"setPlayerAction",action:"volume",parameter:e})})}},{key:"handleSelectFolder",value:function(e){var t=this;G.dispatch({type:"showFullScreen",show:!1}),G.dispatch({type:"setCurrentDataSource",currentDataSource:G.getState().dataSourceList.find(function(e){return e.name===t.state.media.data_source})}),G.dispatch({type:"setCurrentBrowse",browse:"path"}),G.dispatch({type:"setCurrentPath",path:e})}},{key:"getMediaCover",value:function(){var e=this;this.state.media&&this.state.show&&this._ismounted&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.media.data_source)+"/browse/path/"+encodeURI(this.state.media.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&base64").then(function(t){e.setState({imgBlob:t})}).fail(function(){e.setState({imgBlob:!1})})}},{key:"render",value:function(){var e,t,a,n=this,i=[];if(e=this.state.imgBlob?s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.imgBlob,className:"cover-image-full center-block",responsive:!0}):s.a.createElement(b.a,{src:"images/generic-album.png",className:"cover-image-full center-block",responsive:!0}),"stop"===this.state.status?(t=s.a.createElement(_.a,{title:$.t("common.play"),onClick:function(){n.handlePlayerAction("play")}},s.a.createElement(L.a,{name:"play"})),a=s.a.createElement(_.a,{bsSize:"large",title:$.t("common.play"),onClick:function(){n.handlePlayerAction("play")}},s.a.createElement(L.a,{name:"play"}))):"pause"===this.state.status?(t=s.a.createElement(_.a,{title:$.t("common.play"),onClick:function(){n.handlePlayerAction("pause")}},s.a.createElement(L.a,{name:"play"})),a=s.a.createElement(_.a,{bsSize:"large",title:$.t("common.play"),onClick:function(){n.handlePlayerAction("pause")}},s.a.createElement(L.a,{name:"play"}))):this.state.stream.webradio?(t=s.a.createElement(_.a,{title:$.t("common.play"),disabled:!0},s.a.createElement(L.a,{name:"play"})),a=s.a.createElement(_.a,{bsSize:"large",title:$.t("common.play"),disabled:!0},s.a.createElement(L.a,{name:"play"}))):(t=s.a.createElement(_.a,{title:$.t("common.pause"),onClick:function(){n.handlePlayerAction("pause")}},s.a.createElement(L.a,{name:"pause"})),a=s.a.createElement(_.a,{bsSize:"large",title:$.t("common.pause"),onClick:function(){n.handlePlayerAction("pause")}},s.a.createElement(L.a,{name:"pause"}))),this.state.media){this.state.media.tags.title&&i.push(s.a.createElement(S.a,{key:0},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.title"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",{className:"text-fullscreen"},this.state.media.tags.title))));var l=Math.floor(this.state.media.duration/6e4);l<10&&(l="0"+l);var r=Math.floor(this.state.media.duration/1e3)%60;r<10&&(r="0"+r),i.push(s.a.createElement(S.a,{key:1},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.duration"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",{className:"text-fullscreen"},l,":",r)))),this.state.media.tags.artist&&i.push(s.a.createElement(S.a,{key:2},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.artist"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",className:"anchor-fullscreen",onClick:function(){n.handleSelectArtist(n.state.media.tags.artist)}},this.state.media.tags.artist))))),this.state.media.tags.album&&i.push(s.a.createElement(S.a,{key:3},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.album"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",className:"anchor-fullscreen",onClick:function(){n.handleSelectAlbum(n.state.media.tags.album)}},this.state.media.tags.album))))),this.state.media.tags.date&&i.push(s.a.createElement(S.a,{key:4},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.date"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",className:"anchor-fullscreen",onClick:function(){n.handleSelectYear(n.state.media.tags.date)}},this.state.media.tags.date))))),this.state.media.tags.genre&&i.push(s.a.createElement(S.a,{key:5},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.genre"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",className:"anchor-fullscreen",onClick:function(){n.handleSelectGenre(n.state.media.tags.genre)}},this.state.media.tags.genre))))),i.push(s.a.createElement(S.a,{key:6},s.a.createElement(E.a,{xs:6,className:"text-right"},s.a.createElement("label",{className:"text-fullscreen"},$.t("common.open_folder"))),s.a.createElement(E.a,{xs:6},s.a.createElement("span",null,s.a.createElement("a",{role:"button",className:"anchor-fullscreen",onClick:function(){n.handleSelectFolder(n.state.media.folder)}},this.state.media.folder||"/")))))}return s.a.createElement("div",{className:"fullscreen"+(this.state.show?"":" hidden")},s.a.createElement("div",{className:"media-background-fullscreen",style:{backgroundImage:this.state.imgBlob?"url(data:image/png;base64,"+this.state.imgBlob+")":""}}),s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,className:"text-center"},s.a.createElement("div",{className:"text-fullscreen"},this.state.title))),s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,className:"text-center hidden-sm hidden-xs"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("common.previous"),onClick:function(){n.handlePlayerAction("previous")}},s.a.createElement(L.a,{name:"fast-backward"})),s.a.createElement(_.a,{title:$.t("common.stop"),onClick:function(){n.handlePlayerAction("stop")}},s.a.createElement(L.a,{name:"stop"})),t,s.a.createElement(_.a,{title:$.t("common.next"),onClick:function(){n.handlePlayerAction("next")}},s.a.createElement(L.a,{name:"fast-forward"})),s.a.createElement(_.a,{title:$.t("common.repeat"),onClick:function(){n.handlePlayerAction("repeat")},className:this.state.repeat&&!this.state.stream.webradio?"btn-primary":"",disabled:this.state.stream.webradio},s.a.createElement(L.a,{name:"repeat"})),s.a.createElement(_.a,{title:$.t("common.random"),onClick:function(){n.handlePlayerAction("random")},className:this.state.random&&!this.state.stream.webradio?"btn-primary":"",disabled:this.state.stream.webradio},s.a.createElement(L.a,{name:"random"})),s.a.createElement(ee.a,{title:s.a.createElement(L.a,{name:"volume-up"}),pullRight:!0,id:"dropdown-volume"},s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(5)}},$.t("common.volume_plus_5")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(1)}},$.t("common.volume_plus_1")),s.a.createElement(y.a,{className:"text-center"},$.t("common.volume_current")," ",this.state.volume," %"),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(-1)}},$.t("common.volume_minus_1")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(-5)}},$.t("common.volume_minus_5"))))),s.a.createElement(E.a,{md:12,className:"text-center visible-sm visible-xs"},s.a.createElement(Z.a,null,s.a.createElement(_.a,{bsSize:"large",title:$.t("common.previous"),onClick:function(){n.handlePlayerAction("previous")}},s.a.createElement(L.a,{name:"fast-backward"})),s.a.createElement(_.a,{bsSize:"large",title:$.t("common.stop"),onClick:function(){n.handlePlayerAction("stop")}},s.a.createElement(L.a,{name:"stop"})),a,s.a.createElement(_.a,{bsSize:"large",title:$.t("common.next"),onClick:function(){n.handlePlayerAction("next")}},s.a.createElement(L.a,{name:"fast-forward"})),s.a.createElement(ee.a,{bsSize:"large",title:s.a.createElement(L.a,{name:"volume-up"}),pullRight:!0,id:"dropdown-volume"},s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(5)}},$.t("common.volume_plus_5")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(1)}},$.t("common.volume_plus_1")),s.a.createElement(y.a,{className:"text-center"},$.t("common.volume_current")," ",this.state.volume," %"),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(-1)}},$.t("common.volume_minus_1")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){n.handleChangeVolume(-5)}},$.t("common.volume_minus_5")))))),s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12},e)),void 0,i,s.a.createElement(S.a,{style:{marginTop:"10px"}},s.a.createElement(E.a,{md:12,className:"text-center"},s.a.createElement(_.a,{onClick:this.handleClose,className:"btn btn-success"},$.t("common.close")))))}}]),t}(n.Component),Ze=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={streamList:e.streamList,selectedStream:e.stream},a.handleSelectStream=a.handleSelectStream.bind(Object(g.a)(Object(g.a)(a))),a.handleManageStreams=a.handleManageStreams.bind(Object(g.a)(Object(g.a)(a))),a.handleLoadStream=a.handleLoadStream.bind(Object(g.a)(Object(g.a)(a))),a.handleDetailsStream=a.handleDetailsStream.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({streamList:e.streamList,selectedStream:e.stream})}},{key:"handleDetailsStream",value:function(){G.dispatch({type:"setStreamDetails",stream:this.state.selectedStream}),G.dispatch({type:"loadStream",stream:this.state.selectedStream}),G.dispatch({type:"setCurrentBrowse",browse:"streamDetails"})}},{key:"handleLoadStream",value:function(){G.dispatch({type:"loadStreamAndPlay",stream:this.state.selectedStream,index:0})}},{key:"handleManageStreams",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"manageStream"})}},{key:"handleSelectStream",value:function(e){var t=this.state.streamList.find(function(t){return t.name===e});t&&this.setState({selectedStream:t},function(){q.setLocalConfigValue("stream",t)})}},{key:"render",value:function(){var e=this,t=[];this.state.streamList.forEach(function(a,n){t.push(s.a.createElement(y.a,{key:n,eventKey:n,onClick:function(){return e.handleSelectStream(a.name)},"data-name":a.name,className:a.name===e.state.selectedStream.name?"bg-success":""},a.display_name||$.t("common.no_name")))});var a=$.t("player.select_stream");return this.state.selectedStream.name&&(a=this.state.selectedStream.display_name.startsWith("{")&&-1!==this.state.selectedStream.display_name.indexOf("} - ")?this.state.selectedStream.display_name.substring(this.state.selectedStream.display_name.indexOf("}")+3):this.state.selectedStream.display_name||$.t("common.no_name")).length>10&&(a=a.substring(0,10)+"..."),s.a.createElement("div",null,s.a.createElement(Z.a,{className:"hidden-xs"},s.a.createElement(ee.a,{title:a,id:"streamList"},t,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:this.handleManageStreams},$.t("common.manage_streams"))),s.a.createElement(_.a,{title:$.t("common.play_now"),onClick:this.handleLoadStream},s.a.createElement(L.a,{name:"play"})),s.a.createElement(_.a,{title:$.t("common.details"),onClick:this.handleDetailsStream},s.a.createElement(L.a,{name:"eye"}))),s.a.createElement(Z.a,{className:"visible-xs"},s.a.createElement(ee.a,{noCaret:!0,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-list"})),id:"streamListSmall"},t,s.a.createElement(y.a,{divider:!0}),s.a.createElement(y.a,{onClick:this.handleManageStreams},$.t("common.manage_streams"))),s.a.createElement(ee.a,{noCaret:!0,title:s.a.createElement("span",null,s.a.createElement("i",{className:"fa fa-music"})),id:"streamPlayer"},s.a.createElement(y.a,{onClick:this.handleLoadStream},s.a.createElement(L.a,{name:"play"})," ",$.t("common.play_now")),s.a.createElement(y.a,{onClick:this.handleDetailsStream},s.a.createElement(L.a,{name:"eye"})," ",$.t("common.details")))))}}]),t}(n.Component),et=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={player:e.player,loaded:!1,currentList:e.currentList,isAdmin:e.isAdmin},a.handleManagePlayers=a.handleManagePlayers.bind(Object(g.a)(Object(g.a)(a))),a.handleSelectPlayer=a.handleSelectPlayer.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({player:e.player,currentList:e.currentList,isAdmin:e.isAdmin})}},{key:"handleManagePlayers",value:function(){G.dispatch({type:"setCurrentBrowse",browse:"managePlayer"})}},{key:"handleSelectPlayer",value:function(e){G.dispatch({type:"setMediaNow",media:!1}),G.dispatch({type:"loadStream",stream:{name:!1,webradio:!1}}),G.dispatch({type:"setCurrentPlayer",currentPlayer:e})}},{key:"render",value:function(){var e,t,a,n=this,i=[s.a.createElement(y.a,{key:0,eventKey:0,onClick:function(){return n.handleSelectPlayer({type:"internal",name:$.t("player.internal")})},className:"internal"===this.state.player.type?"bg-success":""},$.t("player.internal")),s.a.createElement(y.a,{key:1,eventKey:1,onClick:function(){return n.handleSelectPlayer({type:"external",name:$.t("player.external")})},className:"external"===this.state.player.type?"bg-success":""},$.t("player.external"))];return this.state.currentList.forEach(function(e,t){e.enabled&&i.push(s.a.createElement(y.a,{key:t+2,eventKey:t+2,onClick:function(){return n.handleSelectPlayer({type:"carleon",name:e.name})},className:"carleon"===n.state.player.type&&e.name===n.state.player.name?"bg-success":""},e.name))}),(a=this.state.player.name?this.state.player.name:$.t("player."+this.state.player.type)).length>10&&(a=a.substring(0,10)+"..."),this.state.isAdmin&&G.getState().angharadApiUrl&&(e=s.a.createElement(y.a,{divider:!0}),t=s.a.createElement(y.a,{onClick:this.handleManagePlayers},$.t("player.manage"))),s.a.createElement("div",null,s.a.createElement(ee.a,{title:a,id:"playerList"},i,e,t))}}]),t}(n.Component),tt=a(244),at=a.n(tt),nt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).websocket=!1,a.state={play:!1,stream:e.stream,playNow:e.play,playIndex:e.index,streamUrl:"#",preload:"none",interval:!1,websocketUrl:"ws"+G.getState().taliesinApiUrl.substring(4)+"/stream/"+e.stream.name+"/ws",websocketProtocol:["taliesin"],websocketReconnect:!0,media:{data_source:!1,path:!1},now:!1,next:!1,taliesinApiUrl:G.getState().taliesinApiUrl,currentTime:0,duration:e.duration,volume:0,jukeboxIndex:0,jukeboxPlayedIndex:[],jukeboxNextIndex:0,jukeboxRepeat:!1,jukeboxRandom:!1},a.handlePrevious=a.handlePrevious.bind(Object(g.a)(Object(g.a)(a))),a.handleStop=a.handleStop.bind(Object(g.a)(Object(g.a)(a))),a.handlePause=a.handlePause.bind(Object(g.a)(Object(g.a)(a))),a.handlePlay=a.handlePlay.bind(Object(g.a)(Object(g.a)(a))),a.handleNext=a.handleNext.bind(Object(g.a)(Object(g.a)(a))),a.handleRepeat=a.handleRepeat.bind(Object(g.a)(Object(g.a)(a))),a.handleRandom=a.handleRandom.bind(Object(g.a)(Object(g.a)(a))),a.handleListen=a.handleListen.bind(Object(g.a)(Object(g.a)(a))),a.handleOnPlay=a.handleOnPlay.bind(Object(g.a)(Object(g.a)(a))),a.handleOnEnded=a.handleOnEnded.bind(Object(g.a)(Object(g.a)(a))),a.handleOnPause=a.handleOnPause.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeVolume=a.handleChangeVolume.bind(Object(g.a)(Object(g.a)(a))),a.loadMedia=a.loadMedia.bind(Object(g.a)(Object(g.a)(a))),a.dispatchPlayerStatus=a.dispatchPlayerStatus.bind(Object(g.a)(Object(g.a)(a))),a.sendStreamComand=a.sendStreamComand.bind(Object(g.a)(Object(g.a)(a))),a.handleCommandResponse=a.handleCommandResponse.bind(Object(g.a)(Object(g.a)(a))),a.websocketReconnect=a.websocketReconnect.bind(Object(g.a)(Object(g.a)(a))),a.initWebsocket=a.initWebsocket.bind(Object(g.a)(Object(g.a)(a))),a.initInterval=a.initInterval.bind(Object(g.a)(Object(g.a)(a))),G.subscribe(function(){var e=G.getState();if(a._ismounted)if("setPlayerAction"===e.lastAction)switch(e.profile.playerAction){case"previous":a.handlePrevious();break;case"stop":a.handleStop();break;case"play":a.handlePlay();break;case"pause":a.handlePause();break;case"next":a.handleNext();break;case"repeat":a.handleRepeat();break;case"random":a.handleRandom();break;case"volume":a.handleChangeVolume(e.profile.playerActionParameter)}else"newApiToken"===e.lastAction&&a.websocket&&a.websocket.readyState===a.websocket.OPEN&&a.websocket.send(JSON.stringify({command:"authorization",token:G.getState().token}))}),a.loadMedia(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,a="ws"+G.getState().taliesinApiUrl.substring(4)+"/stream/"+e.stream.name+"/ws",n=this.state.websocketUrl!==a;this.setState({stream:e.stream,websocketUrl:a,websocketReconnect:!0,playNow:e.play,playIndex:e.index,duration:e.duration},function(){t.loadMedia(),n&&t.websocketReconnect()})}},{key:"componentDidMount",value:function(){var e=this;this._ismounted=!0,this.state.stream.name&&G.getState().profile.useWebsocket?this.websocketReconnect():this.initInterval(),this.setState({volume:100*this.rap.audioEl.volume},function(){e.dispatchPlayerStatus({volume:e.state.volume})})}},{key:"componentWillUnmount",value:function(){this._ismounted=!1,this.state.interval&&clearInterval(this.state.interval),this.websocket&&(this.websocket.onclose=null,this.websocket.close())}},{key:"websocketReconnect",value:function(){var e=this;if(this.websocket&&(this.websocket.onclose=null,this.websocket.close()),this.state.stream.name)try{this.websocket=new WebSocket(this.state.websocketUrl,this.state.websocketProtocol),this.websocket.onopen=function(){e.websocket.send(JSON.stringify({command:"authorization",token:G.getState().token}))},this.websocket.onmessage=function(t){e.handleCommandResponse(JSON.parse(t.data))},this.initWebsocket(this.websocket)}catch(t){this.initInterval()}}},{key:"initWebsocket",value:function(){var e=this;setTimeout(function(){e.websocket.readyState===e.websocket.CLOSED?e.initInterval():e.websocket.readyState===e.websocket.CONNECTING?e.initWebsocket():e.websocket.readyState===e.websocket.OPEN&&(e.websocket.onclose=function(){e.state.websocketReconnect&&e.websocketReconnect()},e.state.interval&&(clearInterval(e.state.interval),e.setState({interval:!1})))},1e3)}},{key:"initInterval",value:function(){var e=this;this.websocket&&(this.websocket.onclose=null,this.websocket.close()),this.websocket=!1;var t=setInterval(function(){e.loadMedia()},1e4);this.loadMedia(),this.setState({interval:t})}},{key:"handleCommandResponse",value:function(e){var t=this;switch(e.command){case"authorization":"connected"!==e.result?(this.websocket.onclose=null,this.websocket.close()):this.state.stream.webradio?this.sendStreamComand("now"):this.sendStreamComand("list",{offset:this.state.jukeboxIndex,limit:1});break;case"now":"not_found"!==e.result&&"invalid_param"!==e.result&&e.result.data_source&&e.result.path&&(G.getState().profile.mediaNow.data_source!==e.result.data_source||G.getState().profile.mediaNow.path!==e.result.path)&&this.setState({media:e.result},function(){t.sendStreamComand("next"),G.dispatch({type:"setMediaNow",media:e.result})});break;case"next":"not_found"!==e.result&&"invalid_param"!==e.result&&G.dispatch({type:"setMediaNext",media:e.result});break;case"stop":break;case"replay":G.getState().NotificationManager.addNotification({message:$.t("player.replay"),level:"success"});break;case"skip":G.getState().NotificationManager.addNotification({message:$.t("player.next"),level:"success"});break;case"list":e.result&&e.result[0]&&e.result[0].data_source&&e.result[0].path&&(e.result[0].data_source!==G.getState().profile.mediaNow.data_source||e.result[0].path!==G.getState().profile.mediaNow.path)&&G.dispatch({type:"setMediaNow",media:e.result[0]})}}},{key:"sendStreamComand",value:function(e,t){var a=this;this.websocket&&this.websocket.readyState===this.websocket.OPEN?this.websocket.send(JSON.stringify({command:e,parameters:t})):G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:e,parameters:t}).then(function(t){a.handleCommandResponse({command:e,result:t})})}},{key:"dispatchPlayerStatus",value:function(e){G.dispatch({type:"setCurrentPlayerStatus",status:e.status,repeat:e.repeat,random:e.random,volume:e.volume})}},{key:"loadMedia",value:function(){var e=this;this.state.stream.name&&(this.state.playNow&&this.setState({playNow:!1,jukeboxIndex:this.state.playIndex},function(){e.handlePlay()}),this.websocket||(this.state.stream.webradio?this.sendStreamComand("now"):this.sendStreamComand("list",{offset:this.state.jukeboxIndex,limit:1})))}},{key:"handlePrevious",value:function(){var e=this;if(this.state.stream.webradio)this.sendStreamComand("replay");else if(this.currentTime<10)this.rap.audioEl.currentTime=0;else if(this.state.jukeboxPlayedIndex.length>1){var t=this.state.jukeboxPlayedIndex;t.pop();var a=t.pop();this.setState({jukeboxIndex:a,jukeboxPlayedIndex:t},function(){e.handlePlay(),e.loadMedia(),G.dispatch({type:"setJukeboxIndex",index:a})})}}},{key:"handleNext",value:function(){this.state.stream.webradio?this.sendStreamComand("skip"):this.nextSong()}},{key:"handleStop",value:function(){var e=this;this.rap&&this.rap.audioEl&&(this.rap.audioEl.pause(),this.rap.audioEl.currentTime=0,this.rap.audioEl.src=URL.createObjectURL(new Blob([],{type:"audio/mp3"})),this.setState({play:!1},function(){e.dispatchPlayerStatus({status:"stop"})}))}},{key:"handlePause",value:function(){this.state.stream.webradio?this.handleStop():this.rap.audioEl.paused?this.rap.audioEl.play():this.rap.audioEl.pause()}},{key:"handlePlay",value:function(){var e=this;this.setState({preload:this.state.stream.webradio?"none":"auto",currentTime:0},function(){if(e.state.stream.name&&e.state.taliesinApiUrl){e.handleStop();var t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),a=e.state.stream.webradio?"":"&index="+e.state.jukeboxIndex,n={streamUrl:e.state.taliesinApiUrl+"/stream/"+e.state.stream.name+"?rand="+t+a};if(e.state.stream.webradio){var s=e.state.jukeboxPlayedIndex;s.push(e.state.jukeboxIndex),n.jukeboxPlayedIndex=s}else e.loadMedia(),G.dispatch({type:"setJukeboxIndex",index:e.state.jukeboxIndex});e.setState(n,function(){e.dispatchPlayerStatus({status:"play"}),e.state.stream.webradio?e.sendStreamComand("now"):e.sendStreamComand("list",{offset:e.state.jukeboxIndex,limit:1}),e.rap.audioEl.play()})}})}},{key:"handleListen",value:function(){this.setState({currentTime:this.rap.audioEl.currentTime,volume:100*this.rap.audioEl.volume})}},{key:"handleRepeat",value:function(){var e=this;this.setState({jukeboxRepeat:!this.state.jukeboxRepeat},function(){e.dispatchPlayerStatus({repeat:!0})})}},{key:"handleRandom",value:function(){var e=this,t={jukeboxRandom:!this.state.jukeboxRandom};this.state.jukeboxRandom||(t.jukeboxPlayedIndex=[]),this.setState(t,function(){e.dispatchPlayerStatus({random:!0})})}},{key:"handleOnPlay",value:function(){var e=this;this.setState({play:!0},function(){e.dispatchPlayerStatus({status:"play"})})}},{key:"handleOnEnded",value:function(){var e=this;this.state.stream.webradio?this.setState({play:!1},function(){e.dispatchPlayerStatus({status:"stop"})}):this.nextSong()}},{key:"handleOnPause",value:function(){this.state.stream.webradio?this.handleStop():this.dispatchPlayerStatus({status:"pause"})}},{key:"handleChangeVolume",value:function(e){var t=this;this.rap.audioEl.volume=(this.state.volume+e)/100,this.setState({volume:this.state.volume+e},function(){t.dispatchPlayerStatus({volume:t.state.volume+e})})}},{key:"displayDuration",value:function(e,t){var a,n,i,l=Math.floor(e/60),r=Math.floor(e)%60;return t?(a=Math.floor(t/60),n=Math.floor(t)%60,i=s.a.createElement("span",null,l<10?"0"+l:l,":",r<10?"0"+r:r," / ",a<10?"0"+a:a,":",n<10?"0"+n:n)):i=s.a.createElement("span",null,l<10?"0"+l:l,":",r<10?"0"+r:r),i}},{key:"nextSong",value:function(){var e=this;if(this.state.jukeboxRandom){var t,a;a=this.state.jukeboxPlayedIndex.length<this.state.stream.elements?this.state.jukeboxPlayedIndex:[];do{t=Math.floor(Math.random()*(this.state.stream.elements+1))}while(a.indexOf(t)>=0);a.push(t),this.setState({jukeboxIndex:t,jukeboxPlayedIndex:a},function(){"stop"!==e.state.playerStatus&&e.handlePlay()},function(){e.loadMedia()}),G.dispatch({type:"setJukeboxIndex",index:t})}else this.state.jukeboxIndex<this.state.stream.elements-1?this.setState({jukeboxIndex:this.state.jukeboxIndex+1},function(){"stop"!==e.state.playerStatus&&e.handlePlay(),e.loadMedia(),G.dispatch({type:"setJukeboxIndex",index:e.state.jukeboxIndex})}):this.state.jukeboxRepeat&&this.setState({jukeboxIndex:0,jukeboxPlayedIndex:[]},function(){"stop"!==e.state.playerStatus&&e.handlePlay(),e.loadMedia(),e.dispatchPlayerStatus({repeat:!0}),G.dispatch({type:"setJukeboxIndex",index:0})})}},{key:"render",value:function(){var e,t,a,n,i=this,l=$.t("common.none");return this.state.stream&&this.state.stream.display_name&&(l=this.state.stream.display_name.startsWith("{")&&-1!==this.state.stream.display_name.indexOf("} - ")?this.state.stream.display_name.substring(this.state.stream.display_name.indexOf("} - ")+3):this.state.stream.display_name||$.t("common.no_name")),n=s.a.createElement("div",null,s.a.createElement("label",{className:"hidden-xs"},$.t("player.current_stream"),"\xa0"),s.a.createElement("span",null,l)),this.state.play?(e=this.state.stream.webradio?s.a.createElement(_.a,{title:$.t("common.play"),disabled:!0},s.a.createElement(L.a,{name:"play"})):this.rap.audioEl.paused?s.a.createElement(_.a,{title:$.t("common.play"),onClick:this.handlePlay},s.a.createElement(L.a,{name:"play"})):s.a.createElement(_.a,{title:$.t("common.pause"),onClick:this.handlePause},s.a.createElement(L.a,{name:"pause"})),t=this.displayDuration(this.state.currentTime,this.state.duration)):e=s.a.createElement(_.a,{title:$.t("common.play"),onClick:this.handlePlay},s.a.createElement(L.a,{name:"play"})),a=this.state.volume?s.a.createElement(L.a,{name:"volume-up"}):s.a.createElement(L.a,{name:"volume-off"}),s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("player.previous"),onClick:this.handlePrevious},s.a.createElement(L.a,{name:"fast-backward"})),s.a.createElement(_.a,{title:$.t("common.stop"),onClick:this.handleStop},s.a.createElement(L.a,{name:"stop"})),e,s.a.createElement(_.a,{title:$.t("player.next"),onClick:this.handleNext},s.a.createElement(L.a,{name:"fast-forward"}))),"\xa0",s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("common.repeat"),onClick:this.handleRepeat,disabled:this.state.stream.webradio,className:this.state.jukeboxRepeat&&!this.state.stream.webradio?"btn-primary":""},s.a.createElement(L.a,{name:"repeat"})),s.a.createElement(_.a,{title:$.t("common.random"),onClick:this.handleRandom,disabled:this.state.stream.webradio,className:this.state.jukeboxRandom&&!this.state.stream.webradio?"btn-primary":""},s.a.createElement(L.a,{name:"random"})),s.a.createElement(ee.a,{title:a,id:"dropdown-volume"},s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(5)}},$.t("common.volume_plus_5")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(1)}},$.t("common.volume_plus_1")),s.a.createElement(y.a,{className:"text-center"},$.t("common.volume_current")," ",this.state.volume," %"),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(-1)}},$.t("common.volume_minus_1")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(-5)}},$.t("common.volume_minus_5")))),s.a.createElement("div",null,s.a.createElement(at.a,{src:this.state.streamUrl,ref:function(e){i.rap=e},autoPlay:!0,onPlay:this.handleOnPlay,onPause:this.handleOnPause,onEnded:this.handleOnEnded,onListen:this.handleListen,listenInterval:1e3,preload:this.state.preload}))),s.a.createElement("div",null,n,t))}}]),t}(n.Component),st=function(e){function t(e){var a;Object(r.a)(this,t),a=Object(c.a)(this,Object(m.a)(t).call(this,e));var n=setInterval(function(){a.MPDStatus()},1e4);return a.state={interval:n,play:!1,stream:e.stream,playNow:e.play,playIndex:e.index,player:G.getState().externalPlayerList.find(function(t){return e.player.name===t.name})||{type:!1,name:!1},now:!1,next:!1,currentTime:0,duration:0,volume:0,switchOn:!1,jukeboxIndex:-1,jukeboxPlayedIndex:[],jukeboxNextIndex:0,jukeboxRepeat:!1,jukeboxRandom:!1},a.handlePrevious=a.handlePrevious.bind(Object(g.a)(Object(g.a)(a))),a.handleStop=a.handleStop.bind(Object(g.a)(Object(g.a)(a))),a.handlePause=a.handlePause.bind(Object(g.a)(Object(g.a)(a))),a.handlePlay=a.handlePlay.bind(Object(g.a)(Object(g.a)(a))),a.handleNext=a.handleNext.bind(Object(g.a)(Object(g.a)(a))),a.handleRepeat=a.handleRepeat.bind(Object(g.a)(Object(g.a)(a))),a.handleRandom=a.handleRandom.bind(Object(g.a)(Object(g.a)(a))),a.handlePlayerSwitch=a.handlePlayerSwitch.bind(Object(g.a)(Object(g.a)(a))),a.handleChangeVolume=a.handleChangeVolume.bind(Object(g.a)(Object(g.a)(a))),a._notificationSystem=null,a.state.stream.name&&a.state.player.name?a.loadStream(a.state.playNow):a.MPDConnect(),G.subscribe(function(){var e=G.getState();if(a._ismounted&&"setPlayerAction"===e.lastAction)switch(e.profile.playerAction){case"previous":a.handlePrevious();break;case"stop":a.handleStop();break;case"play":a.handlePlay();break;case"pause":a.handlePause();break;case"next":a.handleNext();break;case"repeat":a.handleRepeat();break;case"random":a.handleRandom();break;case"volume":a.handleChangeVolume(e.profile.playerActionParameter)}}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,a=e.stream.name&&e.stream.name!==this.state.stream.name,n=e.player.name&&e.player.name!==this.state.player.name,s={player:G.getState().externalPlayerList.find(function(t){return e.player.name===t.name})||this.state.player};e.play&&(s.playNow=e.play),e.stream&&(s.stream=e.stream),e.index>-1&&(s.playIndex=e.index),this.setState(s,function(){n?t.MPDConnect():a?t.loadStream(t.state.playNow):t.state.playNow&&t.setState({playNow:!1,jukeboxIndex:t.state.playIndex},function(){t.handlePlay()})})}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillUnmount",value:function(){this.state.interval&&clearInterval(this.state.interval),this._ismounted=!1}},{key:"loadStream",value:function(e){var t=this,a=[];if(this.state.stream.webradio)a.push(G.getState().taliesinApiUrl+"/stream/"+this.state.stream.name+"?rand="+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5));else for(var n=0;n<this.state.stream.elements;n++)a.push(G.getState().taliesinApiUrl+"/stream/"+this.state.stream.name+"?index="+n);G.getState().APIManager.carleonApiRequest("POST","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/playlist",a).then(function(a){t.loadMedia(),e?t.setState({playNow:!1,jukeboxIndex:t.state.stream.webradio||t.state.jukeboxRandom?-1:t.state.playIndex},function(){t.handlePlay()}):t.setState({playNow:!1,jukeboxIndex:-1})})}},{key:"MPDStatus",value:function(){var e=this;G.getState().APIManager.carleonApiRequest("GET","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/status").then(function(t){e.setState({jukeboxRepeat:t.repeat,jukeboxRandom:t.random,volume:t.volume,jukeboxIndex:t.song_pos,play:"play"===t.state},function(){G.dispatch({type:"setCurrentPlayerStatus",volume:t.volume,repeat:t.repeat,random:t.random,status:t.state}),t.song_pos!==G.getState().profile.jukeboxIndex?(G.dispatch({type:"setJukeboxIndex",index:t.song_pos}),e.loadMedia()):e.state.stream.webradio&&e.loadMedia()})}),this.state.player.switch&&G.getState().APIManager.benoicApiRequest("GET","/device/"+encodeURIComponent(this.state.player.switch.device)+"/switch/"+encodeURIComponent(this.state.player.switch.name)).then(function(t){e.setState({switchOn:!!t.value})})}},{key:"MPDConnect",value:function(){var e=this;this.state.player.name&&(G.getState().APIManager.carleonApiRequest("GET","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/status").then(function(t){e.setState({jukeboxRepeat:t.repeat,jukeboxRandom:t.random,volume:t.volume,jukeboxIndex:t.song_pos,play:"play"===t.state},function(){G.getState().APIManager.carleonApiRequest("GET","/service-mpd/"+encodeURIComponent(e.state.player.name)+"/playlist/0").then(function(a){if(a.uri&&a.uri.startsWith(G.getState().taliesinApiUrl+"/stream")){var n=a.uri.substring((G.getState().taliesinApiUrl+"/stream").length);a.uri.indexOf("?")>-1&&(n=a.uri.substring((G.getState().taliesinApiUrl+"/stream").length+1,a.uri.indexOf("?")));var s=G.getState().streamList.find(function(e){return n.indexOf(e.name)>-1});s?e.setState({stream:s},function(){e.loadMedia(),G.dispatch({type:"loadStream",stream:s})}):(G.dispatch({type:"loadStream",stream:{name:!1,webradio:!1}}),e.setState({jukeboxIndex:-1}))}else G.dispatch({type:"loadStream",stream:{name:!1,webradio:!1}}),e.setState({jukeboxIndex:-1});G.dispatch({type:"setCurrentPlayerStatus",volume:t.volume}),e.MPDStatus()})})}),this.state.player.switch&&G.getState().APIManager.benoicApiRequest("GET","/device/"+encodeURIComponent(this.state.player.switch.device)+"/switch/"+encodeURIComponent(this.state.player.switch.name)).then(function(t){e.setState({switchOn:!!t.value})}))}},{key:"loadMedia",value:function(){var e=this;this.state.stream.name&&(this.state.stream.webradio?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"now"}).then(function(t){t.data_source&&t.path&&(G.getState().profile.mediaNow.data_source!==t.data_source||G.getState().profile.mediaNow.path!==t.path)&&(e.setState({media:t},function(){G.dispatch({type:"setMediaNow",media:t})}),G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(e.state.stream.name)+"/manage",{command:"next"}).then(function(e){G.dispatch({type:"setMediaNext",media:e})}))}):G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"list",parameters:{offset:this.state.jukeboxIndex,limit:1}}).then(function(e){!e[0]||e[0].data_source===G.getState().profile.mediaNow.data_source&&e[0].path===G.getState().profile.mediaNow.path||G.dispatch({type:"setMediaNow",media:e[0]})}))}},{key:"handlePrevious",value:function(){var e=this;this.state.stream.webradio||G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/previous/").then(function(){G.getState().NotificationManager.addNotification({message:$.t("player.previous"),level:"success"}),e.MPDStatus()})}},{key:"handleNext",value:function(){var e=this;this.state.stream.webradio?G.getState().APIManager.taliesinApiRequest("PUT","/stream/"+encodeURIComponent(this.state.stream.name)+"/manage",{command:"skip"}).then(function(t){G.getState().NotificationManager.addNotification({message:$.t("player.next"),level:"success"}),e.MPDStatus()}):G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/next/").then(function(){G.getState().NotificationManager.addNotification({message:$.t("player.next"),level:"success"}),e.MPDStatus()})}},{key:"handleStop",value:function(){var e=this;this.state.player.switch&&this.state.switchOn&&G.getState().APIManager.benoicApiRequest("GET","/device/"+encodeURIComponent(this.state.player.switch.device)+"/switch/"+encodeURIComponent(this.state.player.switch.name)+"/0").then(function(){e.setState({switchOn:!e.state.switchOn})}),this.setState({play:!1}),G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/stop/").then(function(){G.dispatch({type:"setCurrentPlayerStatus",status:"stop"}),G.getState().NotificationManager.addNotification({message:$.t("common.stop"),level:"success"}),e.MPDStatus()})}},{key:"handlePause",value:function(){this.setState({play:!1}),G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/pause/").then(function(){G.dispatch({type:"setCurrentPlayerStatus",status:"pause"}),G.getState().NotificationManager.addNotification({message:$.t("common.pause"),level:"success"})})}},{key:"handlePlay",value:function(){var e,t=this;this.state.player.switch&&!this.state.switchOn&&G.getState().APIManager.benoicApiRequest("GET","/device/"+encodeURIComponent(this.state.player.switch.device)+"/switch/"+encodeURIComponent(this.state.player.switch.name)+"/1").then(function(){t.setState({switchOn:!t.state.switchOn})}),e=this.state.jukeboxIndex>-1?"/service-mpd/"+encodeURIComponent(this.state.player.name)+"/playpos/"+this.state.jukeboxIndex:"/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/play/",G.getState().APIManager.carleonApiRequest("PUT",e).then(function(){G.dispatch({type:"setCurrentPlayerStatus",status:"play"}),G.getState().NotificationManager.addNotification({message:$.t("common.play"),level:"success"}),t.MPDStatus()})}},{key:"handleRepeat",value:function(){var e=this;G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/repeat/"+(this.state.jukeboxRepeat?"0":"1")).then(function(){e.setState({jukeboxRepeat:!e.state.jukeboxRepeat},function(){G.dispatch({type:"setCurrentPlayerStatus",repeat:e.state.jukeboxRepeat})})})}},{key:"handleRandom",value:function(){var e=this;G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/action/random/"+(this.state.jukeboxRandom?"0":"1")).then(function(){e.setState({jukeboxRandom:!e.state.jukeboxRandom},function(){G.dispatch({type:"setCurrentPlayerStatus",random:e.state.jukeboxRandom})})})}},{key:"handlePlayerSwitch",value:function(){var e=this;this.state.player.switch&&G.getState().APIManager.benoicApiRequest("GET","/device/"+encodeURIComponent(this.state.player.switch.device)+"/switch/"+encodeURIComponent(this.state.player.switch.name)+"/"+(this.state.switchOn?"0":"1")).then(function(){e.setState({switchOn:!e.state.switchOn})})}},{key:"handleChangeVolume",value:function(e){var t=this;G.getState().APIManager.carleonApiRequest("PUT","/service-mpd/"+encodeURIComponent(this.state.player.name)+"/volume/"+(this.state.volume+e)).then(function(){t.setState({volume:t.state.volume+e})})}},{key:"render",value:function(){var e,t,a,n,i=this;return e=this.state.play?this.state.stream.webradio?s.a.createElement(_.a,{title:$.t("common.play"),disabled:!0},s.a.createElement(L.a,{name:"play"})):s.a.createElement(_.a,{title:$.t("common.play"),onClick:this.handlePause},s.a.createElement(L.a,{name:"pause"})):s.a.createElement(_.a,{title:$.t("common.play"),onClick:this.handlePlay},s.a.createElement(L.a,{name:"play"})),t=this.state.volume?s.a.createElement(L.a,{name:"volume-up"}):s.a.createElement(L.a,{name:"volume-off"}),this.state.player.switch&&(a=s.a.createElement(_.a,{title:$.t("player.switch"),onClick:this.handlePlayerSwitch,className:this.state.switchOn?"btn-primary":""},s.a.createElement(L.a,{name:"power-off"}))),this.state.stream&&this.state.stream.display_name&&(n=this.state.stream.display_name.startsWith("{")&&-1!==this.state.stream.display_name.indexOf("} - ")?this.state.stream.display_name.substring(this.state.stream.display_name.indexOf("} - ")+3):this.state.stream.display_name||$.t("common.no_name")),s.a.createElement("div",null,s.a.createElement("div",null,s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("player.previous"),onClick:this.handlePrevious},s.a.createElement(L.a,{name:"fast-backward"})),s.a.createElement(_.a,{title:$.t("common.stop"),onClick:this.handleStop},s.a.createElement(L.a,{name:"stop"})),e,s.a.createElement(_.a,{title:$.t("player.next"),onClick:this.handleNext},s.a.createElement(L.a,{name:"fast-forward"}))),"\xa0",s.a.createElement(Z.a,null,s.a.createElement(_.a,{title:$.t("common.repeat"),onClick:this.handleRepeat,className:this.state.jukeboxRepeat&&!this.state.stream.webradio?"btn-primary":""},s.a.createElement(L.a,{name:"repeat"})),s.a.createElement(_.a,{title:$.t("common.random"),onClick:this.handleRandom,className:this.state.jukeboxRandom&&!this.state.stream.webradio?"btn-primary":""},s.a.createElement(L.a,{name:"random"})),s.a.createElement(ee.a,{title:t,id:"dropdown-volume"},s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(5)}},$.t("common.volume_plus_5")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(1)}},$.t("common.volume_plus_1")),s.a.createElement(y.a,{className:"text-center"},$.t("common.volume_current")," ",this.state.volume," %"),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(-1)}},$.t("common.volume_minus_1")),s.a.createElement(y.a,{eventKey:"1",className:"text-center",onClick:function(){i.handleChangeVolume(-5)}},$.t("common.volume_minus_5"))),a)),s.a.createElement("div",null,s.a.createElement("label",{className:"hidden-xs"},$.t("player.current_stream"),"\xa0"),s.a.createElement("span",null,n)))}}]),t}(n.Component),it=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={media:e.media,imgThumbBlob:e.imgThumbBlob,imgBlob:!1,imgLoaded:!1,title:a.buildTitle(e.media,e.index,e.total),meta:e.meta,showModal:!1},a.handleOpenModal=a.handleOpenModal.bind(Object(g.a)(Object(g.a)(a))),a.handleCloseModal=a.handleCloseModal.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({media:e.media,title:this.buildTitle(e.media,e.index,e.total),imgThumbBlob:e.imgThumbBlob})}},{key:"buildTitle",value:function(e,t,a){var n="";return e&&(t>-1&&(n+=(t+1<10?"0"+(t+1):t+1)+"/"+(a<10?"0"+a:a)+" - "),e.tags?(-1===t&&(e.tags.artist||e.tags.album_artist)&&(n+=(e.tags.artist||e.tags.album_artist)+" - "),n+=e.tags.title||e.name.replace(/\.[^\/.]+$/,"")):n+=e.name.replace(/\.[^\/.]+$/,"")),n}},{key:"handleOpenModal",value:function(){this.setState({showModal:!0})}},{key:"handleCloseModal",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){var e="";return e=this.state.imgThumbBlob?s.a.createElement(b.a,{src:"data:image/jpeg;base64,"+this.state.imgThumbBlob,thumbnail:!0,responsive:!0,className:"cover-image-thumb"}):s.a.createElement(b.a,{src:"images/generic-album.png",thumbnail:!0,responsive:!0,className:"cover-image-thumb"}),s.a.createElement("div",{className:"media-container"},s.a.createElement("div",{className:"media-content hidden-sm hidden-xs"},s.a.createElement("a",{role:"button",onClick:this.handleOpenModal,title:this.state.title},s.a.createElement("div",null,s.a.createElement("label",null,this.state.meta)),s.a.createElement("div",{className:"scroll-left"},s.a.createElement("span",null,this.state.title)),s.a.createElement("div",{className:"text-center"},e))),s.a.createElement("div",{className:"visible-sm visible-xs text-center"},s.a.createElement("a",{role:"button",onClick:this.handleOpenModal,title:this.state.title},s.a.createElement("div",null,s.a.createElement("label",null,this.state.meta)),s.a.createElement("div",null,s.a.createElement("span",null,this.state.title)))),s.a.createElement(ne,{show:this.state.showModal,media:this.state.media,title:this.state.title,onClose:this.handleCloseModal}))}}]),t}(n.Component),lt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={imgThumbBlob:!1,media:e.media},a.loadCover(),G.subscribe(function(){"showFullScreen"===G.getState().lastAction&&(G.getState().showFullScreen||a.loadCover())}),a.loadCover=a.loadCover.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.setState({media:!1}),this._ismounted=!1}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=!this.state.media&&e.media||this.state.media.data_source!==e.media.data_source||this.state.media.path!==e.media.path;this.setState({media:e.media},function(){a&&t.loadCover()})}},{key:"loadCover",value:function(){var e=this;this.state.media&&!G.getState().showFullScreen&&G.getState().APIManager.taliesinApiRequest("GET","/stream/"+encodeURIComponent(G.getState().profile.stream.name)+"/cover?base64&thumbnail").then(function(t){e.setState({imgThumbBlob:t})}).fail(function(){e.setState({imgThumbBlob:!1})})}},{key:"buildTitle",value:function(e){var t="";return e.tags?((e.tags.artist||e.tags.album_artist)&&(t+=(e.tags.artist||e.tags.album_artist)+" - "),t+=e.tags.title||e.name.replace(/\.[^\/.]+$/,"")):t+=e.name.replace(/\.[^\/.]+$/,""),t}},{key:"render",value:function(){return s.a.createElement(it,{media:this.state.media,imgThumbBlob:this.state.imgThumbBlob,meta:$.t("player.play_now"),index:-1})}}]),t}(n.Component),rt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={imgThumbBlob:!1,media:e.media},a.loadCover(),G.subscribe(function(){"showFullScreen"===G.getState().lastAction&&(G.getState().showFullScreen||a.loadCover())}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.setState({media:!1})}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.state.media.data_source!==e.media.data_source||this.state.media.path!==e.media.path;this.setState({media:e.media},function(){a&&t.loadCover()})}},{key:"loadCover",value:function(){var e=this;this.state.media&&!G.getState().showFullScreen&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.media.data_source)+"/browse/path/"+encodeURI(this.state.media.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(t){e.setState({imgThumbBlob:t})}).fail(function(){e.setState({imgThumbBlob:!1})})}},{key:"render",value:function(){return s.a.createElement(it,{media:this.state.media,imgThumbBlob:this.state.imgThumbBlob,meta:$.t("player.play_next"),index:-1})}}]),t}(n.Component),ot=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={imgThumbBlob:!1,media:e.media,index:e.index,total:e.total},a.loadCover(),a.loadCover=a.loadCover.bind(Object(g.a)(Object(g.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.setState({media:!1}),this._ismounted=!1}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.state.media.data_source!==e.media.data_source||this.state.media.path!==e.media.path;this.setState({media:e.media?e.media:this.state.media,index:e.index,total:e.total},function(){a&&t.loadCover()})}},{key:"loadCover",value:function(){var e=this;this.state.media.data_source&&this.state.media.path&&!G.getState().showFullScreen&&G.getState().APIManager.taliesinApiRequest("GET","/data_source/"+encodeURIComponent(this.state.media.data_source)+"/browse/path/"+encodeURI(this.state.media.path).replace(/#/g,"%23").replace(/\+/g,"%2B")+"?cover&thumbnail&base64").then(function(t){e.setState({imgThumbBlob:t})}).fail(function(){e.setState({imgThumbBlob:!1})})}},{key:"buildTitle",value:function(e,t,a){var n="";return e&&(t>-1&&(n+=(t+1<10?"0"+(t+1):t+1)+"/"+(a<10?"0"+a:a)+" - "),e.tags?(-1===t&&(e.tags.artist||e.tags.album_artist)&&(n+=(e.tags.artist||e.tags.album_artist)+" - "),n+=e.tags.title||e.name.replace(/\.[^\/.]+$/,"")):n+=e.name.replace(/\.[^\/.]+$/,"")),n}},{key:"render",value:function(){return s.a.createElement(it,{media:this.state.media,imgThumbBlob:this.state.imgThumbBlob,meta:"Jukebox",index:this.state.index,total:this.state.total})}}]),t}(n.Component),ct=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={streamList:G.getState().streamList,playerList:G.getState().externalPlayerList,isAdmin:G.getState().profile.isAdmin,stream:G.getState().profile.stream,jukeboxIndex:0,mediaNow:G.getState().profile.mediaNow,mediaNext:G.getState().profile.mediaNext,fullScreen:!1,currentPlayer:G.getState().profile.currentPlayer,play:!1,stream_external:!1},G.subscribe(function(){var e=G.getState();"setStreamList"===e.lastAction?a.setState({streamList:e.streamList,play:!1}):"setExternalPlayerList"===e.lastAction?a.setState({playerList:G.getState().externalPlayerList,play:!1}):"setUserList"===e.lastAction?a.setState({isAdmin:G.getState().profile.isAdmin,play:!1}):"setCurrentPlayer"===e.lastAction?a.setState({currentPlayer:G.getState().profile.currentPlayer,stream:{name:!1},play:!1}):"loadStream"===e.lastAction?a.setState({stream:G.getState().profile.stream,mediaNow:!1,play:!1},function(){a.buildExternal(),a.setWindowTitle()}):"setStream"===e.lastAction?G.getState().profile.stream.name===a.state.stream.name&&a.setState({stream:G.getState().profile.stream,mediaNow:!1,play:!1},function(){a.buildExternal(),a.setWindowTitle()}):"loadStreamAndPlay"===e.lastAction?a.setState({stream:G.getState().profile.stream,mediaNow:!1,jukeboxIndex:G.getState().profile.jukeboxIndex,play:!0},function(){a.buildExternal(),a.setWindowTitle()}):"setJukeboxIndex"===e.lastAction?a.setState({jukeboxIndex:G.getState().profile.jukeboxIndex,play:!1}):"setMediaNow"===e.lastAction?a.setState({mediaNow:G.getState().profile.mediaNow,play:!1},function(){a.setWindowTitle()}):"setMediaNext"===e.lastAction?a.setState({mediaNext:G.getState().profile.mediaNext,play:!1}):"setStoredValues"===e.lastAction&&a.setState({currentPlayer:G.getState().profile.currentPlayer,stream:G.getState().profile.stream,mediaNow:!1,play:!1},function(){a.buildExternal()})}),a.showFullScreen=a.showFullScreen.bind(Object(g.a)(Object(g.a)(a))),a.showMediaList=a.showMediaList.bind(Object(g.a)(Object(g.a)(a))),a.buildExternal=a.buildExternal.bind(Object(g.a)(Object(g.a)(a))),a.setWindowTitle=a.setWindowTitle.bind(Object(g.a)(Object(g.a)(a))),a.buildTitle=a.buildTitle.bind(Object(g.a)(Object(g.a)(a))),a.setWindowTitle(),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"setWindowTitle",value:function(){this.state.mediaNow?document.title=this.buildTitle(this.state.mediaNow,this.state.stream.webradio?-1:this.state.jukeboxIndex,this.state.stream.elements)+" - Taliesin":document.title="Taliesin"}},{key:"buildTitle",value:function(e,t,a){var n="";return e&&(t>-1&&(n+=(t+1<10?"0"+(t+1):t+1)+"/"+(a<10?"0"+a:a)+" - "),e.tags?(-1===t&&(e.tags.artist||e.tags.album_artist)&&(n+=(e.tags.artist||e.tags.album_artist)+" - "),n+=e.tags.title||e.name.replace(/\.[^\/.]+$/,"")):n+=e.name.replace(/\.[^\/.]+$/,"")),n}},{key:"componentDidMount",value:function(){this._ismounted=!0}},{key:"componentWillUnmount",value:function(){this._ismounted=!1}},{key:"showFullScreen",value:function(){this.setState({play:!1},function(){G.dispatch({type:"showFullScreen",show:!0})})}},{key:"showMediaList",value:function(){this.setState({play:!1},function(){G.dispatch({type:"setCurrentBrowse",browse:"showStreamMediaList"})})}},{key:"buildExternal",value:function(){var e;this.state.stream.name&&"external"===this.state.currentPlayer.type&&(e=this.state.stream.webradio?"data:application/mpegurl;base64,"+btoa("#EXTM3U\n\n#EXTINF:0,"+(this.state.stream.display_name||"no name")+"\n"+G.getState().taliesinApiUrl+"/stream/"+this.state.stream.name+"\n"):G.getState().taliesinApiUrl+"/stream/"+this.state.stream.name,this.setState({stream_external:e},function(){V()("#play-external-anchor-footer")[0].click()}))}},{key:"render",value:function(){var e,t,a,n,i,l,r=this;return"connected"===G.getState().status||"noauth"===G.getState().status?(this.state.stream.name&&(this.state.stream.webradio?(e=s.a.createElement(E.a,{md:2,sm:6,xs:6},s.a.createElement(lt,{media:this.state.mediaNow})),t=s.a.createElement(E.a,{md:2,sm:6,xs:6},s.a.createElement(rt,{media:this.state.mediaNext}))):a=s.a.createElement(E.a,{md:4,sm:12,xs:12},s.a.createElement(ot,{media:this.state.mediaNow,index:this.state.jukeboxIndex,total:this.state.stream.elements}))),i=s.a.createElement(E.a,{md:2,sm:4,xs:4},s.a.createElement(Z.a,null,s.a.createElement(Ze,{streamList:this.state.streamList,stream:this.state.stream}),s.a.createElement(et,{player:this.state.currentPlayer,currentList:this.state.playerList,isAdmin:this.state.isAdmin}))),l="carleon"===this.state.currentPlayer.type?s.a.createElement(E.a,{md:3,sm:6,xs:6,className:"player-box"},s.a.createElement(st,{player:this.state.currentPlayer,stream:this.state.stream,play:this.state.play,index:this.state.jukeboxIndex})):"internal"===this.state.currentPlayer.type?s.a.createElement(E.a,{md:3,sm:6,xs:6,className:"player-box"},s.a.createElement(nt,{stream:this.state.stream,play:this.state.play,index:this.state.jukeboxIndex,duration:this.state.stream.webradio?0:this.state.mediaNow.duration/1e3})):s.a.createElement(E.a,{md:3,sm:6,xs:6,className:"player-box"}),this.state.stream.name&&(n=s.a.createElement(E.a,{md:2,sm:2,xs:2,className:"text-center"},s.a.createElement(Z.a,{className:"hidden-xs hidden-sm"},s.a.createElement(_.a,{title:$.t("player.full_screen"),onClick:function(){return r.showFullScreen()}},s.a.createElement(L.a,{name:"arrows-alt"})),s.a.createElement(_.a,{title:$.t("player.list_media"),onClick:function(){return r.showMediaList()}},s.a.createElement(L.a,{name:"list"}))),s.a.createElement(ee.a,{id:"center-dropdown",title:"",pullRight:!0,className:"visible-xs visible-sm"},s.a.createElement(y.a,{onClick:function(){return r.showFullScreen()}},s.a.createElement(L.a,{name:"arrows-alt"}),"\xa0Full-screen"),s.a.createElement(y.a,{onClick:function(){return r.showMediaList()}},s.a.createElement(L.a,{name:"list"}),"\xa0List media")))),s.a.createElement("div",{className:"navbar-fixed-bottom footer"},s.a.createElement("a",{href:this.state.stream_external||"",style:{display:"none"},id:"play-external-anchor-footer",download:(this.state.stream.display_name||$.t("common.no_name"))+".m3u"},$.t("common.external")),s.a.createElement(S.a,null,i,l,n,e,t,a))):s.a.createElement("div",null)}}]),t}(n.Component),mt=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){G.dispatch({type:"newNotificationManager",notificationManager:this.refs.notificationSystem})}},{key:"render",value:function(){return s.a.createElement("div",{className:"container-fluid"},s.a.createElement(h.a,{ref:"notificationSystem"}),s.a.createElement(p.a,{ns:"translations"},function(e,t){t.i18n;return s.a.createElement("div",null,s.a.createElement(Xe,null),s.a.createElement(se,null),s.a.createElement(Ye,null),s.a.createElement(ct,null))}))}}]),t}(n.Component),dt=function(){function e(t){var a=this;Object(r.a)(this,e);var n,s,i=this;if(this.refreshToken=!1,this.accessToken=!1,this.changeStatusCb=[],this.connected=!1,this.parameters={},this.localStorageKey="taliesinOauth2",this.refreshTimeout=!1,t&&(this.parameters.storageType=t.storageType||"none",this.parameters.responseType=t.responseType||"code",this.parameters.serverUrl=t.serverUrl||"",this.parameters.scope=t.scope||"",this.parameters.authUrl=t.authUrl||"",this.parameters.tokenUrl=t.tokenUrl||"",this.parameters.clientId=t.clientId||"",this.parameters.clientPassword=t.clientPassword||"",this.parameters.redirectUri=t.redirectUri||"",this.parameters.profileUrl=t.profileUrl||"",t.changeStatusCb&&this.changeStatusCb.push(t.changeStatusCb)),"token"===this.parameters.responseType)(s=this.getTokenFromFragment())?(this.accessToken=s,document.location="#",this.getConnectedProfile(function(e,t){e?a.broadcastMessage("connected",s.access_token,s.iat+s.expires_in,t):a.broadcastMessage("connected",s.access_token,s.iat+s.expires_in,!1)}),this.storeAccessToken(s)):(n=this.getStoredData())&&n.accessToken&&this.isTokenValid(n.accessToken)?(this.accessToken=n.accessToken,this.broadcastMessage("connected",this.accessToken.access_token,this.accessToken.iat+this.accessToken.expires_in),this.getConnectedProfile(function(e,t){e&&a.broadcastMessage("profile",t)})):(this.broadcastMessage("disconnected"),this.accessToken=!1);else if("code"===this.parameters.responseType){var l=this.getCodeFromQuery();if(l)this.getRefreshTokenFromCode(l,function(e){e?(i.refreshToken=e.refresh_token,i.storeRefreshToken(i.refreshToken),e.access_token?(i.accessToken={access_token:e.access_token,iat:e.iat,expires_in:e.expires_in},i.storeAccessToken(i.accessToken),i.broadcastMessage("connected",i.accessToken.access_token,i.accessToken.iat+i.accessToken.expires_in),i.getConnectedProfile(function(e,t){e&&i.broadcastMessage("profile",t)}),i.refreshTokenLoop(e.refresh_token,i.accessToken.expires_in)):i.broadcastMessage("disconnected")):i.broadcastMessage("disconnected")}),window.history.pushState(null,"",document.location.href.split("?")[0]);else if((n=this.getStoredData())&&n.accessToken&&this.isTokenValid(n.accessToken)){if(this.accessToken=n.accessToken,this.broadcastMessage("connected",this.accessToken.access_token,this.accessToken.iat+this.accessToken.expires_in),this.getConnectedProfile(function(e,t){e&&a.broadcastMessage("profile",t)}),n.refreshToken){var o=new Date,c=Math.floor((1e3*(i.accessToken.iat+i.accessToken.expires_in)-o.getTime())/1e3);this.refreshTokenLoop(n.refreshToken,c)}}else n&&n.refreshToken?(this.accessToken=!1,this.refreshToken=n.refreshToken,this.executeRefreshToken(n.refreshToken,function(e,t){e&&(i.accessToken=t,i.storeAccessToken(t),i.refreshTokenLoop(n.refreshToken,i.accessToken.expires_in),i.broadcastMessage("connected",t.access_token,t.iat+t.expires_in),i.getConnectedProfile(function(e,t){e&&i.broadcastMessage("profile",t)}))})):this.broadcastMessage("disconnected")}else this.broadcastMessage("error")}return Object(o.a)(e,[{key:"getQueryParams",value:function(e){e=e.split("+").join(" ");var t,a={},n=/[#&]?([^=]+)=([^&]*)/g;for(t=n.exec(e);t;)a[decodeURIComponent(t[1])]=decodeURIComponent(t[2]),t=n.exec(e);return a}},{key:"getTokenFromFragment",value:function(){var e=this.getQueryParams(document.location.hash),t=new Date;return!(!e.access_token||!e.expires_in)&&{access_token:e.access_token,expires_in:e.expires_in,iat:Math.floor(t.getTime()/1e3)}}},{key:"getCodeFromQuery",value:function(){return this.getQueryParams(document.location.search.substring(1)).code||!1}},{key:"refresh",value:function(e){var t=this;"code"===this.parameters.responseType&&this.refreshToken?this.executeRefreshToken(this.refreshToken,function(a,n){a&&(t.accessToken=n,t.storeAccessToken(n),t.refreshTokenLoop(t.refreshToken,t.accessToken.expires_in),t.broadcastMessage("refresh",n.access_token,n.iat+n.expires_in),e(n.access_token))}):e(!1)}},{key:"getToken",value:function(){return this.accessToken&&this.isTokenValid(this.accessToken)?this.accessToken.access_token:(this.accessToken=!1,!1)}},{key:"getStatus",value:function(){return this.accessToken&&this.isTokenValid(this.accessToken)?"connected":(this.accessToken=!1,"disconnected")}},{key:"storeAccessToken",value:function(e){var t=this.getStoredData();return t||(t={}),t.accessToken=e,"local"===this.parameters.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(t)):"cookie"===this.parameters.storageType&&B.a.set(this.localStorageKey,JSON.stringify(t))}},{key:"storeRefreshToken",value:function(e){var t=this.getStoredData();return t||(t={}),t.refreshToken=e,"local"===this.parameters.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(t)):"cookie"===this.parameters.storageType&&B.a.set(this.localStorageKey,JSON.stringify(t))}},{key:"getStoredData",value:function(){return"local"===this.parameters.storageType?JSON.parse(localStorage.getItem(this.localStorageKey))||{}:"cookie"===this.parameters.storageType&&JSON.parse(B.a.get(this.localStorageKey))||{}}},{key:"onChangeStatus",value:function(e){this.changeStatusCb.push(e)}},{key:"isTokenValid",value:function(e){if(e){var t=new Date;return 1e3*(e.iat+e.expires_in)>t.getTime()}return!1}},{key:"getRefreshTokenFromCode",value:function(e,t){var a=this;V.a.ajax({type:"POST",url:this.parameters.serverUrl+"/"+this.parameters.tokenUrl,data:{grant_type:"authorization_code",client_id:this.parameters.clientId,redirect_uri:this.parameters.redirectUri,code:e},success:function(e,a,n){t(e)},error:function(e){403===e.status&&(a.refreshToken=!1),a.accessToken=!1,t(!1)}})}},{key:"refreshTokenLoop",value:function(e,t){var a=this;clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){a.executeRefreshToken(e,function(t,n){if(t){var s=new Date,i=Math.floor((1e3*(a.accessToken.iat+a.accessToken.expires_in)-s.getTime())/1e3);a.refreshTokenLoop(e,i)}})},1e3*(t-60))}},{key:"runRefreshToken",value:function(e){return this.getStoredData().refreshToken?this.executeRefreshToken(this.getStoredData().refreshToken,e):Promise.reject("disconnected")}},{key:"executeRefreshToken",value:function(e,t){var a=this;return V.a.ajax({type:"POST",url:a.parameters.serverUrl+"/"+a.parameters.tokenUrl,data:{grant_type:"refresh_token",refresh_token:e},success:function(e,n,s){a.accessToken=e,a.storeAccessToken(e),a.broadcastMessage("refresh",e.access_token,e.iat+e.expires_in),t&&t(!0,e)},error:function(e){403===e.status&&(a.refreshToken=!1),a.accessToken=!1,0===e.readyState?a.broadcastMessage("network error"):a.broadcastMessage("disconnected"),t&&t(!1)}})}},{key:"broadcastMessage",value:function(e,t,a,n){for(var s in this.changeStatusCb)this.changeStatusCb[s](e,t,a,n)}},{key:"getConnectedProfile",value:function(e){if(this.parameters.profileUrl){V.a.ajax({type:"GET",url:this.parameters.serverUrl+"/"+this.parameters.profileUrl,headers:{Authorization:"Bearer "+this.accessToken.access_token},success:function(t){e&&e(!0,t)},error:function(t){e&&e(!1)}})}else e(!1)}},{key:"connect",value:function(){var e=this,t=this.getStoredData();t&&this.isTokenValid(t.accessToken)?(this.broadcastMessage("connected",t.accessToken.access_token,t.accessToken.iat+t.accessToken.expires_in),this.getConnectedProfile(function(t,a){t&&e.broadcastMessage("profile",a)})):(t.accessToken=!1,this.storeAccessToken(!1),"token"===this.parameters.responseType?document.location=this.parameters.serverUrl+"/"+this.parameters.authUrl+"?response_type=token&client_id="+this.parameters.clientId+"&redirect_uri="+this.parameters.redirectUri+"&scope="+this.parameters.scope:"code"===this.parameters.responseType&&(document.location=this.parameters.serverUrl+"/"+this.parameters.authUrl+"?response_type=code&client_id="+this.parameters.clientId+"&redirect_uri="+this.parameters.redirectUri+"&scope="+this.parameters.scope))}},{key:"disconnect",value:function(){clearTimeout(this.refreshTimeout),this.refreshToken=!1,this.accessToken=!1,this.broadcastMessage("disconnected"),"local"===this.parameters.storageType?localStorage.removeItem(this.localStorageKey):"cookie"===this.parameters.storageType&&B.a.remove(this.localStorageKey)}}]),e}();q.fetchConfig().then(function(){var e=q.getConfigValue("oauth2Config");if(e&&e.enabled){var t=new dt({storageType:e.storageType,responseType:e.responseType,serverUrl:e.serverUrl,authUrl:e.authUrl,tokenUrl:e.tokenUrl,clientId:e.clientId,redirectUri:e.redirectUri,scope:e.scope,profileUrl:e.profileUrl,changeStatusCb:function(e,t,a){var n=q.getLocalConfig()||{};(n.currentPlayer&&"external"===n.currentPlayer.type&&!G.getState().externalPlayerList.find(function(e){return e.name===n.currentPlayer.name})||!n.currentPlayer)&&(n.currentPlayer={type:"internal",name:$.t("player.internal")}),"external"===n.currentPlayer.type&&(n.stream=!1),G.dispatch({type:"setStoredValues",config:n}),G.dispatch({type:"showFullScreen",show:n.fullScreen}),G.dispatch({type:"setUseWebsocket",useWebsocket:q.getConfigValue("useWebsocket")}),"connected"===e?(G.dispatch({type:"connection",status:e,token:t,expiration:a,taliesinApiUrl:q.getConfigValue("taliesinApiUrl"),benoicPrefix:q.getConfigValue("benoicPrefix"),carleonPrefix:q.getConfigValue("carleonPrefix"),angharadApiUrl:q.getConfigValue("angharadApiUrl"),oauth2:!0}),l.a.render(s.a.createElement(mt,null),document.getElementById("root"))):"disconnected"===e?(G.dispatch({type:"connection",status:e,token:!1,expiration:0,taliesinApiUrl:q.getConfigValue("taliesinApiUrl"),benoicPrefix:q.getConfigValue("benoicPrefix"),carleonPrefix:q.getConfigValue("carleonPrefix"),angharadApiUrl:q.getConfigValue("angharadApiUrl"),oauth2:!0}),G.dispatch({type:"showFullScreen",show:!1}),l.a.render(s.a.createElement(mt,null),document.getElementById("root"))):"refresh"===e?G.dispatch({type:"newApiToken",token:t,expiration:a}):"profile"===e&&G.dispatch({type:"setProfile",profile:t})}});G.dispatch({type:"setOauth2Connector",oauth2Connector:t})}else G.dispatch({type:"setStoredValues",config:q.getLocalConfig()}),G.dispatch({type:"connection",status:"noauth",taliesinApiUrl:q.getConfigValue("taliesinApiUrl"),angharadApiUrl:q.getConfigValue("angharadApiUrl"),oauth2:!1}),l.a.render(s.a.createElement(mt,null),document.getElementById("root"));l.a.render(s.a.createElement(mt,null),document.getElementById("root"))}).fail(function(e){l.a.render(s.a.createElement("h2",null,"\xa0\xa0Error loading web configuration"),document.getElementById("root"))}),G.subscribe(function(){"connection"===G.getState().lastAction&&("connected"!==G.getState().status&&"noauth"!==G.getState().status||(G.getState().APIManager.taliesinApiRequest("GET","/users").then(function(e){G.dispatch({type:"setUserList",userList:e,isAdmin:!0})}).fail(function(e){401!==e.status&&403!==e.status&&G.getState().NotificationManager.addNotification({message:$.t("common.message_error_loading_user_list"),level:"error"})}),G.getState().APIManager.taliesinApiRequest("GET","/config/external_player").then(function(e){var t=[];e.forEach(function(e){t.push(JSON.parse(e))}),G.dispatch({type:"setExternalPlayerList",externalPlayerList:t})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_loading_player_list"),level:"error"})}),G.getState().APIManager.taliesinApiRequest("GET","/stream").then(function(e){G.dispatch({type:"setStreamList",streamList:e})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_loading_stream_list"),level:"error"}),G.dispatch({type:"setStreamList",streamList:[]})}),G.getState().APIManager.taliesinApiRequest("GET","/data_source").then(function(e){var t=!1;e.length>0&&!e.find(function(e){return e.name===G.getState().profile.dataSource.name})&&(t=e[0]),G.dispatch({type:"setDataSourceList",dataSourceList:e,currentDataSource:t,loaded:!0})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_loading_data_source"),level:"error"}),G.dispatch({type:"setDataSourceList",dataSourceList:[],currentDataSource:!1,loaded:!0})}),G.getState().APIManager.taliesinApiRequest("GET","/playlist").then(function(e){G.dispatch({type:"setPlaylists",playlists:e})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_loading_playlist"),level:"error"}),G.dispatch({type:"setPlaylists",playlists:[]})}),G.getState().APIManager.taliesinApiRequest("GET","/../config").then(function(e){G.dispatch({type:"setServerConfig",config:e})}).fail(function(e){G.getState().NotificationManager.addNotification({message:$.t("common.message_error_loading_server_config"),level:"error"}),G.dispatch({type:"setServerConfig",config:{}})})))})}},[[245,2,1]]]);